!function(e){var t={};function i(s){if(t[s])return t[s].exports;var a=t[s]={i:s,l:!1,exports:{}};return e[s].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=e,i.c=t,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)i.d(s,a,function(t){return e[t]}.bind(null,a));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/build/",i(i.s=2)}([function(e,t,i){var s,a=function(){var e=String.fromCharCode,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",s={};function a(e,t){if(!s[e]){s[e]={};for(var i=0;i<e.length;i++)s[e][e.charAt(i)]=i}return s[e][t]}var r={compressToBase64:function(e){if(null==e)return"";var i=r._compress(e,6,(function(e){return t.charAt(e)}));switch(i.length%4){default:case 0:return i;case 1:return i+"===";case 2:return i+"==";case 3:return i+"="}},decompressFromBase64:function(e){return null==e?"":""==e?null:r._decompress(e.length,32,(function(i){return a(t,e.charAt(i))}))},compressToUTF16:function(t){return null==t?"":r._compress(t,15,(function(t){return e(t+32)}))+" "},decompressFromUTF16:function(e){return null==e?"":""==e?null:r._decompress(e.length,16384,(function(t){return e.charCodeAt(t)-32}))},compressToUint8Array:function(e){for(var t=r.compress(e),i=new Uint8Array(2*t.length),s=0,a=t.length;s<a;s++){var n=t.charCodeAt(s);i[2*s]=n>>>8,i[2*s+1]=n%256}return i},decompressFromUint8Array:function(t){if(null==t)return r.decompress(t);for(var i=new Array(t.length/2),s=0,a=i.length;s<a;s++)i[s]=256*t[2*s]+t[2*s+1];var n=[];return i.forEach((function(t){n.push(e(t))})),r.decompress(n.join(""))},compressToEncodedURIComponent:function(e){return null==e?"":r._compress(e,6,(function(e){return i.charAt(e)}))},decompressFromEncodedURIComponent:function(e){return null==e?"":""==e?null:(e=e.replace(/ /g,"+"),r._decompress(e.length,32,(function(t){return a(i,e.charAt(t))})))},compress:function(t){return r._compress(t,16,(function(t){return e(t)}))},_compress:function(e,t,i){if(null==e)return"";var s,a,r,n={},o={},h="",l="",c="",d=2,u=3,g=2,p=[],m=0,y=0;for(r=0;r<e.length;r+=1)if(h=e.charAt(r),Object.prototype.hasOwnProperty.call(n,h)||(n[h]=u++,o[h]=!0),l=c+h,Object.prototype.hasOwnProperty.call(n,l))c=l;else{if(Object.prototype.hasOwnProperty.call(o,c)){if(c.charCodeAt(0)<256){for(s=0;s<g;s++)m<<=1,y==t-1?(y=0,p.push(i(m)),m=0):y++;for(a=c.charCodeAt(0),s=0;s<8;s++)m=m<<1|1&a,y==t-1?(y=0,p.push(i(m)),m=0):y++,a>>=1}else{for(a=1,s=0;s<g;s++)m=m<<1|a,y==t-1?(y=0,p.push(i(m)),m=0):y++,a=0;for(a=c.charCodeAt(0),s=0;s<16;s++)m=m<<1|1&a,y==t-1?(y=0,p.push(i(m)),m=0):y++,a>>=1}0==--d&&(d=Math.pow(2,g),g++),delete o[c]}else for(a=n[c],s=0;s<g;s++)m=m<<1|1&a,y==t-1?(y=0,p.push(i(m)),m=0):y++,a>>=1;0==--d&&(d=Math.pow(2,g),g++),n[l]=u++,c=String(h)}if(""!==c){if(Object.prototype.hasOwnProperty.call(o,c)){if(c.charCodeAt(0)<256){for(s=0;s<g;s++)m<<=1,y==t-1?(y=0,p.push(i(m)),m=0):y++;for(a=c.charCodeAt(0),s=0;s<8;s++)m=m<<1|1&a,y==t-1?(y=0,p.push(i(m)),m=0):y++,a>>=1}else{for(a=1,s=0;s<g;s++)m=m<<1|a,y==t-1?(y=0,p.push(i(m)),m=0):y++,a=0;for(a=c.charCodeAt(0),s=0;s<16;s++)m=m<<1|1&a,y==t-1?(y=0,p.push(i(m)),m=0):y++,a>>=1}0==--d&&(d=Math.pow(2,g),g++),delete o[c]}else for(a=n[c],s=0;s<g;s++)m=m<<1|1&a,y==t-1?(y=0,p.push(i(m)),m=0):y++,a>>=1;0==--d&&(d=Math.pow(2,g),g++)}for(a=2,s=0;s<g;s++)m=m<<1|1&a,y==t-1?(y=0,p.push(i(m)),m=0):y++,a>>=1;for(;;){if(m<<=1,y==t-1){p.push(i(m));break}y++}return p.join("")},decompress:function(e){return null==e?"":""==e?null:r._decompress(e.length,32768,(function(t){return e.charCodeAt(t)}))},_decompress:function(t,i,s){var a,r,n,o,h,l,c,d=[],u=4,g=4,p=3,m="",y=[],v={val:s(0),position:i,index:1};for(a=0;a<3;a+=1)d[a]=a;for(n=0,h=Math.pow(2,2),l=1;l!=h;)o=v.val&v.position,v.position>>=1,0==v.position&&(v.position=i,v.val=s(v.index++)),n|=(o>0?1:0)*l,l<<=1;switch(n){case 0:for(n=0,h=Math.pow(2,8),l=1;l!=h;)o=v.val&v.position,v.position>>=1,0==v.position&&(v.position=i,v.val=s(v.index++)),n|=(o>0?1:0)*l,l<<=1;c=e(n);break;case 1:for(n=0,h=Math.pow(2,16),l=1;l!=h;)o=v.val&v.position,v.position>>=1,0==v.position&&(v.position=i,v.val=s(v.index++)),n|=(o>0?1:0)*l,l<<=1;c=e(n);break;case 2:return""}for(d[3]=c,r=c,y.push(c);;){if(v.index>t)return"";for(n=0,h=Math.pow(2,p),l=1;l!=h;)o=v.val&v.position,v.position>>=1,0==v.position&&(v.position=i,v.val=s(v.index++)),n|=(o>0?1:0)*l,l<<=1;switch(c=n){case 0:for(n=0,h=Math.pow(2,8),l=1;l!=h;)o=v.val&v.position,v.position>>=1,0==v.position&&(v.position=i,v.val=s(v.index++)),n|=(o>0?1:0)*l,l<<=1;d[g++]=e(n),c=g-1,u--;break;case 1:for(n=0,h=Math.pow(2,16),l=1;l!=h;)o=v.val&v.position,v.position>>=1,0==v.position&&(v.position=i,v.val=s(v.index++)),n|=(o>0?1:0)*l,l<<=1;d[g++]=e(n),c=g-1,u--;break;case 2:return y.join("")}if(0==u&&(u=Math.pow(2,p),p++),d[c])m=d[c];else{if(c!==g)return null;m=r+r.charAt(0)}y.push(m),d[g++]=r+m.charAt(0),r=m,0==--u&&(u=Math.pow(2,p),p++)}}};return r}();void 0===(s=function(){return a}.call(t,i,t,e))||(e.exports=s)},function(e,t){e.exports=void 0},function(e,t,i){"use strict";i.r(t);i(1);class s extends Phaser.Scene{constructor(e=[0,0],t="myScene"){super(t),this.position=e}relativeX(e=0){return this.position[0]+e}relativeY(e=0){return this.position[1]+e}enableScene(){}disableScene(){}registerEvent(e,t){}preload(){}create(){}}class a{constructor(e,t,i,s,a,r,n="courier20",o=20){this.boundingBox=e.add.rectangle(i,s,a,r,2236962).setOrigin(0),this.boundingBox.strokeColor=12303291,this.boundingBox.isStroked=!0,this.boundingBox.lineWidth=2,this.text=e.add.bitmapText(i+a/2,s+r/2,n,t,o,1).setOrigin(.5),this.boundingBox.setDepth(99),this.text.setDepth(100)}setVisible(e){this.boundingBox.setVisible(e),this.text.setVisible(e)}destroy(){this.boundingBox.destroy(),this.text.destroy()}}var r=5,n=100,o=101,h=102,l=103,c=104,d=105,u=106,g=107,p=108,m=109,y=110,v=111,b=112,f=0,x=1,w=2,k=3,T=4,C=5,M=0,R=1,B=2,P=3,I=4,L=5,D=["Wood","Leather","Metal","Fiber","Stone","Crystal"],S=0,H=1,_=2,E=[0,2,2,3,3,4,4,5,6],A=.66,G=.4,O=1,U=7,F=7,W=5,Y=.15,N=.2,V=.01,q=.01,X=3,K=3,j=.44,z=.03,Q=.65,J=1.15,Z=1.0225,$=50,ee=50,te=2,ie=400,se=1.2,ae=.0025,re=80,ne=.75,oe=8e4,he=13,le=8,ce=2500,de=100,ue=.5,ge=1.03,pe=.09,me=10,ye=4,ve=1.66,be=1.5,fe=50,xe=.05,we=1.75,ke=25,Te=25,Ce=4,Me=.75,Re=.4,Be=0,Pe=1,Ie=2,Le=3,De=4,Se=5,He=6,_e=6e4,Ee=1e3,Ae=100,Ge=.9,Oe=120,Ue=3600,Fe=2,We=.95,Ye=1.5,Ne=["Primas","Twin","Threed","Tera","Pentas","Hexat","Septus","Octor","Novum","Deccan","Hendeka","Dodecan","Zenith"],Ve=1e3,qe=24e3,Xe=672e3,Ke=8736e3,je=6e4,ze={"0001":0,"0010":1,"0011":2,"0100":3,"0101":4,"0110":5,"0111":6,1e3:7,1001:8,1010:9,1011:10,1100:11,1101:12,1110:13,1111:14};class Qe{static getDistance(e,t,i,s){return Math.sqrt(Math.pow(i-e,2)+Math.pow(s-t,2))}static randint(e,t){return Math.floor(e+Math.random()*(t-e))}static pointInList(e,t,i){for(var s=0;s<i.length;s++)if(i[s].x===e&&i[s].y===t)return!0;return!1}static numberString(e){var t=new Intl.NumberFormat("en-US").format(e);return t.length>=20?t=t.substr(0,t.length-16)+"T":t.length>=16?t=t.substr(0,t.length-12)+"B":t.length>=12?t=t.substr(0,t.length-8)+"M":t.length>=8&&(t=t.substr(0,t.length-4)+"K"),t}static nearestPointsInList(e,t,i,s){for(var a=[],r=0;r<i.length;r++)a.push([r,Qe.getDistance(e,t,i[r].x,i[r].y)]);return a.sort((function(e,t){return e[1]-t[1]})),a.slice(0,s)}static nearestPointInList(e,t,i,s=!1){for(var a=0,r=this.getDistance(e,t,i[0].x,i[0].y),n=1;n<i.length;n++){var o=this.getDistance(e,t,i[n].x,i[n].y);if(o<r){if(!0===s&&0===o)continue;a=n,r=o}}return[a,r]}static sumList(e){for(var t=0,i=0;i<e.length;i++)t+=e[i];return t}static canCraft(e,t){for(var i=0;i<t.length;i++)if(t[i]<e[i])return!1;return!0}static getBonusText(e,t){var i=t>=0?"+":"";switch(e){case"health":return i+Math.floor(t)+" Health";case"damageMin":return i+Math.floor(t)+" Min Damage";case"damageMax":return i+Math.floor(t)+" Max Damage";case"strength":return i+Math.floor(t)+" Strength";case"dexterity":return i+Math.floor(t)+" Dexterity";case"agility":return i+Math.floor(t)+" Agility";case"endurance":return i+Math.floor(t)+" Endurance";case"recovery":return i+Math.floor(t)+" Recovery";case"defense":return i+Math.floor(t)+" Defense";case"accuracy":return i+Math.floor(t)+" Accuracy";case"hit":return i+Math.floor(t)+" Hit";case"evasion":return i+Math.floor(t)+" Evasion";case"critPower":return i+Math.floor(t)+" Crit Power";case"critResistance":return i+Math.floor(t)+" Crit Resist";case"critChance":return i+Math.floor(100*t)+"% Crit Chance";case"healthRegen":return i+Math.floor(10*t)/10+"/s HP Regen";case"armor":return i+Math.floor(t)+" Armor"}}static getCostText(e,t){switch(e){case 0:return Qe.numberString(Math.floor(t))+" Wood";case 1:return Qe.numberString(Math.floor(t))+" Leather";case 2:return Qe.numberString(Math.floor(t))+" Metal";case 3:return Qe.numberString(Math.floor(t))+" Fiber";case 4:return Qe.numberString(Math.floor(t))+" Stone";case 5:return Qe.numberString(Math.floor(t))+" Crystal"}}static processText(e,t){for(var i=e.split("\n"),s="",a=0;a<i.length;a++)if(i[a].length<t)s+=i[a]+(a<i.length-1?"\n":"");else{for(var r=0,n=t;n<i[a].length;){for(;n>r&&" "!==i[a][n];)n--;s+=i[a].substring(r,n)+"\n",r=n+1,n=Math.min(r+t,i[a].length)}r<i[a].length&&(s+=i[a].substring(r,i[a].length)),a!==i.length-1&&(s+="\n")}return s}static colorLerp(e,t,i){var s=Phaser.Display.Color.IntegerToRGB(e),a=Phaser.Display.Color.IntegerToRGB(t);return Phaser.Display.Color.GetColor(s.r+(a.r-s.r)*i,s.g+(a.g-s.g)*i,s.b+(a.b-s.b)*i)}}class Je{constructor(){return Je.instance||(this.moonlight=0,this.challengePoints=0,this.moonperks={str:{name:"Moon's Strength",level:0,maxLevel:-1,requires:[],cost:[7,2,1.025],texture:{sprite:"moonicons",tile:0}},dex:{name:"Moon's Dexterity",level:0,maxLevel:-1,requires:[],cost:[7,2,1.025],texture:{sprite:"moonicons",tile:1}},agi:{name:"Moon's Agility",level:0,maxLevel:-1,requires:[],cost:[7,2,1.025],texture:{sprite:"moonicons",tile:2}},end:{name:"Moon's Endurance",level:0,maxLevel:-1,requires:[],cost:[7,2,1.025],texture:{sprite:"moonicons",tile:3}},rec:{name:"Moon's Recovery",level:0,maxLevel:-1,requires:[],cost:[7,2,1.025],texture:{sprite:"moonicons",tile:4}},def:{name:"Moon's Defense",level:0,maxLevel:-1,requires:[],cost:[7,2,1.025],texture:{sprite:"moonicons",tile:5}},acc:{name:"Moon's Accuracy",level:0,maxLevel:-1,requires:[],cost:[7,2,1.025],texture:{sprite:"moonicons",tile:6}},vault:{name:"Hero's Vault",level:0,maxLevel:-1,requires:[],cost:[60,30,1.25],texture:{sprite:"moonicons",tile:9}},nightmarket:{name:"Night Market",level:0,maxLevel:-1,requires:[],cost:[35,45,1.2],texture:{sprite:"moonicons",tile:22}},hardenedvillagers:{name:"Hardened Villagers",level:0,maxLevel:-1,requires:[],cost:[40,25,1.5],texture:{sprite:"moonicons",tile:11}},shadow:{name:"Shadow's Blessing",level:0,maxLevel:-1,requires:[],cost:[10,15,1.08],texture:{sprite:"moonicons",tile:12}},runes:{name:"Moon Runes",level:0,maxLevel:1,requires:[],cost:[1e3,0,0],texture:{sprite:"moonicons",tile:8}},farstrider:{name:"Farstrider",level:0,maxLevel:-1,requires:[],cost:[25,25,1.15],texture:{sprite:"moonicons",tile:15}},heartofdarkness:{name:"Heart of Darkness",level:0,maxLevel:-1,requires:[],cost:[100,100,1.25],texture:{sprite:"moonicons",tile:10}},blackirongear:{name:"Blackiron Gear",level:0,maxLevel:-1,requires:["heartofdarkness"],cost:[30,80,1.25],texture:{sprite:"moonicons",tile:10}},runelands:{name:"Runelands",level:0,maxLevel:-1,requires:["runes"],cost:[300,150,1.3],texture:{sprite:"moonicons",tile:8}},moonlightworkers:{name:"Moonlight Workers",level:0,maxLevel:-1,requires:["hardenedvillagers"],cost:[100,100,1.3],texture:{sprite:"moonicons",tile:19}},heropouch:{name:"Hero's Pouch",level:0,maxLevel:-1,requires:["vault"],cost:[35,45,1.1],texture:{sprite:"moonicons",tile:9}},moonwine:{name:"Moonwine",level:0,maxLevel:2,requires:["nightmarket"],cost:[500,0,5],texture:{sprite:"moonicons",tile:14}},metal:{name:"Shadow's Metal",level:0,maxLevel:-1,requires:["str"],cost:[25,5,1.1],texture:{sprite:"moonicons",tile:26}},leather:{name:"Shadow's Leather",level:0,maxLevel:-1,requires:["dex"],cost:[25,5,1.1],texture:{sprite:"moonicons",tile:25}},fiber:{name:"Shadow's Fiber",level:0,maxLevel:-1,requires:["agi"],cost:[25,5,1.1],texture:{sprite:"moonicons",tile:27}},stone:{name:"Shadow's Stone",level:0,maxLevel:-1,requires:["end"],cost:[25,5,1.1],texture:{sprite:"moonicons",tile:28}},wood:{name:"Shadow's Wood",level:0,maxLevel:-1,requires:["rec"],cost:[25,5,1.1],texture:{sprite:"moonicons",tile:24}},crystal:{name:"Shadow's Crystal",level:0,maxLevel:-1,requires:["def"],cost:[25,5,1.1],texture:{sprite:"moonicons",tile:29}},gold:{name:"Shadow's Gold",level:0,maxLevel:-1,requires:["acc"],cost:[120,30,1.125],texture:{sprite:"moonicons",tile:30}},motivatedlabor:{name:"Motivated Labor",level:0,maxLevel:-1,requires:["moonlightworkers"],cost:[100,50,1.5],texture:{sprite:"moonicons",tile:17}},shadow2:{name:"Shadow's Chosen",level:0,maxLevel:-1,requires:["shadow"],cost:[75,75,1.1],texture:{sprite:"moonicons",tile:20}},runes3:{name:"Corrupted Runes",level:0,maxLevel:-1,requires:["runelands"],cost:[400,200,1.1],texture:{sprite:"moonicons",tile:8}},soulbound:{name:"Soulbound",level:0,maxLevel:-1,requires:["blackirongear"],cost:[250,100,1.1],texture:{sprite:"moonicons",tile:21}},discovery:{name:"Discovery",level:0,maxLevel:-1,requires:["farstrider"],cost:[100,50,1.2],texture:{sprite:"moonicons",tile:16}},crownlands:{name:"Crown Lands",level:0,maxLevel:-1,requires:["discovery"],cost:[60,25,1.2],texture:{sprite:"moonicons",tile:18}},mysticcauldron:{name:"Mystic Cauldron",level:0,maxLevel:-1,requires:["moonwine"],cost:[45,55,1.2],texture:{sprite:"moonicons",tile:23}},shadow3:{name:"Shadow's Harvest",level:0,maxLevel:-1,requires:["shadow2"],cost:[45,55,1.2],texture:{sprite:"moonicons",tile:31}},strtrinket:{name:"Shadow Wolf Charm",level:0,maxLevel:8,requires:["metal"],cost:[100,0,2],texture:{sprite:"moonicons",tile:32}},dextrinket:{name:"Moonlight Circlet",level:0,maxLevel:8,requires:["leather"],cost:[100,0,2],texture:{sprite:"moonicons",tile:32}},agitrinket:{name:"Moon Treads",level:0,maxLevel:8,requires:["fiber"],cost:[100,0,2],texture:{sprite:"moonicons",tile:32}},endtrinket:{name:"Moonstone",level:0,maxLevel:8,requires:["stone"],cost:[100,0,2],texture:{sprite:"moonicons",tile:32}},rectrinket:{name:"Dreamlight Bracer",level:0,maxLevel:8,requires:["wood"],cost:[100,0,2],texture:{sprite:"moonicons",tile:32}},deftrinket:{name:"Shadow Veil",level:0,maxLevel:8,requires:["crystal"],cost:[100,0,2],texture:{sprite:"moonicons",tile:32}},acctrinket:{name:"Nightmare Pendant",level:0,maxLevel:8,requires:["gold"],cost:[100,0,2],texture:{sprite:"moonicons",tile:32}},nightlabour:{name:"Night Labour",level:0,maxLevel:-1,requires:["heropouch"],cost:[100,25,1.5],texture:{sprite:"moonicons",tile:9}}},this.challenges={time:{name:"A Matter of Years",completions:0,maxCompletions:5,unlocked:!0,fastestTime:0},forge:{name:"Forged Ahead",completions:0,maxCompletions:5,unlocked:!1,fastestTime:0},explore:{name:"Giant Lands",completions:0,maxCompletions:5,unlocked:!1,fastestTime:0},buildings:{name:"Lazy Townsfolk",completions:0,maxCompletions:5,unlocked:!1,fastestTime:0},talent:{name:"Talentless",completions:0,maxCompletions:5,unlocked:!1,fastestTime:0},megamonsters:{name:"Mega Monsters",completions:0,maxCompletions:5,unlocked:!1,fastestTime:0},outcast:{name:"Outcast",completions:0,maxCompletions:5,unlocked:!1,fastestTime:0}},Je.instance=this),Je.instance}static getInstance(){return Je.instance?Je.instance:new Je}static getMoonlightEarned(e,t){return Math.floor(e*Math.pow(Ye,t))}getChallengeFromName(e){switch(e){case"A Matter of Years":return this.challenges.time;case"Forged Ahead":return this.challenges.forge;case"Giant Lands":return this.challenges.explore;case"Lazy Townsfolk":return this.challenges.buildings;case"Talentless":return this.challenges.talent;case"Mega Monsters":return this.challenges.megamonsters}}getShadowBonus(){return 1+.1*this.moonperks.shadow.level}getMoteSoftCap(){return re+40*this.moonperks.blackirongear.level}_haveMoonlightRequirements(e){for(var t=0;t<e.requires.length;t++)if(0===this.moonperks[e.requires[t]].level)return!1;return!0}levelUpPerk(e){if(!(e.level>=e.maxLevel&&-1!==e.maxLevel)){var t=Math.floor((e.cost[0]+e.cost[1]*e.level)*Math.pow(e.cost[2],e.level));this.moonlight<t||!1===this._haveMoonlightRequirements(e)||(this.moonlight-=t,e.level+=1)}}save(){var e=[];for(const t in this.moonperks)e.push([t,this.moonperks[t].level]);var t=[];for(const e in this.challenges)t.push([e,this.challenges[e].completions,this.challenges[e].unlocked,this.challenges[e].fastestTime]);return{ml:this.moonlight,mp:e,cp:this.challengePoints,c:t}}load(e,t){this.moonlight=e.ml;for(var i=0;i<e.mp.length;i++)void 0!==this.moonperks[e.mp[i][0]]&&(this.moonperks[e.mp[i][0]].level=e.mp[i][1]);this.challengePoints=e.cp;for(i=0;i<e.c.length;i++)this.challenges[e.c[i][0]].completions=e.c[i][1],this.challenges[e.c[i][0]].unlocked=e.c[i][2],this.challenges[e.c[i][0]].fastestTime=e.c[i][3]}}class Ze{constructor(){return Ze.instance||(this.unlocks={gearTab:!1,exploreTab:!1,combatTab:!1,townTab:!1,talentsTab:!1,worldTab:!1,infuseUI:!1,resourceUI:!1,craftingUI:!1,buildings:!1,motes:!1,runes:!1},this.exploreUnlocks=[{count:1,text:"Well that's everything I can see in this area. If I want to keep searching I'll need to leave this weirdly square land and find another square to explore. You think you saw a town in the distance towards the north, but you could be seeing things."},{count:5,text:"You've seen a lot of what this world has to offer by now, and most of it wants to kill you. The people in the town seem nice though, and many of them have been wanting some way to help out. With the lands sort of safe to walk again they can get back to working.\n\nThe only problem is they don't have anything to build with so they want you to bring them some from the monsters you've been killing."},{count:10,text:"Your surprised at how easy this has been going. Sure, every day is a new battle for your life against horrible shadow monsters, but the tile's you've cleared seem way more vibrant and full of life.\n\nSome of the townsfolk have been worried that the mists will return but the odds of that happening have got to be astronomically low. Just to get them off your back you told them to give you some kind of alert on the Region tab if something goes wrong. Hah! Like that will ever happen."},{count:30,text:"From what the townsfolk have told me there's a barrier preventing people from leaving this region. I wonder what happens after I explore every tile there is to explore?"},{count:70,text:"How many years has it been since I started this journey? All the days sort of melt together into one long blur of monster slaying. You swear it's only been like, 1, 2 days tops though."}],this.killUnlocks=[{count:1,text:"What the hell was that? It looked like a normal beast, but like, made of shadows? Is this whole land filled with these monsters?"},{count:5,text:"You're starting to get the hang of this, although your starting to wonder what happened to the previous owner of this gear..."},{count:100,text:"You did it, you've killed your 100th monster. This accomplishment fills you with pride for a moment before you shrug and move onto the next one."}],this.shadeUnlocks=[{count:50,text:"These strange monsters have been leaving behind these shadowy.. things. I think I'll call them shade. It's strange, but I'm pretty sure it wants me to do something with it."},{count:400,text:"Now that I've collected enough of this shade stuff, I think I can do something even better with it, I just need enough of it all in one place."},{count:5e3,text:"I've found a load of this shade stuff, where is it all coming from?"}],this.resourceUnlocks=[{count:25,text:"I've noticed some monsters leave behind more than just shadows. things like wood, stone and metal.... Definitely things they shouldn't have inside them. You have enough now that you could try and improve your gear with them. Slapping some metal onto the end of your sword should do the trick."},{count:100,text:"You have so many resources your not sure what to do with them. Maybe its time to try your hand at making some new gear? You've strapped enough garbage around your broken sword that it's more of a club now then anyhting. You don't have a forge or tools, but it can't be harder than upgrading your gear."},{count:1e3,text:"So let me get this straight. It costs, what, 30-40 resources to craft a sword, but hundreds to make it a little sharper? The townsfolk assure me this is normal, but I'm starting to think they just want me to bring them free resources."}],this.statPointUnlocks=[{count:1,text:"You finally got enough of that shade to try something. You grab a handful of the stuff and try squeezing it into a ball only to find it slip from your hands and enter your chest! You look around and see '+1 Stat Point' appear above your head. You're not sure what that means, but you feel stronger than you did before! You're pretty sure you'll need even more shade to do this again, but at least you found one use for it."},{count:25,text:"You're not entirely sure what this shade is doing, but boy do you feel strong!"},{count:50,text:"You've been infusing a lot of shade lately, is there a limit to how much your body can take?"},{count:100,text:"doesn't seem like it. At least 100 isn't the limit."},{count:300,text:"I've lost count. By all measures my abilities shouldn't be humanly possible, yet I'm still finding monsters stronger than me."}],this.deathUnlocks=[{count:1,text:"It was bound to happen eventually, you're not exactly adventurer material. You open your eyes, wondering where the next stage of existence will take you... and it looks like, wilderness? Wait a minute, you know this place! This is where you died! Or not? You pick yourself up and dust off your clothes, turns out your injuries aren't as bad as you thought.\n\nLooking over your gear it seems you lost some of your shade, is that what those things were after?"},{count:5,text:"I guess I should be happy these things aren't killing me, but getting knocked out this many times can't be good for me."},{count:12,text:"I feel like I'm not paying enough attention, wandering around thinking about what I should do next, how my gear is doing, then suddenly BAM! Ambushed by a literal whale and knocked unconscious."}],this.loreUnlocks={},this.loreTexts={},this.exploresUnlocked=0,this.killsUnlocked=0,this.shadesUnlocked=0,this.resourceUnlocked=0,this.statPointUnlocked=0,this.deathUnlocked=0,this.counts={tilesExplored:0,monsterKills:0,shadeGained:0,resourcesGained:0,statPointsGained:0,deaths:0},this.persistentUnlocks={challenges:!1,autoExplore:!1},this.totalCounts={tilesExplored:0,monsterKills:0,shadeGained:0,resourcesGained:0,statPointsGained:0,deaths:0,timesGated:0},this.onUnlockHandlers=[],Ze.instance=this),Ze.instance}static getInstance(){return Ze.instance?Ze.instance:new Ze}rebirth(){this.unlocks={gearTab:!1,exploreTab:!1,combatTab:!1,townTab:!1,talentsTab:Je.getInstance().challenges.talent.completions>0,worldTab:!1,infuseUI:!1,resourceUI:!1,craftingUI:!1,buildings:!1,motes:!1,runes:!1},this.exploresUnlocked=0,this.killsUnlocked=0,this.shadesUnlocked=0,this.resourceUnlocked=0,this.statPointUnlocked=0,this.deathUnlocked=0,this.counts={tilesExplored:0,monsterKills:0,shadeGained:0,resourcesGained:0,statPointsGained:0,deaths:0},this.totalCounts.timesGated+=1,this.persistentUnlocks.autoExplore=!0}_onUnlock(e,t,i){for(var s=0;s<this.onUnlockHandlers.length;s++)this.onUnlockHandlers[s](e,t,i)}addOnUnlockHandler(e){this.onUnlockHandlers.push(e)}registerTileExplored(){this.counts.tilesExplored+=1,this.totalCounts.tilesExplored+=1;for(var e=this.exploresUnlocked;e<this.exploreUnlocks.length;e++)this.exploreUnlocks[e].count<=this.counts.tilesExplored&&(this._onUnlock(f,this.exploreUnlocks[e].count,this.exploreUnlocks[e].text),this.exploresUnlocked=e+1)}registerMonsterKill(){this.counts.monsterKills+=1,this.totalCounts.monsterKills+=1;for(var e=this.killsUnlocked;e<this.killUnlocks.length;e++)this.killUnlocks[e].count<=this.counts.monsterKills&&(this._onUnlock(x,this.killUnlocks[e].count,this.killUnlocks[e].text),this.killsUnlocked=e+1)}registerShadeGain(e){this.counts.shadeGained+=e,this.totalCounts.shadeGained+=e;for(var t=this.shadesUnlocked;t<this.shadeUnlocks.length;t++)this.shadeUnlocks[t].count<=this.counts.shadeGained&&(this._onUnlock(w,this.shadeUnlocks[t].count,this.shadeUnlocks[t].text),this.shadesUnlocked=t+1)}registerResourceGain(e){this.counts.resourcesGained+=Qe.sumList(e),this.totalCounts.resourcesGained+=Qe.sumList(e);for(var t=this.resourceUnlocked;t<this.resourceUnlocks.length;t++)this.resourceUnlocks[t].count<=this.counts.resourcesGained&&(this._onUnlock(k,this.resourceUnlocks[t].count,this.resourceUnlocks[t].text),this.resourceUnlocked=t+1)}registerStatPointGain(e){this.counts.statPointsGained+=e,this.totalCounts.statPointsGained+=e;for(var t=this.statPointUnlocked;t<this.statPointUnlocks.length;t++)this.statPointUnlocks[t].count<=this.counts.statPointsGained&&(this._onUnlock(T,this.statPointUnlocks[t].count,this.statPointUnlocks[t].text),this.statPointUnlocked=t+1)}registerDeath(e){this.counts.deaths+=e,this.totalCounts.deaths+=e;for(var t=this.deathUnlocked;t<this.deathUnlocks.length;t++)this.deathUnlocks[t].count<=this.counts.deaths&&(this._onUnlock(C,this.deathUnlocks[t].count,this.deathUnlocks[t].text),this.deathUnlocked=t+1)}registerLore(e){void 0!==this.loreUnlocks[e]&&!1===this.loreUnlocks[e]&&(this._onUnlock(v,0,this.loreTexts[e]),this.loreUnlocks[e]=!0)}registerFeatureUnlocked(e,t){switch(e){case n:this.unlocks.gearTab=!0;break;case o:this.unlocks.exploreTab=!0;break;case h:this.unlocks.combatTab=!0;break;case l:this.unlocks.townTab=!0;break;case p:this.unlocks.talentsTab=!0;break;case c:this.unlocks.infuseUI=!0;break;case d:this.unlocks.resourceUI=!0;break;case u:this.unlocks.craftingUI=!0;break;case g:this.unlocks.buildings=!0;break;case y:this.unlocks.motes=!0;break;case m:this.unlocks.worldTab=!0;break;case b:this.unlocks.runes=!0}this._onUnlock(e,0,t)}save(){return{un:this.unlocks,eun:this.exploresUnlocked,kun:this.killsUnlocked,sun:this.shadesUnlocked,run:this.resourceUnlocked,stun:this.statPointUnlocked,dun:this.deathUnlocked,count:this.counts,tcount:this.totalCounts,pun:this.persistentUnlocks}}load(e,t){this.unlocks=e.un,this.exploresUnlocked=e.eun,this.killsUnlocked=e.kun,this.shadesUnlocked=e.sun,this.resourceUnlocked=e.run,this.statPointUnlocked=e.stun,this.deathUnlocked=e.dun,this.counts=e.count,this.totalCounts=e.tcount,this.persistentUnlocks=e.pun}}class $e{constructor(){this.stats={strength:5,dexterity:5,agility:5,endurance:5,recovery:5,defense:5,accuracy:5,hit:40,evasion:40,critPower:25,critResistance:25},this.statBonuses={health:0,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:0,recovery:0,defense:0,accuracy:0,hit:0,evasion:0,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:0},this.hitAnim="claws",this.critAnim="clawscrit",this.level=0,this.currentHealth=25,this.attackCooldown=0,this.attackSpeed=1500,this.stunTimer=0,this.name="",this.xpReward=0,this.drops=[],this.motes=0,this.icon={sprite:"enemyicons",tile:8},this.traits=[],this.shieldValue=0,this.shieldCooldown=0,this.healthChangedHandlers=[],this.attackCooldownChangedHandlers=[]}MaxHealth(){var e=this.statBonuses.health+this.Endurance()*W;return Math.floor(e)}Strength(){var e=this.stats.strength+this.statBonuses.strength;return Math.floor(e)}Dexterity(){var e=this.stats.dexterity+this.statBonuses.dexterity;return Math.floor(e)}Agility(){var e=this.stats.agility+this.statBonuses.agility;return Math.floor(e)}Endurance(){var e=this.stats.endurance+this.statBonuses.endurance;return Math.floor(e)}Recovery(){var e=this.stats.recovery+this.statBonuses.recovery;return Math.floor(e)}Defense(){var e=this.stats.defense+this.statBonuses.defense;return Math.floor(e)}Accuracy(){var e=this.stats.accuracy+this.statBonuses.accuracy;return Math.floor(e)}Hit(){var e=this.stats.hit+this.statBonuses.hit+this.Dexterity()*U;return Math.floor(e)}Evasion(){var e=this.stats.evasion+this.statBonuses.evasion+this.Agility()*F;return Math.floor(e)}CritChance(){var e=this.statBonuses.critChance;return Math.floor(100*e)/100}CritPower(){var e=this.stats.critPower+this.statBonuses.critPower+this.Accuracy()*X;return Math.floor(e)}CritResistance(){var e=this.stats.critResistance+this.statBonuses.critResistance+this.Endurance()*K;return e*=this.shieldValue>0?10:1,Math.floor(e)}DamageMin(){var e=this.statBonuses.damageMin+this.Strength()*G;return Math.floor(Math.max(1,e))}DamageMax(){var e=this.statBonuses.damageMax+this.Strength()*O;return Math.floor(Math.max(1,e))}HealthRegen(){var e=this.statBonuses.healthRegen+this.Recovery()*Y;return Math.floor(10*e)/10}Armor(){var e=this.Defense()*N+this.statBonuses.armor*(1+this.Defense()*V);return Math.floor(e)}AttackSpeed(){return this.attackSpeed}CritDamage(e){return Math.max(1,1+.5*(Math.sqrt(this.CritPower())/Math.sqrt(e)-.5))}registerEvent(e,t){"onHealthChanged"===e?this.healthChangedHandlers.push(t):"onAttackCooldownChanged"===e&&this.attackCooldownChangedHandlers.push(t)}_onHealthChanged(){for(var e=0;e<this.healthChangedHandlers.length;e++)this.healthChangedHandlers[e](this.currentHealth)}_onAttackCooldownChanged(){for(var e=0;e<this.attackCooldownChangedHandlers.length;e++)this.attackCooldownChangedHandlers[e](this.attackCooldown)}canAttack(){return this.attackCooldown>=this.AttackSpeed()}takeDamage(e,t,i=!1){var s=e;if(this.shieldValue>0){var a=Math.min(this.shieldValue,s);this.shieldValue-=a,s-=a}return!1===i&&(s=Math.max(1,s-this.Armor())),this.currentHealth-=s,this._onHealthChanged(),s}rollDamage(){return Qe.randint(this.DamageMin(),this.DamageMax()+1)}tickRegen(e,t=!0){var i=this.currentHealth;this.currentHealth=Math.min(this.MaxHealth(),this.currentHealth+this.HealthRegen()*(e/1e3)*1);var s=this.findTrait(Se);void 0!==s&&(this.shieldCooldown-=e,this.shieldCooldown<=0&&(this.shieldValue+=this.Armor()*s.level*.2,this.shieldCooldown=1e3,this._onHealthChanged())),i!=this.currentHealth&&this._onHealthChanged()}tickAttackCooldown(e,t){if(this.stunTimer>0)this.stunTimer-=e;else{var i=this.attackCooldown;this.attackCooldown=Math.min(this.attackSpeed,this.attackCooldown+e*t),i!=this.attackCooldown&&this._onAttackCooldownChanged()}}attack(e,t=!1){var i=this.rollDamage();!0===t&&(i*=this.CritDamage(e.CritResistance()));var s=e.takeDamage(i,t);this.attackCooldown=0;var a=this.findTrait(He);return void 0!==a&&Math.random()<1-Math.pow(.92,a.level)&&(this.attackCooldown=this.attackSpeed/2),this._onAttackCooldownChanged(),s}equip(e){var t=e.getStatBonuses();for(const e in t)this.statBonuses[e]+=t[e]}unequip(e){var t=e.getStatBonuses();for(const e in t)this.statBonuses[e]-=t[e]}setMonsterStats(e,t,i,s,a,r,n,o){this.level=a;var h=a-1,l=Math.max(0,h),c=h*J,d=Math.pow(Z,l);this.stats.strength=(this.stats.strength+c)*t.strength*d,this.stats.dexterity=(this.stats.dexterity+c)*t.dexterity*d,this.stats.agility=(this.stats.agility+c)*t.agility*d,this.stats.endurance=(this.stats.endurance+c)*t.endurance*d,this.stats.recovery=(this.stats.recovery+c)*t.recovery*d,this.stats.defense=(this.stats.defense+c)*t.defense*d,this.stats.accuracy=(this.stats.accuracy+c)*t.accuracy*d,this.statBonuses.armor=this.Armor()*(t.armor-1),this.statBonuses.healthRegen=this.HealthRegen()*(t.healthRegen-1),this.statBonuses.damageMin=this.DamageMin()*(t.damageMin-1),this.statBonuses.damageMax=this.DamageMax()*(t.damageMax-1),this.statBonuses.hit=this.Hit()*(t.hit-1),this.statBonuses.evasion=this.Evasion()*(t.evasion-1),this.statBonuses.health=this.MaxHealth()*(t.health-1),this.statBonuses.critChance=s,this.attackSpeed=i,this.attackCooldown=0,this.currentHealth=this.MaxHealth(),this.name=a<1?"Weak "+e:e;var u=r+2*Je.getInstance().moonperks.shadow2.level;this.xpReward=u+u/4*h,this.xpReward=this.xpReward*(1+.05*Je.getInstance().challenges.megamonsters.completions),this.dropBase=n,this.icon=o}findTrait(e){for(var t=0;t<this.traits.length;t++)if(this.traits[t].type===e)return this.traits[t]}applyTraits(){for(var e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:0,recovery:0,defense:0,accuracy:0,hit:0,evasion:0,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:0,xpReward:0,motes:0},t=0;t<this.traits.length;t++){var i=this.traits[t];switch(i.type){case Be:e.strength+=this.Strength()*(.2*i.level),e.dexterity+=this.Dexterity()*(.2*i.level),e.agility+=this.Agility()*(.2*i.level),e.endurance+=this.Endurance()*(.2*i.level),e.recovery+=this.Recovery()*(.2*i.level),e.defense+=this.Defense()*(.2*i.level),e.accuracy+=this.Accuracy()*(.2*i.level),e.xpReward+=this.xpReward*(.75*i.level),e.motes+=i.level+Math.floor(this.level/5);break;case Ie:e.damageMin+=this.DamageMin()*(.1*i.level),e.damageMax+=this.DamageMax()*(.1*i.level),e.health+=this.MaxHealth()*(.25*i.level),this.attackSpeed=1.15*this.attackSpeed;break;case Le:e.evasion+=this.Evasion()*(.25*i.level),this.attackSpeed=.85*this.attackSpeed;break;case De:this.critChance=2*this.critChance,e.damageMin+=this.DamageMin()*(.05*i.level),e.damageMax+=this.DamageMax()*(.05*i.level),e.critPower+=this.CritPower()*(.05*i.level);break;case He:e.hit+=this.Hit()*(.2*i.level),e.healthRegen+=this.HealthRegen()*(.1*i.level)}e.xpReward+=this.xpReward*(1+.01*Je.getInstance().challenges.megamonsters.completions*i.level)}for(const t in this.statBonuses)this.statBonuses[t]+=e[t];this.xpReward+=e.xpReward,this.motes+=e.motes,this.currentHealth=this.MaxHealth()}addTrait(e,t){var i=this.findTrait(e);void 0===i?(i={type:e,level:t},this.traits.push(i)):i.level+=t}}var et={wolf:{name:"Wolf",scaleBlock:{strength:.85,dexterity:1.3,agility:1,endurance:.7,recovery:1,defense:.95,accuracy:1.3,armor:1.5,health:1,healthRegen:1,damageMin:1.27,damageMax:1.3,hit:1,evasion:1.3},attackSpeed:1100,critChance:.3,shadeBase:19,rewardBase:1.9,icon:{sprite:"enemyicons",tile:2}},bear:{name:"Bear",scaleBlock:{strength:1.3,dexterity:.8,agility:.8,endurance:1.4,recovery:1.2,defense:1.25,accuracy:.8,armor:1.8,health:1.2,healthRegen:1,damageMin:.75,damageMax:1.32,hit:1,evasion:1},attackSpeed:1800,critChance:.14,shadeBase:28,rewardBase:2.4,icon:{sprite:"enemyicons",tile:5}},plant:{name:"Plant",scaleBlock:{strength:.85,dexterity:1.2,agility:1.2,endurance:1.2,recovery:1,defense:1,accuracy:1,armor:1.75,health:.8,healthRegen:1.3,damageMin:1,damageMax:1.12,hit:1.2,evasion:1},attackSpeed:1350,critChance:.1,shadeBase:19,rewardBase:2.2,icon:{sprite:"enemyicons",tile:3}},slime:{name:"Slime",scaleBlock:{strength:.875,dexterity:1,agility:1.2,endurance:1,recovery:1.2,defense:.95,accuracy:.8,armor:1.25,health:1,healthRegen:2.3,damageMin:1,damageMax:1.1,hit:1,evasion:1.2},attackSpeed:1300,critChance:.1,shadeBase:16,rewardBase:1.8,icon:{sprite:"enemyicons",tile:0}},bloom:{name:"Bloom",scaleBlock:{strength:1,dexterity:1.4,agility:.6,endurance:1,recovery:1.2,defense:1,accuracy:.6,armor:1.55,health:1,healthRegen:1.4,damageMin:1.075,damageMax:1.075,hit:1,evasion:1.2},attackSpeed:1100,critChance:.17,shadeBase:17,rewardBase:2.2,icon:{sprite:"enemyicons",tile:4}},goblin:{name:"Goblin",scaleBlock:{strength:.77,dexterity:1.2,agility:1.6,endurance:.8,recovery:.8,defense:1,accuracy:1.4,armor:1.15,health:1,healthRegen:.8,damageMin:1.275,damageMax:1.375,hit:.9,evasion:1.2},attackSpeed:1300,critChance:.4,shadeBase:15,rewardBase:1.7,icon:{sprite:"enemyicons",tile:12}},formation:{name:"Formation",scaleBlock:{strength:1.1,dexterity:1.1,agility:.8,endurance:1.1,recovery:1.1,defense:1.15,accuracy:1.1,armor:2.9,health:1,healthRegen:1,damageMin:1.15,damageMax:1.15,hit:1.1,evasion:1.1},attackSpeed:1400,critChance:.11,shadeBase:27,rewardBase:2.7,icon:{sprite:"enemyicons",tile:10}},whale:{name:"Whale",scaleBlock:{strength:1.5,dexterity:.85,agility:.55,endurance:1.5,recovery:1.5,defense:.95,accuracy:.8,armor:1.5,health:1.5,healthRegen:1.5,damageMin:1.5,damageMax:1.55,hit:1,evasion:1},attackSpeed:2400,critChance:.1,shadeBase:35,rewardBase:3.5,icon:{sprite:"enemyicons",tile:6}},fish:{name:"Fish",scaleBlock:{strength:.94,dexterity:1.1,agility:1.4,endurance:1,recovery:.8,defense:1.25,accuracy:1,armor:1.4,health:1,healthRegen:1,damageMin:1,damageMax:1.1,hit:1,evasion:1.3},attackSpeed:1200,critChance:.17,shadeBase:19,rewardBase:2,icon:{sprite:"enemyicons",tile:7}},lizard:{name:"Lizard",scaleBlock:{strength:1.54,dexterity:1.4,agility:.7,endurance:1.3,recovery:.6,defense:1.45,accuracy:1,armor:1.95,health:1.3,healthRegen:1,damageMin:1.1,damageMax:1.1,hit:1.1,evasion:1.2},attackSpeed:1700,critChance:.14,shadeBase:33,rewardBase:2.6,icon:{sprite:"enemyicons",tile:13}},gateguardian:{name:"Gate Guardian",scaleBlock:{strength:1.65,dexterity:1.1,agility:.8,endurance:1.5,recovery:1.3,defense:1.1,accuracy:.9,armor:2.7,health:1.2,healthRegen:1,damageMin:1.2,damageMax:1.25,hit:1,evasion:1},attackSpeed:2e3,critChance:.19,shadeBase:44,rewardBase:3.7,icon:{sprite:"enemyicons",tile:9}},elk:{name:"Elk",scaleBlock:{strength:1.15,dexterity:1.5,agility:1.2,endurance:1.2,recovery:.7,defense:1,accuracy:.5,armor:1.65,health:1.15,healthRegen:1,damageMin:1,damageMax:1.15,hit:1,evasion:1},attackSpeed:1600,critChance:.15,shadeBase:22,rewardBase:2,icon:{sprite:"enemyicons",tile:1}},drake:{name:"Drake",scaleBlock:{strength:1.45,dexterity:1.1,agility:1.1,endurance:1.5,recovery:1,defense:1.55,accuracy:1,armor:2,health:1,healthRegen:1,damageMin:1.2,damageMax:1.3,hit:1,evasion:1.2},attackSpeed:1850,critChance:.17,shadeBase:39,rewardBase:3.2,icon:{sprite:"enemyicons",tile:9}},cactus:{name:"Cactus",scaleBlock:{strength:.95,dexterity:1.2,agility:.7,endurance:.9,recovery:1.3,defense:1.45,accuracy:1,armor:2.1,health:1.2,healthRegen:1.5,damageMin:1,damageMax:1.125,hit:1,evasion:.9},attackSpeed:1800,critChance:.31,shadeBase:26,rewardBase:2.1,icon:{sprite:"enemyicons",tile:11}},moss:{name:"Moss",scaleBlock:{strength:1.35,dexterity:1.2,agility:1,endurance:1.2,recovery:1.5,defense:1.9,accuracy:1,armor:1.65,health:1,healthRegen:1.5,damageMin:1.05,damageMax:1.15,hit:1,evasion:.9},attackSpeed:1850,critChance:.21,shadeBase:37,rewardBase:3.5,icon:{sprite:"enemyicons",tile:9}},lion:{name:"Lion",scaleBlock:{strength:1.425,dexterity:.9,agility:1.4,endurance:1.5,recovery:1,defense:1.25,accuracy:1.4,armor:1.5,health:1.3,healthRegen:.9,damageMin:1.25,damageMax:1.45,hit:1,evasion:1.1},attackSpeed:2300,critChance:.21,shadeBase:37,rewardBase:2.5,icon:{sprite:"enemyicons",tile:9}},gnoll:{name:"Gnoll",scaleBlock:{strength:1.15,dexterity:1.5,agility:1.2,endurance:1.1,recovery:.5,defense:1.15,accuracy:1.2,armor:2.2,health:1.1,healthRegen:1,damageMin:1.15,damageMax:1.25,hit:1,evasion:1},attackSpeed:1450,critChance:.1,shadeBase:28,rewardBase:2.7,icon:{sprite:"enemyicons",tile:9}},coyote:{name:"Coyote",scaleBlock:{strength:1,dexterity:1.5,agility:1.4,endurance:1,recovery:1,defense:1,accuracy:1.6,armor:1.45,health:1.1,healthRegen:1,damageMin:1.15,damageMax:1.2,hit:1.1,evasion:1},attackSpeed:1300,critChance:.25,shadeBase:28,rewardBase:2.1,icon:{sprite:"enemyicons",tile:9}},catfish:{name:"Catfish",scaleBlock:{strength:1.25,dexterity:1.1,agility:1.7,endurance:1,recovery:1,defense:1.25,accuracy:1.3,armor:1.3,health:1,healthRegen:1,damageMin:.95,damageMax:1.175,hit:1.2,evasion:1},attackSpeed:1250,critChance:.27,shadeBase:26,rewardBase:2.2,icon:{sprite:"enemyicons",tile:9}},lootgoblin:{name:"Loot Goblin",scaleBlock:{strength:.77,dexterity:1.2,agility:1.6,endurance:.9,recovery:.9,defense:1,accuracy:1.15,armor:1.5,health:1.4,healthRegen:.8,damageMin:1.275,damageMax:1.375,hit:.9,evasion:1.2},attackSpeed:1400,critChance:.4,shadeBase:125,rewardBase:15,icon:{sprite:"enemyicons",tile:14}}};class tt{static GetCreatureByName(e,t){var i=new $e;return i.setMonsterStats(et[e].name,et[e].scaleBlock,et[e].attackSpeed,et[e].critChance,t,et[e].shadeBase,et[e].rewardBase,et[e].icon),i}}class it extends $e{constructor(e){super(),this.player=e,this.moonData=new Je,this.secondWindCooldown=0,this.secondWindDuration=0,this.hitCounter=0,this.encounterCounter=0}rebirth(){this.stats={strength:5+this.moonData.moonperks.str.level,dexterity:5+this.moonData.moonperks.dex.level,agility:5+this.moonData.moonperks.agi.level,endurance:5+this.moonData.moonperks.end.level,recovery:5+this.moonData.moonperks.rec.level,defense:5+this.moonData.moonperks.def.level,accuracy:5+this.moonData.moonperks.acc.level,hit:40,evasion:40,critPower:25,critResistance:25},this.statBonuses={health:0,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:0,recovery:0,defense:0,accuracy:0,hit:0,evasion:0,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:0},this.hitAnim="claws",this.critAnim="clawscrit",this.level=0,this.currentHealth=25,this.attackCooldown=0,this.secondWindCooldown=0,this.secondWindDuration=0,this.hitCounter=0,this.encounterCounter=0}MaxHealth(){var e=this.statBonuses.health+this.Endurance()*W;return e+=this.Endurance()*this.player.getTalentLevel("end"),e+=e*this.player.runeBonuses.healthPercent,Math.floor(e)}Strength(){var e=this.stats.strength+this.statBonuses.strength+this.player.runeBonuses.strFlat;return e*=1+.01*(this.moonData.moonperks.str.level+Je.getInstance().challengePoints),e+=e*(this.player.runeBonuses.strPercent+this.player.runeBonuses.allPercent),e+=this.Dexterity()*this.player.runeBonuses.dexToStr,Math.floor(e)}Dexterity(){var e=this.stats.dexterity+this.statBonuses.dexterity+this.player.runeBonuses.dexFlat;return e*=1+.01*(this.moonData.moonperks.dex.level+Je.getInstance().challengePoints),e+=e*(this.player.runeBonuses.dexPercent+this.player.runeBonuses.allPercent),Math.floor(e)}Agility(){var e=this.stats.agility+this.statBonuses.agility+this.player.runeBonuses.agiFlat;return e*=1+.01*(this.moonData.moonperks.agi.level+Je.getInstance().challengePoints),e+=e*(this.player.runeBonuses.agiPercent+this.player.runeBonuses.allPercent),Math.floor(e)}Endurance(){var e=this.stats.endurance+this.statBonuses.endurance+this.player.runeBonuses.endFlat;return e*=1+.01*(this.moonData.moonperks.end.level+Je.getInstance().challengePoints),e+=e*(this.player.runeBonuses.endPercent+this.player.runeBonuses.allPercent),Math.floor(e)}Recovery(){var e=this.stats.recovery+this.statBonuses.recovery+this.player.runeBonuses.recFlat;return e*=1+.01*(this.moonData.moonperks.rec.level+Je.getInstance().challengePoints),e+=e*(this.player.runeBonuses.recPercent+this.player.runeBonuses.allPercent),e+=this.Endurance()*this.player.runeBonuses.endToRec,Math.floor(e)}Defense(){var e=this.stats.defense+this.statBonuses.defense+this.player.runeBonuses.defFlat;return e*=1+.01*(this.moonData.moonperks.def.level+Je.getInstance().challengePoints),e+=e*(this.player.runeBonuses.defPercent+this.player.runeBonuses.allPercent),e+=this.Agility()*this.player.runeBonuses.agiToDef,Math.floor(e)}Accuracy(){var e=this.stats.accuracy+this.statBonuses.accuracy+this.player.runeBonuses.accFlat;return e*=1+.01*(this.moonData.moonperks.acc.level+Je.getInstance().challengePoints),e+=e*(this.player.runeBonuses.accPercent+this.player.runeBonuses.allPercent),Math.floor(e)}Hit(){var e=this.stats.hit+this.statBonuses.hit+this.Dexterity()*U;return e+=this.Dexterity()*this.player.getTalentLevel("dex"),e*=1+.04*this.player.getTalentLevel("hit"),e+=e*this.player.runeBonuses.hitPercent,Math.floor(e)}Evasion(){var e=this.stats.evasion+this.statBonuses.evasion+this.Agility()*F;return e+=this.Agility()*this.player.getTalentLevel("agi"),e*=1+.04*this.player.getTalentLevel("evasion"),e+=e*this.player.runeBonuses.evaPercent,Math.floor(e)}CritChance(){var e=this.statBonuses.critChance;return e+=.01*this.player.getTalentLevel("crit"),e+=this.player.runeBonuses.critChance,Math.floor(100*e)/100}CritResistance(){var e=this.stats.critResistance+this.statBonuses.critResistance+this.Endurance()*K;return Math.floor(e)}CritPower(){var e=this.stats.critPower+this.statBonuses.critPower+this.Accuracy()*X;return e+=this.Accuracy()*this.player.getTalentLevel("acc")*.5,e+=e*this.player.runeBonuses.critPercent,Math.floor(e)}DamageMin(){var e=this.statBonuses.damageMin*(1+this.player.runeBonuses.weaponPercent)*(1+Math.pow(this.Strength(),Q+this.player.runeBonuses.weaponScaling)*q)+this.Strength()*G;return e+=this.Strength()*this.player.getTalentLevel("str")*.07*G,Math.floor(Math.max(1,e))}DamageMax(){var e=this.statBonuses.damageMax*(1+this.player.runeBonuses.weaponPercent)*(1+Math.pow(this.Strength(),Q+this.player.runeBonuses.weaponScaling)*q)+this.Strength()*O;return e+=this.Strength()*this.player.getTalentLevel("str")*.07*O,Math.floor(Math.max(1,e))}HealthRegen(){var e=this.statBonuses.healthRegen+this.Recovery()*Y;return e+=this.Recovery()*this.player.getTalentLevel("rec")*.08*Y,e+=e*this.player.runeBonuses.regenPercent,Math.floor(10*e)/10}Armor(){var e=this.Defense()*N+this.statBonuses.armor*(1+this.player.runeBonuses.armorPercent)*(1+Math.pow(this.Defense(),Q+this.player.runeBonuses.armorScaling)*V);return e+=this.Defense()*this.player.getTalentLevel("def")*.13*N,Math.floor(e)}AttackSpeed(){return this.attackSpeed/(1+this.player.runeBonuses.baseAttackSpeed)}takeDamage(e,t,i=!1){if(this.player.getTalentLevel("dodge")>0&&(this.hitCounter-=1,this.hitCounter<=0))return this.hitCounter=he-this.player.getTalentLevel("dodge"),0;var s=e;return!0===t&&(s*=Math.pow(.92,this.player.runeBonuses.enemyCrit),s=Math.max(2,s-.05*this.Endurance()*this.player.getTalentLevel("resilient"))),Math.random()<.05*this.player.getTalentLevel("parry")&&(s/=2),Math.random()<=.2&&(s=Math.max(1,s-this.Armor()*(.25*this.player.getTalentLevel("block")))),s=super.takeDamage(s,t,i),this.player.getTalentLevel("secondwind")>0&&this.secondWindCooldown<=0&&this.currentHealth<this.MaxHealth()/2&&(this.secondWindDuration=1e4,this.secondWindCooldown=oe-1e4*this.player.getTalentLevel("secondwind")),this.currentHealth<=0&&this.player.getTalentLevel("defydeath")>0&&this.encounterCounter<=0&&(this.currentHealth=1,this.encounterCounter=le-this.player.getTalentLevel("defydeath")),s}tickRegen(e,t=!0){var i=this.currentHealth,s=1,a=this.HealthRegen();!1===t&&(a+=this.player.runeBonuses.OOCRegen,s=1+.25*this.player.getTalentLevel("quickrecovery")),this.secondWindDuration>0&&(this.secondWindDuration-=e,s*=3),this.currentHealth=Math.min(this.MaxHealth(),this.currentHealth+a*(e/1e3)*s),i!=this.currentHealth&&this._onHealthChanged()}heal(e){this.currentHealth=Math.min(this.MaxHealth(),this.currentHealth+e)}attack(e,t=!1){Math.random()<.05*this.player.getTalentLevel("stun")&&(e.stunTimer=500);var i=this.rollDamage();!0===t&&(i*=this.CritDamage(e.CritResistance()),Math.random()<.01*this.player.getTalentLevel("doublecrit")*this.CritChance()&&(i*=2));var s=e.takeDamage(i,t);return this.attackCooldown=0,Math.random()<.05*this.player.getTalentLevel("followthrough")&&(this.attackCooldown=this.AttackSpeed()/2),this._onAttackCooldownChanged(),s}cleave(e,t=!1){Math.random()<.05*this.player.getTalentLevel("stun")&&(e.stunTimer=500);var i=this.Strength()*this.player.getTalentLevel("cleave")*.2;return!0===t&&(i*=this.CritDamage(e.CritResistance()),Math.random()<.01*this.player.getTalentLevel("doublecrit")*this.CritChance()&&(i*=2)),e.takeDamage(i,t)}save(){return{stat:this.stats,ha:this.hitAnim,ca:this.critAnim,chp:this.currentHealth,acd:this.attackCooldown}}load(e,t){this.stats=e.stat,this.hitAnim=e.ha,this.critAnim=e.ca,this.currentHealth=e.chp,this.attackCooldown=e.acd}}var st={Tyr:{dropRate:30,getBonus:e=>({weaponPercent:.03*e}),Eld:{Tak:{getBonus:e=>({strTalents:e,strPercent:.05*e,weaponScaling:.01*e})}}},Vel:{dropRate:30,getBonus:e=>({evaPercent:.04*e})},El:{dropRate:30,getBonus:e=>({hitPercent:.04*e}),Run:{Est:{getBonus:e=>({dexTalents:e,dexPercent:.05*e,baseAttackSpeed:.05*e})}}},Ley:{dropRate:30,getBonus:e=>({regenPercent:.04*e}),Eld:{Quil:{getBonus:e=>({recTalents:e,recPercent:.05*e,OOCRegen:7*e})}}},Kor:{dropRate:30,getBonus:e=>({armorPercent:.05*e})},Sok:{dropRate:30,getBonus:e=>({critPercent:.05*e}),Ryn:{Zel:{getBonus:e=>({accTalents:e,accPercent:.05*e,critScaling:.01*e})}}},Ber:{dropRate:30,getBonus:e=>({healthPercent:.03*e}),Eld:{Urd:{getBonus:e=>({endTalents:e,endPercent:.05*e,healthPercent:.1*e})}},Zel:{Kor:{getBonus:e=>({healthPercent:.1*e,critChance:.01*e})}},Ryn:{Zel:{Sok:{getBonus:e=>({enemyCrit:e,endPercent:.05*e,accPercent:.05*e})}}}},Eid:{dropRate:30,getBonus:e=>({exploreSpeed:.15*e}),Eld:{getBonus:e=>({friendshipMulti:e})}},Ryn:{dropRate:15,getBonus:e=>({critChance:.01*e})},Eld:{dropRate:15,getBonus:e=>({lootFlat:e}),Rath:{getBonus:e=>({moteChance:.005*e})},Ryn:{getBonus:e=>({lootTalent:5*e})}},Rath:{dropRate:15,getBonus:e=>({shadeFlat:10*e})},Run:{dropRate:15,getBonus:e=>({baseAttackSpeed:.05*e})},Chel:{dropRate:15,getBonus:e=>({dexToStr:.01*e}),Mal:{Myr:{getBonus:e=>({allPercent:.03*e})}},Rath:{getBonus:e=>({governanceTalent:2*e})}},Mal:{dropRate:15,getBonus:e=>({endToRec:.01*e}),Eid:{getBonus:e=>({agilityScaling:.01*e})}},Myr:{dropRate:15,getBonus:e=>({agiToDef:.01*e}),Eid:{getBonus:e=>({guardianTalent:2*e})}},Tak:{dropRate:50,getBonus:e=>({strFlat:5*e})},Est:{dropRate:50,getBonus:e=>({dexFlat:5*e})},Lem:{dropRate:50,getBonus:e=>({agiFlat:5*e}),Run:{Vel:{getBonus:e=>({agiTalents:e,agiPercent:.05*e,evaPercent:.1*e})}}},Urd:{dropRate:50,getBonus:e=>({endFlat:5*e})},Lah:{dropRate:50,getBonus:e=>({defFlat:5*e}),Eld:{Kor:{getBonus:e=>({defTalents:e,defPercent:.05*e,armorScaling:.01*e})}}},Quil:{dropRate:50,getBonus:e=>({recFlat:5*e}),Ley:{Lah:{getBonus:e=>({regenOnKill:e})}}},Zel:{dropRate:50,getBonus:e=>({accFlat:5*e})}};class at{static getRuneTexture(e){switch(e){case"Tyr":return{sprite:"runeicons",tile:1};case"Vel":return{sprite:"runeicons",tile:2};case"El":return{sprite:"runeicons",tile:3};case"Ley":return{sprite:"runeicons",tile:4};case"Kor":return{sprite:"runeicons",tile:5};case"Sok":return{sprite:"runeicons",tile:6};case"Ber":return{sprite:"runeicons",tile:7};case"Eid":return{sprite:"runeicons",tile:8};case"Ryn":return{sprite:"runeicons",tile:9};case"Eld":return{sprite:"runeicons",tile:10};case"Rath":return{sprite:"runeicons",tile:11};case"Run":return{sprite:"runeicons",tile:12};case"Tak":return{sprite:"runeicons",tile:13};case"Est":return{sprite:"runeicons",tile:14};case"Lem":return{sprite:"runeicons",tile:15};case"Urd":return{sprite:"runeicons",tile:16};case"Lah":return{sprite:"runeicons",tile:17};case"Quil":return{sprite:"runeicons",tile:18};case"Zel":return{sprite:"runeicons",tile:19};case"Chel":return{sprite:"runeicons",tile:20};case"Mal":return{sprite:"runeicons",tile:21};case"Myr":return{sprite:"runeicons",tile:22}}return{sprite:"runeicons",tile:0}}static getBonusForRune(e){return void 0!==st[e.word]&&void 0!==st[e.word].getBonus?st[e.word].getBonus(e.level):{}}static getUpgradeCost(e){return Math.round((100+200*Math.floor(Math.pow(e.level-1,1.5)))*Math.pow(.93,Je.getInstance().moonperks.runes3.level))}static getSellCost(e){return Math.round(.2*(100+200*Math.floor(Math.pow(e.level-1,1.5))))}static getRandomRuneAtLevel(e){var t=Qe.randint(0,670);for(const i in st){if(t<=st[i].dropRate)return{word:i,level:e};t-=st[i].dropRate}return{word:"Tak",level:e}}static getRuneWordsAndBonuses(e){for(var t=[],i=0;i<e.length;){for(var s=-1,a=st,r=void 0,n=i;n<e.length&&void 0!==a[e[n].word];n++)void 0!==a[e[n].word].getBonus&&(s=n,r=a[e[n].word].getBonus),a=a[e[n].word];if(-1!==s){var o="",h=0;for(n=i;n<=s;n++)o+=e[n].word,h+=e[n].level;h=Math.floor(h/(s-i+1)),t.push({word:o,level:h,bonus:r(h)}),i=s+1}else i+=1}return t}}class rt{constructor(e,t,i,s,a,r){this.tier=t,this.slotType=i,this.name=e,this.statBonuses=s,this.statsPerLevel={critChance:0},this._totalBonuses=s,this.level=0,this.costs=a,this.costsPerLevel=r,this.motesFused=0,this.runes=[],this.compiledRunes=[],this._runeBonuses={};for(const e in this.statBonuses)"critChance"!==e&&(this.statsPerLevel[e]=.25*this.statBonuses[e]);for(var n=0;n<E[t];n++)this.runes.push({word:"Empty",level:0})}bringToLevel(e){for(var t=this.level;t<e;t++){if(t-1>=0)for(const e in this.statBonuses)this.statBonuses[e]+=this.statsPerLevel[e]*Math.ceil((t+1)/5);for(var i=0;i<this.costs.length;i++)this.costs[i]+=this.costsPerLevel[i]*(t+1)}this.level=e,this._calculateStats()}getMotePower(){var e=Je.getInstance().getMoteSoftCap();return(Math.min(e,this.motesFused)+Math.pow(Math.max(0,this.motesFused-e),ne))*ae}_calculateStats(){this._totalBonuses={};var e=1+this.getMotePower();for(const t in this.statBonuses)0!==this.statBonuses[t]&&(this._totalBonuses[t]=this.statBonuses[t]>0?this.statBonuses[t]*e:this.statBonuses[t])}_calculateRuneBonuses(){this.compiledRunes=at.getRuneWordsAndBonuses(this.runes),this._runeBonuses={};for(var e=0;e<this.compiledRunes.length;e++)for(const t in this.compiledRunes[e].bonus)void 0===this._runeBonuses[t]&&(this._runeBonuses[t]=0),this._runeBonuses[t]+=this.compiledRunes[e].bonus[t]}fuseMotes(e){this.motesFused+=e,this._calculateStats()}destroyRune(e){e<0||e>=this.runes.length||(this.runes[e]={word:"Empty",level:0},this._calculateRuneBonuses())}addRune(e,t){t<0||t>=this.runes.length||(this.runes[t]=e,this._calculateRuneBonuses())}getStatBonuses(){return this._totalBonuses}getRuneBonuses(){return this._runeBonuses}save(){return{lv:this.level,mote:this.motesFused,rn:this.runes}}load(e,t){this.motesFused=e.mote,this.runes=void 0===e.rn?[]:e.rn,this.bringToLevel(e.lv),this._calculateRuneBonuses()}}class nt{constructor(){return nt.instance||(this.gear=[],this._initGear(),nt.instance=this),nt.instance}static getInstance(){return nt.instance?nt.instance:new nt}save(){for(var e=[],t=0;t<this.gear.length;t++)e.push(this.gear[t].save());return{gear:e,ta:this.tiersAvailable}}load(e,t){for(var i=0;i<e.gear.length;i++)this.gear[i].load(e.gear[i],t);this.tiersAvailable=e.ta}rebirth(){this._initGear()}getGearByName(e){for(var t=0;t<this.gear.length;t++)if(this.gear[t].name===e)return this.gear[t]}_isEquipedItem(e){switch(e.slotType){case S:return void 0!==ht.getInstance().weapon&&e.name===ht.getInstance().weapon.name;case H:return void 0!==ht.getInstance().armor&&e.name===ht.getInstance().armor.name;case _:return void 0!==ht.getInstance().trinket&&e.name===ht.getInstance().trinket.name}}upgradeGear(e){for(var t=ht.getInstance(),i=e.tier<=0?1:t.craftingCosts[e.tier-1],s=[],a=0;a<e.costs.length;a++)s.push(e.costs[a]*i);!1!==Qe.canCraft(s,t.resources[Math.max(0,e.tier-1)])&&(t.spendResource(s,Math.max(0,e.tier-1)),this._isEquipedItem(e)?(t.unequip(e.slotType),e.bringToLevel(e.level+1),t.equip(e)):e.bringToLevel(e.level+1))}fuseGear(e,t){var i=ht.getInstance();this._isEquipedItem(e)?(i.unequip(e.slotType),e.fuseMotes(t),i.equip(e)):e.fuseMotes(t),i.addMote(-t)}_initGear(){this.gear=[],this.tiersAvailable=0;var e={health:0,damageMin:1,damageMax:1,strength:0,dexterity:0,agility:0,endurance:0,recovery:0,defense:0,accuracy:0,hit:0,evasion:0,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:0},t=[0,0,0,0,0,0],i=[5,0,10,0,0,0];this.gear.push(new rt("Broken Sword",0,S,e,t,i));e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:0,recovery:0,defense:0,accuracy:0,hit:0,evasion:0,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:1},t=[0,0,0,0,0,0],i=[0,10,0,5,0,0];this.gear.push(new rt("Old Leathers",0,H,e,t,i));e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:0,recovery:0,defense:1,accuracy:0,hit:0,evasion:0,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:0},t=[0,0,0,0,0,0],i=[10,0,0,0,5,0];this.gear.push(new rt("Barrel Lid",0,_,e,t,i)),this.gear[0].bringToLevel(1),this.gear[1].bringToLevel(1),this.gear[2].bringToLevel(1);e={health:0,damageMin:2,damageMax:4,strength:1,dexterity:1,agility:0,endurance:0,recovery:0,defense:0,accuracy:0,hit:0,evasion:0,critPower:0,critResistance:0,critChance:.05,healthRegen:0,armor:0},t=[10,0,25,5,0,0],i=[6,0,15,4,0,5];this.gear.push(new rt("Iron Sword",1,S,e,t,i));e={health:0,damageMin:1,damageMax:5,strength:0,dexterity:0,agility:0,endurance:0,recovery:0,defense:0,accuracy:0,hit:0,evasion:0,critPower:6,critResistance:0,critChance:.07,healthRegen:0,armor:0},t=[20,0,15,5,0,0],i=[13,0,9,3,0,5];this.gear.push(new rt("Iron Axe",1,S,e,t,i));e={health:0,damageMin:1,damageMax:2.75,strength:0,dexterity:0,agility:0,endurance:0,recovery:0,defense:0,accuracy:0,hit:12,evasion:4,critPower:0,critResistance:0,critChance:.13,healthRegen:0,armor:0},t=[5,0,20,10,0,5],i=[3,0,14,8,0,5];this.gear.push(new rt("Dagger",1,S,e,t,i));e={health:0,damageMin:3,damageMax:5.25,strength:1,dexterity:0,agility:0,endurance:0,recovery:0,defense:1,accuracy:0,hit:-10,evasion:0,critPower:0,critResistance:0,critChance:.04,healthRegen:0,armor:0},t=[10,10,0,0,0,20],i=[8,8,0,0,0,14];this.gear.push(new rt("Crystal Hammer",1,S,e,t,i));e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:0,recovery:0,defense:0,accuracy:0,hit:4,evasion:12,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:1},t=[0,10,0,30,0,0],i=[0,5,0,20,0,5];this.gear.push(new rt("Cloak",1,H,e,t,i));e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:0,recovery:1,defense:0,accuracy:1,hit:0,evasion:0,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:2},t=[0,30,0,10,0,0],i=[0,20,0,5,0,5];this.gear.push(new rt("Hide Armor",1,H,e,t,i));e={health:7,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:0,recovery:0,defense:0,accuracy:0,hit:0,evasion:-8,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:3},t=[0,10,30,0,0,0],i=[0,5,20,0,0,5];this.gear.push(new rt("Half Plate",1,H,e,t,i));e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:0,recovery:0,defense:2,accuracy:0,hit:0,evasion:0,critPower:0,critResistance:4,critChance:0,healthRegen:0,armor:1},t=[30,0,10,0,0,0],i=[17,0,10,0,0,8];this.gear.push(new rt("Wooden Shield",1,_,e,t,i));e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:2.5,recovery:0,defense:0,accuracy:0,hit:0,evasion:0,critPower:0,critResistance:0,critChance:0,healthRegen:.5,armor:0},t=[0,0,10,0,25,5],i=[0,0,7,0,20,8];this.gear.push(new rt("Warm Stone",1,_,e,t,i));e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:1,agility:1,endurance:0,recovery:0,defense:0,accuracy:1,hit:0,evasion:0,critPower:0,critResistance:0,critChance:.05,healthRegen:0,armor:0},t=[0,20,0,10,0,10],i=[0,15,0,7,0,13];this.gear.push(new rt("Wolf-Tooth Necklace",1,_,e,t,i));e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:0,recovery:0,defense:0,accuracy:2,hit:15,evasion:0,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:1},t=[0,15,0,20,0,5],i=[0,10,0,17,0,8];if(this.gear.push(new rt("Gloves",1,_,e,t,i)),Je.getInstance().moonperks.strtrinket.level>0){e={health:0,damageMin:0,damageMax:1,strength:3,dexterity:0,agility:0,endurance:0,recovery:0,defense:0,accuracy:0,hit:0,evasion:0,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:0},t=[0,0,25,0,10,5],i=[0,0,20,0,7,8];this.gear.push(new rt("Shadow Wolf Charm α",1,_,e,t,i))}if(Je.getInstance().moonperks.dextrinket.level>0){e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:3,agility:0,endurance:0,recovery:0,defense:0,accuracy:0,hit:15,evasion:0,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:0},t=[0,25,0,10,0,5],i=[0,20,0,7,0,8];this.gear.push(new rt("Moonlight Circlet α",1,_,e,t,i))}if(Je.getInstance().moonperks.agitrinket.level>0){e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:3,endurance:0,recovery:0,defense:0,accuracy:0,hit:0,evasion:15,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:0},t=[0,10,0,25,0,5],i=[0,7,0,20,0,8];this.gear.push(new rt("Moon Treads α",1,_,e,t,i))}if(Je.getInstance().moonperks.endtrinket.level>0){e={health:7,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:3,recovery:0,defense:0,accuracy:0,hit:0,evasion:0,critPower:0,critResistance:3,critChance:0,healthRegen:0,armor:0},t=[0,0,10,0,25,5],i=[0,0,7,0,20,8];this.gear.push(new rt("Moonstone α",1,_,e,t,i))}if(Je.getInstance().moonperks.rectrinket.level>0){e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:0,recovery:3,defense:0,accuracy:0,hit:0,evasion:0,critPower:0,critResistance:0,critChance:0,healthRegen:.5,armor:0},t=[25,0,0,5,5,5],i=[20,0,0,3,3,9];this.gear.push(new rt("Dreamlight Bracer α",1,_,e,t,i))}if(Je.getInstance().moonperks.deftrinket.level>0){e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:0,recovery:0,defense:3,accuracy:0,hit:0,evasion:0,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:1},t=[0,10,0,0,5,25],i=[0,7,0,0,3,25];this.gear.push(new rt("Shadow Veil α",1,_,e,t,i))}if(Je.getInstance().moonperks.agitrinket.level>0){e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:0,recovery:0,defense:0,accuracy:3,hit:0,evasion:0,critPower:6,critResistance:0,critChance:.05,healthRegen:0,armor:0},t=[10,0,0,10,10,10],i=[8,0,0,8,8,11];this.gear.push(new rt("Nightmare Pendant α",1,_,e,t,i))}e={health:0,damageMin:8,damageMax:15,strength:0,dexterity:0,agility:0,endurance:0,recovery:0,defense:0,accuracy:0,hit:-20,evasion:30,critPower:0,critResistance:0,critChance:.12,healthRegen:0,armor:0},t=[25,0,25,0,0,0],i=[14,0,14,0,0,7];this.gear.push(new rt("Great Spear",2,S,e,t,i));e={health:0,damageMin:5,damageMax:11,strength:1.5,dexterity:2.5,agility:0,endurance:0,recovery:0,defense:0,accuracy:0,hit:0,evasion:0,critPower:0,critResistance:0,critChance:.12,healthRegen:0,armor:0},t=[15,0,25,10,0,0],i=[9,0,14,5,0,7];this.gear.push(new rt("Steel Sword",2,S,e,t,i));e={health:0,damageMin:3,damageMax:8,strength:0,dexterity:0,agility:1,endurance:0,recovery:2,defense:0,accuracy:1,hit:30,evasion:0,critPower:11,critResistance:0,critChance:.17,healthRegen:0,armor:0},t=[5,0,20,15,0,10],i=[4,0,15,9,0,7];this.gear.push(new rt("Hunting Dagger",2,S,e,t,i));e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:0,recovery:0,defense:0,accuracy:0,hit:15,evasion:45,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:4},t=[0,15,0,35,0,0],i=[0,9,0,19,0,7];this.gear.push(new rt("Thief Garb",2,H,e,t,i));e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:0,recovery:4,defense:0,accuracy:0,hit:0,evasion:0,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:6},t=[0,35,0,15,0,0],i=[0,19,0,9,0,7];this.gear.push(new rt("Hunting Leathers",2,H,e,t,i));e={health:15,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:0,recovery:0,defense:0,accuracy:0,hit:0,evasion:-20,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:8},t=[0,0,35,15,0,0],i=[0,0,19,9,0,7];this.gear.push(new rt("Full Plate",2,H,e,t,i));e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:2,recovery:0,defense:3,accuracy:3,hit:0,evasion:0,critPower:0,critResistance:0,critChance:.03,healthRegen:0,armor:0},t=[0,10,0,0,30,10],i=[0,8,0,0,22,10];this.gear.push(new rt("Lucky Rock",2,_,e,t,i));e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:5,endurance:0,recovery:0,defense:0,accuracy:0,hit:0,evasion:20,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:1.75},t=[0,30,0,15,0,5],i=[0,19,0,11,0,10];this.gear.push(new rt("Boots of Speed",2,_,e,t,i));e={health:0,damageMin:0,damageMax:0,strength:2,dexterity:0,agility:0,endurance:0,recovery:0,defense:7,accuracy:0,hit:-20,evasion:0,critPower:0,critResistance:7,critChance:0,healthRegen:0,armor:2},t=[0,15,0,10,25,0],i=[0,8,0,6,16,10];this.gear.push(new rt("Heavy Bracers",2,_,e,t,i));e={health:0,damageMin:0,damageMax:0,strength:2.5,dexterity:2.5,agility:2.5,endurance:2.5,recovery:0,defense:0,accuracy:0,hit:0,evasion:0,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:0},t=[0,10,25,0,0,15],i=[0,8,17,0,0,15];if(this.gear.push(new rt("Adventurer's Medallion",2,_,e,t,i)),Je.getInstance().moonperks.strtrinket.level>1){e={health:0,damageMin:0,damageMax:1.75,strength:6,dexterity:0,agility:0,endurance:0,recovery:0,defense:0,accuracy:0,hit:0,evasion:0,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:0},t=[0,0,30,0,10,10],i=[0,0,20,0,7,13];this.gear.push(new rt("Shadow Wolf Charm ß",2,_,e,t,i))}if(Je.getInstance().moonperks.dextrinket.level>1){e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:6,agility:0,endurance:0,recovery:0,defense:0,accuracy:0,hit:30,evasion:0,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:0},t=[0,30,0,10,0,10],i=[0,20,0,7,0,13];this.gear.push(new rt("Moonlight Circlet ß",2,_,e,t,i))}if(Je.getInstance().moonperks.agitrinket.level>1){e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:6,endurance:0,recovery:0,defense:0,accuracy:0,hit:0,evasion:30,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:0},t=[0,10,0,30,0,10],i=[0,7,0,20,0,13];this.gear.push(new rt("Moon Treads ß",2,_,e,t,i))}if(Je.getInstance().moonperks.endtrinket.level>1){e={health:15,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:6,recovery:0,defense:0,accuracy:0,hit:0,evasion:0,critPower:0,critResistance:6,critChance:0,healthRegen:0,armor:0},t=[0,0,10,0,30,10],i=[0,0,7,0,20,13];this.gear.push(new rt("Moonstone ß",2,_,e,t,i))}if(Je.getInstance().moonperks.rectrinket.level>1){e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:0,recovery:6,defense:0,accuracy:0,hit:0,evasion:0,critPower:0,critResistance:0,critChance:0,healthRegen:.9,armor:0},t=[30,0,0,7,8,10],i=[20,0,0,3,3,13];this.gear.push(new rt("Dreamlight Bracer ß",2,_,e,t,i))}if(Je.getInstance().moonperks.deftrinket.level>1){e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:0,recovery:0,defense:6,accuracy:0,hit:0,evasion:0,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:2},t=[0,15,0,0,5,30],i=[0,7,0,0,3,30];this.gear.push(new rt("Shadow Veil ß",2,_,e,t,i))}if(Je.getInstance().moonperks.acctrinket.level>1){e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:0,recovery:0,defense:0,accuracy:6,hit:0,evasion:0,critPower:10,critResistance:0,critChance:.06,healthRegen:0,armor:0},t=[15,0,0,15,10,10],i=[10,0,0,10,8,12];this.gear.push(new rt("Nightmare Pendant ß",2,_,e,t,i))}e={health:0,damageMin:16,damageMax:35,strength:0,dexterity:0,agility:0,endurance:0,recovery:0,defense:0,accuracy:0,hit:-42,evasion:55,critPower:22,critResistance:0,critChance:.14,healthRegen:0,armor:0},t=[0,10,35,0,20,0],i=[0,7,17,0,11,10];this.gear.push(new rt("Thunder Spear",3,S,e,t,i));e={health:0,damageMin:16,damageMax:27,strength:0,dexterity:4,agility:0,endurance:0,recovery:0,defense:0,accuracy:0,hit:30,evasion:0,critPower:0,critResistance:0,critChance:.14,healthRegen:0,armor:0},t=[0,0,25,0,10,5],i=[0,10,0,17,0,8];this.gear.push(new rt("Ardent Blade",3,S,e,t,i));e={health:0,damageMin:12,damageMax:17,strength:7.5,dexterity:0,agility:0,endurance:0,recovery:0,defense:0,accuracy:0,hit:70,evasion:0,critPower:0,critResistance:0,critChance:.17,healthRegen:0,armor:0},t=[0,25,25,15,0,0],i=[0,15,15,5,0,10];this.gear.push(new rt("Dire Claw",3,S,e,t,i));e={health:0,damageMin:3,damageMax:4.25,strength:0,dexterity:0,agility:0,endurance:0,recovery:0,defense:0,accuracy:0,hit:0,evasion:70,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:11},t=[0,20,0,45,0,0],i=[0,10,0,25,0,10];this.gear.push(new rt("Assassin Cloak",3,H,e,t,i));e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:2.5,recovery:5,defense:0,accuracy:0,hit:0,evasion:0,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:15},t=[0,45,0,20,0,0],i=[0,25,0,10,0,10];this.gear.push(new rt("Beastmaster Vest",3,H,e,t,i));e={health:36,damageMin:0,damageMax:0,strength:4,dexterity:0,agility:0,endurance:0,recovery:0,defense:0,accuracy:0,hit:-15,evasion:-55,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:20},t=[0,20,45,0,0,0],i=[0,10,25,0,0,10];this.gear.push(new rt("Lizardscale Armor",3,H,e,t,i));e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:9,agility:0,endurance:0,recovery:0,defense:0,accuracy:6,hit:0,evasion:0,critPower:0,critResistance:0,critChance:.06,healthRegen:0,armor:0},t=[0,40,0,15,0,10],i=[0,27,0,10,0,13];this.gear.push(new rt("Wolf Gloves",3,_,e,t,i));e={health:18,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:0,recovery:0,defense:0,accuracy:0,hit:105,evasion:0,critPower:0,critResistance:0,critChance:0,healthRegen:.6,armor:0},t=[0,0,0,0,35,30],i=[0,0,0,0,24,26];this.gear.push(new rt("Hyperstone",3,_,e,t,i));e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:3.5,recovery:0,defense:7.5,accuracy:0,hit:0,evasion:-37,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:3.5},t=[15,10,40,0,0,0],i=[9,6,22,0,0,13];this.gear.push(new rt("Tower Shield",3,_,e,t,i));e={health:0,damageMin:0,damageMax:0,strength:10,dexterity:0,agility:0,endurance:5,recovery:0,defense:0,accuracy:0,hit:-33,evasion:0,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:2},t=[0,35,0,20,10,0],i=[0,18,0,13,6,13];if(this.gear.push(new rt("Ogre Belt",3,_,e,t,i)),Je.getInstance().moonperks.strtrinket.level>2){e={health:0,damageMin:0,damageMax:3.75,strength:11,dexterity:0,agility:0,endurance:0,recovery:0,defense:0,accuracy:0,hit:0,evasion:0,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:0},t=[0,0,40,0,15,10],i=[0,0,27,0,10,13];this.gear.push(new rt("Shadow Wolf Charm σ",3,_,e,t,i))}if(Je.getInstance().moonperks.dextrinket.level>2){e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:11,agility:0,endurance:0,recovery:0,defense:0,accuracy:0,hit:70,evasion:0,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:0},t=[0,40,0,15,0,10],i=[0,27,0,10,0,13];this.gear.push(new rt("Moonlight Circlet σ",3,_,e,t,i))}if(Je.getInstance().moonperks.agitrinket.level>2){e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:11,endurance:0,recovery:0,defense:0,accuracy:0,hit:0,evasion:70,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:0},t=[0,15,0,40,0,10],i=[0,10,0,27,0,13];this.gear.push(new rt("Moon Treads σ",3,_,e,t,i))}if(Je.getInstance().moonperks.endtrinket.level>2){e={health:36,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:11,recovery:0,defense:0,accuracy:0,hit:0,evasion:0,critPower:0,critResistance:13,critChance:0,healthRegen:0,armor:0},t=[0,0,15,0,40,10],i=[0,0,10,0,27,13];this.gear.push(new rt("Moonstone σ",3,_,e,t,i))}if(Je.getInstance().moonperks.rectrinket.level>2){e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:0,recovery:11,defense:0,accuracy:0,hit:0,evasion:0,critPower:0,critResistance:0,critChance:0,healthRegen:1.4,armor:0},t=[40,0,0,10,10,10],i=[27,0,0,3,3,13];this.gear.push(new rt("Dreamlight Bracer σ",3,_,e,t,i))}if(Je.getInstance().moonperks.deftrinket.level>2){e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:0,recovery:0,defense:11,accuracy:0,hit:0,evasion:0,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:3.5},t=[0,17,0,0,8,40],i=[0,10,0,0,5,35];this.gear.push(new rt("Shadow Veil σ",3,_,e,t,i))}if(Je.getInstance().moonperks.acctrinket.level>2){e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:0,recovery:0,defense:0,accuracy:11,hit:0,evasion:0,critPower:22,critResistance:0,critChance:.07,healthRegen:0,armor:0},t=[20,0,0,15,15,15],i=[15,0,0,10,10,15];this.gear.push(new rt("Nightmare Pendant σ",3,_,e,t,i))}e={health:0,damageMin:22,damageMax:57,strength:9,dexterity:0,agility:0,endurance:4,recovery:0,defense:0,accuracy:0,hit:-80,evasion:0,critPower:0,critResistance:0,critChance:.16,healthRegen:0,armor:0},t=[40,10,35,0,0,0],i=[22,5,19,0,0,14];this.gear.push(new rt("Giant's Axe",4,S,e,t,i));e={health:0,damageMin:26,damageMax:44,strength:0,dexterity:0,agility:6.5,endurance:0,recovery:0,defense:0,accuracy:0,hit:62,evasion:0,critPower:0,critResistance:0,critChance:.17,healthRegen:0,armor:0},t=[25,0,45,15,0,0],i=[14,0,24,8,0,14];this.gear.push(new rt("Elven Longsword",4,S,e,t,i));e={health:0,damageMin:19,damageMax:32,strength:0,dexterity:0,agility:0,endurance:0,recovery:0,defense:0,accuracy:7,hit:144,evasion:0,critPower:0,critResistance:0,critChance:.19,healthRegen:1.5,armor:0},t=[0,0,45,30,0,10],i=[0,0,24,19,0,17];this.gear.push(new rt("Sacrificial Dagger",4,S,e,t,i));e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:6.5,agility:0,endurance:0,recovery:0,defense:6.5,accuracy:0,hit:0,evasion:148,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:19},t=[0,15,0,60,0,10],i=[0,12,0,32,0,16];this.gear.push(new rt("Spellweave Robe",4,H,e,t,i));e={health:0,damageMin:0,damageMax:0,strength:8,dexterity:0,agility:0,endurance:0,recovery:0,defense:5,accuracy:0,hit:0,evasion:0,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:28},t=[0,65,0,20,0,0],i=[0,36,0,10,0,14];this.gear.push(new rt("Dire Bear Cloak",4,H,e,t,i));e={health:68,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:0,recovery:0,defense:13,accuracy:0,hit:-65,evasion:-157,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:35},t=[0,0,0,15,50,20],i=[0,0,0,11,26,23];this.gear.push(new rt("Ancient Armor",4,H,e,t,i));e={health:-24,damageMin:0,damageMax:0,strength:16,dexterity:16,agility:0,endurance:0,recovery:0,defense:0,accuracy:0,hit:0,evasion:0,critPower:42,critResistance:0,critChance:0,healthRegen:-1.1,armor:0},t=[30,15,0,0,40,0],i=[14,9,0,0,22,20];this.gear.push(new rt("Demonic Sigil",4,_,e,t,i));e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:0,recovery:0,defense:11,accuracy:7,hit:0,evasion:-60,critPower:0,critResistance:27,critChance:0,healthRegen:0,armor:6},t=[10,0,50,0,0,25],i=[7,0,31,0,0,27];this.gear.push(new rt("Mirror Shield",4,_,e,t,i));e={health:0,damageMin:7.5,damageMax:10.5,strength:0,dexterity:0,agility:0,endurance:0,recovery:0,defense:0,accuracy:0,hit:0,evasion:0,critPower:0,critResistance:0,critChance:0,healthRegen:1.25,armor:0},t=[0,45,0,0,30,10],i=[0,24,0,0,19,22];this.gear.push(new rt("Dragonbone Charm",4,_,e,t,i));e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:8,agility:8,endurance:5,recovery:0,defense:0,accuracy:5,hit:0,evasion:0,critPower:0,critResistance:0,critChance:.05,healthRegen:0,armor:0},t=[25,0,15,0,45,0],i=[13,0,9,0,23,20];if(this.gear.push(new rt("Spirit Ring",4,_,e,t,i)),Je.getInstance().moonperks.strtrinket.level>3){e={health:0,damageMin:0,damageMax:7,strength:19,dexterity:0,agility:0,endurance:0,recovery:0,defense:0,accuracy:0,hit:0,evasion:0,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:0},t=[0,0,50,0,20,15],i=[0,0,35,0,12,18];this.gear.push(new rt("Shadow Wolf Charm Σ",4,_,e,t,i))}if(Je.getInstance().moonperks.dextrinket.level>3){e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:19,agility:0,endurance:0,recovery:0,defense:0,accuracy:0,hit:125,evasion:0,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:0},t=[0,50,0,20,0,15],i=[0,35,0,12,0,18];this.gear.push(new rt("Moonlight Circlet Σ",4,_,e,t,i))}if(Je.getInstance().moonperks.agitrinket.level>3){e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:19,endurance:0,recovery:0,defense:0,accuracy:0,hit:0,evasion:125,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:0},t=[0,20,0,50,0,15],i=[0,12,0,35,0,18];this.gear.push(new rt("Moon Treads Σ",4,_,e,t,i))}if(Je.getInstance().moonperks.endtrinket.level>3){e={health:68,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:19,recovery:0,defense:0,accuracy:0,hit:0,evasion:0,critPower:0,critResistance:25,critChance:0,healthRegen:0,armor:0},t=[0,0,20,0,50,15],i=[0,0,12,0,35,18];this.gear.push(new rt("Moonstone Σ",4,_,e,t,i))}if(Je.getInstance().moonperks.rectrinket.level>3){e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:0,recovery:19,defense:0,accuracy:0,hit:0,evasion:0,critPower:0,critResistance:0,critChance:0,healthRegen:2.1,armor:0},t=[50,0,0,10,10,15],i=[35,0,0,6,6,18];this.gear.push(new rt("Dreamlight Bracer Σ",4,_,e,t,i))}if(Je.getInstance().moonperks.deftrinket.level>3){e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:0,recovery:0,defense:19,accuracy:0,hit:0,evasion:0,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:6},t=[0,20,0,0,15,50],i=[0,12,0,0,8,45];this.gear.push(new rt("Shadow Veil Σ",4,_,e,t,i))}if(Je.getInstance().moonperks.acctrinket.level>3){e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:0,recovery:0,defense:0,accuracy:19,hit:0,evasion:0,critPower:42,critResistance:0,critChance:.08,healthRegen:0,armor:0},t=[25,0,0,20,20,20],i=[15,0,0,15,15,20];this.gear.push(new rt("Nightmare Pendant Σ",4,_,e,t,i))}e={health:0,damageMin:54,damageMax:96,strength:10,dexterity:0,agility:0,endurance:0,recovery:0,defense:10,accuracy:0,hit:-122,evasion:0,critPower:0,critResistance:0,critChance:.14,healthRegen:0,armor:0},t=[40,0,60,0,0,10],i=[24,0,35,0,0,21];this.gear.push(new rt("Quake Hammer",5,S,e,t,i));e={health:0,damageMin:49,damageMax:73,strength:0,dexterity:0,agility:0,endurance:0,recovery:12,defense:0,accuracy:0,hit:0,evasion:0,critPower:75,critResistance:0,critChance:.17,healthRegen:0,armor:0},t=[30,30,50,0,0,0],i=[17,17,30,0,0,16];this.gear.push(new rt("Dawnblade",5,S,e,t,i));e={health:0,damageMin:36,damageMax:54,strength:5,dexterity:0,agility:5,endurance:0,recovery:0,defense:0,accuracy:0,hit:200,evasion:0,critPower:0,critResistance:0,critChance:.21,healthRegen:0,armor:5},t=[0,30,35,45,0,0],i=[0,17,20,27,0,16];this.gear.push(new rt("Dragon Tooth",5,S,e,t,i));e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:0,recovery:0,defense:10,accuracy:0,hit:0,evasion:190,critPower:0,critResistance:0,critChance:0,healthRegen:1.7,armor:30},t=[0,40,0,70,0,0],i=[0,24,0,40,0,16];this.gear.push(new rt("Fire Rat Tunic",5,H,e,t,i));e={health:0,damageMin:6,damageMax:9,strength:0,dexterity:0,agility:0,endurance:0,recovery:0,defense:0,accuracy:0,hit:45,evasion:0,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:39},t=[0,70,0,40,0,0],i=[0,40,0,24,0,16];this.gear.push(new rt("Savage Leather",5,H,e,t,i));e={health:100,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:0,recovery:0,defense:0,accuracy:0,hit:0,evasion:-173,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:52},t=[0,0,70,0,20,20],i=[0,0,40,0,12,28];this.gear.push(new rt("Enchanted Plate",5,H,e,t,i));e={health:0,damageMin:0,damageMax:0,strength:3,dexterity:3,agility:0,endurance:0,recovery:0,defense:3,accuracy:0,hit:0,evasion:0,critPower:75,critResistance:0,critChance:.1,healthRegen:0,armor:0},t=[20,0,0,0,40,50],i=[11,0,0,0,24,50];this.gear.push(new rt("Power Shard",5,_,e,t,i));e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:0,recovery:-7,defense:18,accuracy:0,hit:50,evasion:130,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:11},t=[0,45,0,45,0,20],i=[0,27,0,27,0,31];this.gear.push(new rt("Cloak of Displacement",5,_,e,t,i));e={health:0,damageMin:0,damageMax:0,strength:20,dexterity:-5,agility:-5,endurance:0,recovery:0,defense:0,accuracy:20,hit:0,evasion:0,critPower:0,critResistance:0,critChance:.08,healthRegen:0,armor:0},t=[15,0,0,20,75,0],i=[9,0,0,11,44,21];this.gear.push(new rt("Pendant of Sin",5,_,e,t,i));e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:18,endurance:0,recovery:20,defense:0,accuracy:0,hit:-30,evasion:117,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:0},t=[40,40,0,30,0,0],i=[24,24,0,16,0,21];if(this.gear.push(new rt("Windwalk Cape",5,_,e,t,i)),Je.getInstance().moonperks.strtrinket.level>4){e={health:0,damageMin:0,damageMax:12,strength:30,dexterity:0,agility:0,endurance:0,recovery:0,defense:0,accuracy:0,hit:0,evasion:0,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:0},t=[0,0,65,0,25,20],i=[0,0,45,0,17,23];this.gear.push(new rt("Shadow Wolf Charm Φ",5,_,e,t,i))}if(Je.getInstance().moonperks.dextrinket.level>4){e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:30,agility:0,endurance:0,recovery:0,defense:0,accuracy:0,hit:200,evasion:0,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:0},t=[0,65,0,25,0,20],i=[0,45,0,17,0,23];this.gear.push(new rt("Moonlight Circlet Φ",5,_,e,t,i))}if(Je.getInstance().moonperks.agitrinket.level>4){e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:30,endurance:0,recovery:0,defense:0,accuracy:0,hit:0,evasion:200,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:0},t=[0,25,0,65,0,20],i=[0,17,0,45,0,23];this.gear.push(new rt("Moon Treads Φ",5,_,e,t,i))}if(Je.getInstance().moonperks.endtrinket.level>4){e={health:100,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:30,recovery:0,defense:0,accuracy:0,hit:0,evasion:0,critPower:0,critResistance:40,critChance:0,healthRegen:0,armor:0},t=[0,0,25,0,65,20],i=[0,0,17,0,45,23];this.gear.push(new rt("Moonstone Φ",5,_,e,t,i))}if(Je.getInstance().moonperks.rectrinket.level>4){e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:0,recovery:30,defense:0,accuracy:0,hit:0,evasion:0,critPower:0,critResistance:0,critChance:0,healthRegen:3.25,armor:0},t=[65,0,0,12,13,20],i=[45,0,0,8,9,23];this.gear.push(new rt("Dreamlight Bracer Φ",5,_,e,t,i))}if(Je.getInstance().moonperks.deftrinket.level>4){e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:0,recovery:0,defense:30,accuracy:0,hit:0,evasion:0,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:11},t=[0,25,0,0,20,65],i=[0,17,0,0,13,55];this.gear.push(new rt("Shadow Veil Φ",5,_,e,t,i))}if(Je.getInstance().moonperks.acctrinket.level>4){e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:0,recovery:0,defense:0,accuracy:30,hit:0,evasion:0,critPower:75,critResistance:0,critChance:.09,healthRegen:0,armor:0},t=[30,0,0,30,25,25],i=[23,0,0,22,20,20];this.gear.push(new rt("Nightmare Pendant Φ",5,_,e,t,i))}e={health:0,damageMin:92,damageMax:140,strength:0,dexterity:0,agility:0,endurance:0,recovery:0,defense:0,accuracy:0,hit:-195,evasion:0,critPower:120,critResistance:0,critChance:.27,healthRegen:0,armor:0},t=[60,0,50,0,30,0],i=[36,0,31,0,19,19];this.gear.push(new rt("Spear of Desolation",6,S,e,t,i));e={health:0,damageMin:77,damageMax:119,strength:0,dexterity:0,agility:11,endurance:0,recovery:0,defense:0,accuracy:11,hit:111,evasion:0,critPower:0,critResistance:0,critChance:.18,healthRegen:0,armor:0},t=[45,0,65,30,0,0],i=[27,0,40,19,0,19];this.gear.push(new rt("Arcane Sword",6,S,e,t,i));e={health:0,damageMin:66,damageMax:93,strength:12,dexterity:6,agility:6,endurance:0,recovery:0,defense:0,accuracy:0,hit:335,evasion:0,critPower:0,critResistance:0,critChance:.2,healthRegen:0,armor:0},t=[60,0,60,0,20,0],i=[37,0,37,0,12,19];this.gear.push(new rt("Orichalcum Dagger",6,S,e,t,i));e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:0,recovery:0,defense:0,accuracy:0,hit:170,evasion:340,critPower:0,critResistance:0,critChance:.07,healthRegen:0,armor:49},t=[0,50,0,90,0,0],i=[0,31,0,55,0,19];this.gear.push(new rt("Vestigial Clothes",6,H,e,t,i));e={health:0,damageMin:0,damageMax:0,strength:18,dexterity:-4,agility:-4,endurance:15,recovery:0,defense:0,accuracy:0,hit:0,evasion:0,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:65},t=[0,100,0,40,0,0],i=[0,61,0,25,0,19];this.gear.push(new rt("Storm Giant Tunic",6,H,e,t,i));e={health:120,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:0,recovery:0,defense:26,accuracy:0,hit:-164,evasion:-472,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:82},t=[30,0,80,0,30,0],i=[19,0,48,0,19,19];this.gear.push(new rt("Immovable Plate",6,H,e,t,i));e={health:-70,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:0,recovery:14,defense:8,accuracy:0,hit:0,evasion:0,critPower:0,critResistance:0,critChance:0,healthRegen:8.5,armor:0},t=[0,50,0,0,50,40],i=[0,31,0,0,31,48];this.gear.push(new rt("Slime Core",6,_,e,t,i));e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:11,agility:11,endurance:0,recovery:0,defense:11,accuracy:0,hit:0,evasion:-142,critPower:0,critResistance:45,critChance:0,healthRegen:0,armor:20},t=[25,0,0,0,55,60],i=[15,0,0,0,34,61];this.gear.push(new rt("Phase Shield",6,_,e,t,i));e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:27,endurance:0,recovery:0,defense:0,accuracy:-10,hit:0,evasion:350,critPower:0,critResistance:0,critChance:.09,healthRegen:0,armor:9},t=[0,40,0,70,0,30],i=[0,24,0,43,0,43];this.gear.push(new rt("Hermes Boots",6,_,e,t,i));e={health:0,damageMin:12,damageMax:19,strength:22,dexterity:0,agility:0,endurance:0,recovery:0,defense:0,accuracy:10,hit:-186,evasion:0,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:0},t=[0,60,30,50,0,0],i=[0,36,20,30,0,24];if(this.gear.push(new rt("Gloves of Power",6,_,e,t,i)),Je.getInstance().moonperks.strtrinket.level>5){e={health:0,damageMin:0,damageMax:17,strength:42,dexterity:0,agility:0,endurance:0,recovery:0,defense:0,accuracy:0,hit:0,evasion:0,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:0},t=[0,0,80,0,35,25],i=[0,0,60,0,25,30];this.gear.push(new rt("Shadow Wolf Charm Θ",6,_,e,t,i))}if(Je.getInstance().moonperks.dextrinket.level>5){e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:42,agility:0,endurance:0,recovery:0,defense:0,accuracy:0,hit:350,evasion:0,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:0},t=[0,80,0,35,0,25],i=[0,60,0,25,0,30];this.gear.push(new rt("Moonlight Circlet Θ",6,_,e,t,i))}if(Je.getInstance().moonperks.agitrinket.level>5){e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:42,endurance:0,recovery:0,defense:0,accuracy:0,hit:0,evasion:350,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:0},t=[0,35,0,80,0,25],i=[0,25,0,60,0,30];this.gear.push(new rt("Moon Treads Θ",6,_,e,t,i))}if(Je.getInstance().moonperks.endtrinket.level>5){e={health:175,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:42,recovery:0,defense:0,accuracy:0,hit:0,evasion:0,critPower:0,critResistance:60,critChance:0,healthRegen:0,armor:0},t=[0,0,35,0,80,25],i=[0,0,25,0,60,30];this.gear.push(new rt("Moonstone Θ",6,_,e,t,i))}if(Je.getInstance().moonperks.rectrinket.level>5){e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:0,recovery:42,defense:0,accuracy:0,hit:0,evasion:0,critPower:0,critResistance:0,critChance:0,healthRegen:4.75,armor:0},t=[80,0,0,17,18,25],i=[60,0,0,12,13,30];this.gear.push(new rt("Dreamlight Bracer Θ",6,_,e,t,i))}if(Je.getInstance().moonperks.deftrinket.level>5){e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:0,recovery:0,defense:42,accuracy:0,hit:0,evasion:0,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:17},t=[0,35,0,0,25,80],i=[0,25,0,0,15,75];this.gear.push(new rt("Shadow Veil Θ",6,_,e,t,i))}if(Je.getInstance().moonperks.acctrinket.level>5){e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:0,recovery:0,defense:0,accuracy:42,hit:0,evasion:0,critPower:120,critResistance:0,critChance:.1,healthRegen:0,armor:0},t=[35,0,0,35,35,35],i=[27,0,0,27,27,27];this.gear.push(new rt("Nightmare Pendant Θ",6,_,e,t,i))}e={health:0,damageMin:138,damageMax:215,strength:0,dexterity:0,agility:0,endurance:15,recovery:0,defense:20,accuracy:0,hit:-245,evasion:0,critPower:0,critResistance:0,critChance:.17,healthRegen:0,armor:0},t=[30,45,100,0,0,0],i=[19,29,64,0,0,23];this.gear.push(new rt("Dark One's Mace",7,S,e,t,i));e={health:0,damageMin:122,damageMax:170,strength:12,dexterity:0,agility:0,endurance:0,recovery:0,defense:0,accuracy:0,hit:0,evasion:0,critPower:180,critResistance:0,critChance:.33,healthRegen:0,armor:0},t=[35,0,70,0,0,70],i=[22,0,45,0,0,68];this.gear.push(new rt("Vorpal Blade",7,S,e,t,i));e={health:0,damageMin:112,damageMax:145,strength:10,dexterity:10,agility:10,endurance:0,recovery:0,defense:0,accuracy:0,hit:460,evasion:0,critPower:0,critResistance:0,critChance:.24,healthRegen:0,armor:0},t=[15,0,120,40,0,0],i=[10,0,77,25,0,23];this.gear.push(new rt("Adamantine Claws",7,S,e,t,i));e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:0,recovery:0,defense:14,accuracy:0,hit:120,evasion:450,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:75},t=[0,65,0,110,0,0],i=[0,42,0,70,0,23];this.gear.push(new rt("Shaed",7,H,e,t,i));e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:0,recovery:27,defense:0,accuracy:8,hit:0,evasion:0,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:98},t=[0,110,0,15,0,50],i=[0,70,0,10,0,55];this.gear.push(new rt("Crystaline Scales",7,H,e,t,i));e={health:220,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:0,recovery:0,defense:0,accuracy:0,hit:-70,evasion:-370,critPower:0,critResistance:0,critChance:0,healthRegen:4,armor:120},t=[0,0,70,0,60,45],i=[0,0,45,0,38,52];this.gear.push(new rt("Runic Armor",7,H,e,t,i));e={health:0,damageMin:0,damageMax:0,strength:14,dexterity:14,agility:14,endurance:14,recovery:0,defense:14,accuracy:0,hit:0,evasion:0,critPower:0,critResistance:0,critChance:-.15,healthRegen:3,armor:14},t=[0,0,0,40,95,40],i=[0,0,0,26,61,53];this.gear.push(new rt("Soul Gem",7,_,e,t,i));e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:0,recovery:0,defense:30,accuracy:30,hit:0,evasion:-270,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:24},t=[130,20,0,0,25,0],i=[83,13,0,0,16,28];this.gear.push(new rt("Lidless Eye",7,_,e,t,i));e={health:0,damageMin:17,damageMax:24,strength:0,dexterity:0,agility:0,endurance:0,recovery:0,defense:0,accuracy:0,hit:0,evasion:0,critPower:170,critResistance:0,critChance:.1,healthRegen:0,armor:0},t=[70,0,0,45,0,60],i=[45,0,0,29,0,66];this.gear.push(new rt("Circlet of Power",7,_,e,t,i));e={health:-185,damageMin:0,damageMax:0,strength:0,dexterity:30,agility:30,endurance:0,recovery:30,defense:-15,accuracy:0,hit:0,evasion:0,critPower:0,critResistance:0,critChance:.07,healthRegen:0,armor:0},t=[0,70,0,70,35,0],i=[0,45,0,45,22,28];if(this.gear.push(new rt("Demonic Wraps",7,_,e,t,i)),Je.getInstance().moonperks.strtrinket.level>6){e={health:0,damageMin:0,damageMax:24,strength:53,dexterity:0,agility:0,endurance:0,recovery:0,defense:0,accuracy:0,hit:0,evasion:0,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:0},t=[0,0,95,0,45,35],i=[0,0,70,0,30,40];this.gear.push(new rt("Shadow Wolf Charm Ω",7,_,e,t,i))}if(Je.getInstance().moonperks.dextrinket.level>6){e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:53,agility:0,endurance:0,recovery:0,defense:0,accuracy:0,hit:470,evasion:0,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:0},t=[0,95,0,45,0,35],i=[0,70,0,30,0,40];this.gear.push(new rt("Moonlight Circlet Ω",7,_,e,t,i))}if(Je.getInstance().moonperks.agitrinket.level>6){e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:53,endurance:0,recovery:0,defense:0,accuracy:0,hit:0,evasion:470,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:0},t=[0,45,0,95,0,35],i=[0,30,0,70,0,40];this.gear.push(new rt("Moon Treads Ω",7,_,e,t,i))}if(Je.getInstance().moonperks.endtrinket.level>6){e={health:240,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:53,recovery:0,defense:0,accuracy:0,hit:0,evasion:0,critPower:0,critResistance:80,critChance:0,healthRegen:0,armor:0},t=[0,0,45,0,95,35],i=[0,0,30,0,70,40];this.gear.push(new rt("Moonstone Ω",7,_,e,t,i))}if(Je.getInstance().moonperks.rectrinket.level>6){e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:0,recovery:53,defense:0,accuracy:0,hit:0,evasion:0,critPower:0,critResistance:0,critChance:0,healthRegen:6.25,armor:0},t=[95,0,0,22,23,35],i=[70,0,0,15,15,40];this.gear.push(new rt("Dreamlight Bracer Ω",7,_,e,t,i))}if(Je.getInstance().moonperks.deftrinket.level>6){e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:0,recovery:0,defense:53,accuracy:0,hit:0,evasion:0,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:24},t=[0,45,0,0,35,95],i=[0,30,0,0,25,85];this.gear.push(new rt("Shadow Veil Ω",7,_,e,t,i))}if(Je.getInstance().moonperks.acctrinket.level>6){e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:0,recovery:0,defense:0,accuracy:3,hit:0,evasion:0,critPower:170,critResistance:0,critChance:.11,healthRegen:0,armor:0},t=[45,0,0,45,45,40],i=[35,0,0,35,35,35];this.gear.push(new rt("Nightmare Pendant Ω",7,_,e,t,i))}e={health:0,damageMin:166,damageMax:333,strength:40,dexterity:0,agility:-10,endurance:15,recovery:0,defense:0,accuracy:0,hit:-470,evasion:0,critPower:0,critResistance:0,critChance:.24,healthRegen:0,armor:0},t=[90,0,100,25,0,0],i=[59,0,67,17,0,27];this.gear.push(new rt("Ragnarok",8,S,e,t,i));e={health:0,damageMin:182,damageMax:265,strength:0,dexterity:0,agility:0,endurance:0,recovery:0,defense:0,accuracy:0,hit:0,evasion:0,critPower:0,critResistance:0,critChance:.33,healthRegen:7,armor:0},t=[0,45,90,0,80,0],i=[0,30,60,0,53,27];this.gear.push(new rt("9 Lives Stealer",8,S,e,t,i));e={health:0,damageMin:157,damageMax:205,strength:17,dexterity:0,agility:0,endurance:0,recovery:0,defense:0,accuracy:0,hit:620,evasion:0,critPower:.4,critResistance:0,critChance:.3,healthRegen:0,armor:0},t=[55,0,70,90,0,0],i=[0,0,47,59,0,27];this.gear.push(new rt("Chthonic Dagger",8,S,e,t,i));e={health:100,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:0,recovery:0,defense:0,accuracy:0,hit:0,evasion:780,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:115},t=[0,45,0,140,0,30],i=[0,30,0,93,0,47];this.gear.push(new rt("Angelic Garments",8,H,e,t,i));e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:12,recovery:34,defense:0,accuracy:0,hit:0,evasion:0,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:145},t=[0,140,0,75,0,0],i=[0,93,0,50,0,27];this.gear.push(new rt("Terrasque Leather",8,H,e,t,i));e={health:325,damageMin:0,damageMax:0,strength:12,dexterity:0,agility:0,endurance:0,recovery:0,defense:0,accuracy:0,hit:-150,evasion:-620,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:180},t=[0,0,150,0,40,25],i=[0,0,100,0,27,43];this.gear.push(new rt("God Plate",8,H,e,t,i));e={health:230,damageMin:0,damageMax:0,strength:-15,dexterity:0,agility:0,endurance:0,recovery:0,defense:42,accuracy:0,hit:0,evasion:0,critPower:0,critResistance:200,critChance:-.12,healthRegen:0,armor:31},t=[0,0,50,0,100,65],i=[0,0,33,0,67,75];this.gear.push(new rt("Sigil of Protection",8,_,e,t,i));e={health:0,damageMin:19,damageMax:32,strength:50,dexterity:0,agility:0,endurance:0,recovery:0,defense:-20,accuracy:0,hit:240,evasion:0,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:-16},t=[75,90,0,0,0,50],i=[50,60,0,0,0,65];this.gear.push(new rt("Aura of Bloodlust",8,_,e,t,i));e={health:-210,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:0,recovery:0,defense:0,accuracy:0,hit:580,evasion:580,critPower:220,critResistance:0,critChance:.14,healthRegen:0,armor:0},t=[60,0,0,140,0,15],i=[40,0,0,93,0,42];this.gear.push(new rt("Winds of Battle",8,_,e,t,i));e={health:0,damageMin:0,damageMax:0,strength:17,dexterity:17,agility:17,endurance:17,recovery:17,defense:17,accuracy:17,hit:0,evasion:0,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:0},t=[60,60,60,0,0,35],i=[40,40,40,0,0,55];if(this.gear.push(new rt("Inner Fire",8,_,e,t,i)),Je.getInstance().moonperks.strtrinket.level>7){e={health:0,damageMin:0,damageMax:31,strength:68,dexterity:0,agility:0,endurance:0,recovery:0,defense:0,accuracy:0,hit:0,evasion:0,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:0},t=[0,0,120,0,55,40],i=[0,0,95,0,35,45];this.gear.push(new rt("Shadow Wolf Charm ☼",8,_,e,t,i))}if(Je.getInstance().moonperks.dextrinket.level>7){e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:68,agility:0,endurance:0,recovery:0,defense:0,accuracy:0,hit:620,evasion:0,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:0},t=[0,120,0,55,0,40],i=[0,95,0,35,0,45];this.gear.push(new rt("Moonlight Circlet ☼",8,_,e,t,i))}if(Je.getInstance().moonperks.agitrinket.level>7){e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:68,endurance:0,recovery:0,defense:0,accuracy:0,hit:0,evasion:620,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:0},t=[0,55,0,120,0,40],i=[0,35,0,95,0,45];this.gear.push(new rt("Moon Treads ☼",8,_,e,t,i))}if(Je.getInstance().moonperks.endtrinket.level>7){e={health:325,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:68,recovery:0,defense:0,accuracy:0,hit:0,evasion:0,critPower:0,critResistance:110,critChance:0,healthRegen:0,armor:0},t=[0,0,55,0,120,40],i=[0,0,35,0,95,45];this.gear.push(new rt("Moonstone ☼",8,_,e,t,i))}if(Je.getInstance().moonperks.rectrinket.level>7){e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:0,recovery:68,defense:0,accuracy:0,hit:0,evasion:0,critPower:0,critResistance:0,critChance:0,healthRegen:8.5,armor:0},t=[120,0,0,27,28,40],i=[95,0,0,17,17,45];this.gear.push(new rt("Dreamlight Bracer ☼",8,_,e,t,i))}if(Je.getInstance().moonperks.deftrinket.level>7){e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:0,recovery:0,defense:68,accuracy:0,hit:0,evasion:0,critPower:0,critResistance:0,critChance:0,healthRegen:0,armor:31},t=[0,55,0,0,40,120],i=[0,35,0,0,30,110];this.gear.push(new rt("Shadow Veil ☼",8,_,e,t,i))}if(Je.getInstance().moonperks.acctrinket.level>7){e={health:0,damageMin:0,damageMax:0,strength:0,dexterity:0,agility:0,endurance:0,recovery:0,defense:0,accuracy:68,hit:0,evasion:0,critPower:230,critResistance:0,critChance:.12,healthRegen:0,armor:0},t=[55,0,0,55,55,50],i=[36,0,0,36,36,36];this.gear.push(new rt("Nightmare Pendant ☼",8,_,e,t,i))}}}class ot{constructor(){return ot.instance||(this.minGateRegion=0,this.regionSize=[11,13],this.regionDifficultyIncrease=20,this.maxGearTier=8,this.maxResourceTier=8,this.buildingsAllowed=!0,this.gearAllowed=!0,this.gearCostMulti=1,this.maxRunTime=-1,this.exploreSpeed=1,this.talentsEnabled=!0,this.challengeName="",this.startingTraits=0,this.fixedTraits=[],this.productionMulti=1,this.spendFriendship=!1,this.friendshipToProduction=!1,ot.instance=this),ot.instance}static getInstance(){return ot.instance?ot.instance:new ot}reset(){this.minGateRegion=0,this.regionSize=[11,13],this.regionDifficultyIncrease=20,this.maxGearTier=8,this.maxResourceTier=8,this.buildingsAllowed=!0,this.gearAllowed=!0,this.gearCostMulti=1,this.maxRunTime=-1,this.exploreSpeed=1,this.talentsEnabled=!0,this.challengeName="",this.startingTraits=0,this.fixedTraits=[],this.productionMulti=1,this.spendFriendship=!1,this.friendshipToProduction=!1}setupChallenge(e){switch(this.reset(),this.challengeName=e.name,e.name){case"A Matter of Years":this.minGateRegion=1,this.maxRunTime=Ke*(5-e.completions);break;case"Forged Ahead":this.minGateRegion=1,this.gearCostMulti=10+10*e.completions;break;case"Giant Lands":this.regionSize=[5,7],this.minGateRegion=e.completions,this.exploreSpeed=.04,this.fixedTraits=[{type:Ie,level:2+2*e.completions}];break;case"Lazy Townsfolk":this.minGateRegion=2+e.completions,this.buildingsAllowed=!1;break;case"Talentless":this.minGateRegion=2+e.completions,this.talentsEnabled=!1;break;case"Mega Monsters":this.minGateRegion=3+e.completions,this.startingTraits=4+2*e.completions;break;case"Outcast":this.productionMulti=.5-.1*e.completions,this.spendFriendship=!0,this.friendshipToProduction=!0,this.regionDifficultyIncrease=40+5*e.completions}}save(){return{mgr:this.minGateRegion,rs:this.regionSize,rdi:this.regionDifficultyIncrease,mgt:this.maxGearTier,mrt:this.maxResourceTier,ba:this.buildingsAllowed,ga:this.gearAllowed,gcm:this.gearCostMulti,mrun:this.maxRunTime,es:this.exploreSpeed,te:this.talentsEnabled,cn:this.challengeName,st:this.startingTraits,ft:this.fixedTraits,pm:this.productionMulti,sf:this.spendFriendship,ftp:this.friendshipToProduction}}load(e){this.minGateRegion=e.mgr,this.regionSize=e.rs,this.regionDifficultyIncrease=e.rdi,this.maxGearTier=e.mgt,this.maxResourceTier=e.mrt,this.buildingsAllowed=e.ba,this.gearAllowed=e.ga,this.gearCostMulti=e.gcm,this.maxRunTime=e.mrun,this.exploreSpeed=e.es,this.talentsEnabled=e.te,this.challengeName=e.cn,this.startingTraits=e.st,this.fixedTraits=e.ft,this.productionMulti=e.pm?e.pm:1,this.spendFriendship=!!e.sf&&e.sf,this.friendshipToProduction=!!e.ftp&&e.ftp}}class ht{constructor(){return ht.instance||(this.statBlock=new it(this),this.statChangedHandlers=[],this.resourceChangedHandlers=[],this.talentChangedHandlers=[],this._init(),ht.instance=this),ht.instance}static getInstance(){return ht.instance?ht.instance:new ht}_init(){this.shade=0,this.statPoints=3,this.talentPoints=Je.getInstance().challenges.talent.completions,this.statLevel=1,this.talentLevel=1,this.nextStatCost=$,this.nextTalentCost=ie,this.resources=[[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0]],this.craftingCosts=[1,1,1,1,1,1,1,1];for(var e=0;e<this.craftingCosts.length;e++)this.craftingCosts[e]=this.craftingCosts[e]*ot.getInstance().gearCostMulti,this.craftingCosts[e]=this.craftingCosts[e]*Math.pow(.925,Je.getInstance().challenges.forge.completions);this.resourceTierReached=0,this.gold=0,this.motes=0,this.challengeExploreMulti=1+.25*Je.getInstance().challenges.explore.completions,this.weapon=void 0,this.armor=void 0,this.trinket=void 0,this.talents={str:{name:"Strength",level:0,maxLevel:-1,requires:[],texture:{sprite:"icons",tile:0}},dex:{name:"Dexterity",level:0,maxLevel:-1,requires:[],texture:{sprite:"icons",tile:1}},agi:{name:"Agility",level:0,maxLevel:-1,requires:[],texture:{sprite:"icons",tile:2}},end:{name:"Endurance",level:0,maxLevel:-1,requires:[],texture:{sprite:"icons",tile:3}},rec:{name:"Recovery",level:0,maxLevel:-1,requires:[],texture:{sprite:"icons",tile:4}},def:{name:"Defense",level:0,maxLevel:-1,requires:[],texture:{sprite:"icons",tile:5}},acc:{name:"Accuracy",level:0,maxLevel:-1,requires:[],texture:{sprite:"icons",tile:6}},cleave:{name:"Cleave",level:0,maxLevel:5,requires:["str"],texture:{sprite:"icons",tile:8}},hit:{name:"Hit",level:0,maxLevel:-1,requires:["dex"],texture:{sprite:"icons",tile:9}},evasion:{name:"Evasion",level:0,maxLevel:-1,requires:["agi"],texture:{sprite:"icons",tile:10}},resilient:{name:"Resilient",level:0,maxLevel:-1,requires:["end"],texture:{sprite:"icons",tile:11}},quickrecovery:{name:"Quick Recovery",level:0,maxLevel:-1,requires:["rec"],texture:{sprite:"icons",tile:12}},block:{name:"Block",level:0,maxLevel:-1,requires:["def"],texture:{sprite:"icons",tile:13}},crit:{name:"Critical",level:0,maxLevel:-1,requires:["acc"],texture:{sprite:"icons",tile:14}},stun:{name:"Stunning Hit",level:0,maxLevel:5,requires:["cleave"],texture:{sprite:"icons",tile:16}},followthrough:{name:"Follow Through",level:0,maxLevel:5,requires:["hit"],texture:{sprite:"icons",tile:17}},dodge:{name:"Dodge",level:0,maxLevel:5,requires:["evasion"],texture:{sprite:"icons",tile:18}},defydeath:{name:"Defy Death",level:0,maxLevel:5,requires:["resilient"],texture:{sprite:"icons",tile:19}},secondwind:{name:"Second Wind",level:0,maxLevel:5,requires:["quickrecovery"],texture:{sprite:"icons",tile:20}},parry:{name:"Parry",level:0,maxLevel:5,requires:["block"],texture:{sprite:"icons",tile:21}},doublecrit:{name:"Double Crit",level:0,maxLevel:-1,requires:["crit"],texture:{sprite:"icons",tile:22}},bounty:{name:"Bounty",level:0,maxLevel:-1,requires:[],texture:{sprite:"icons",tile:7}},explorer:{name:"Explorer",level:0,maxLevel:-1,requires:[],texture:{sprite:"icons",tile:15}},guardian:{name:"Guardian",level:0,maxLevel:-1,requires:[],texture:{sprite:"icons",tile:39}},governance:{name:"Governance",level:0,maxLevel:-1,requires:[],texture:{sprite:"icons",tile:38}},lootgoblin:{name:"Loot Goblin",level:0,maxLevel:10,requires:["bounty"],texture:{sprite:"icons",tile:51}},bundle:{name:"Bundle",level:0,maxLevel:-1,requires:["explorer"],texture:{sprite:"icons",tile:52}},charisma:{name:"Charisma",level:0,maxLevel:-1,requires:["governance"],texture:{sprite:"icons",tile:53}},townguard:{name:"Town Guard",level:0,maxLevel:-1,requires:["guardian"],texture:{sprite:"icons",tile:50}}},this.runeBonuses={strPercent:0,strFlat:0,strTalents:0,dexPercent:0,dexFlat:0,dexTalents:0,agiPercent:0,agiFlat:0,agiTalents:0,endPercent:0,endFlat:0,endTalents:0,recPercent:0,recFlat:0,recTalents:0,defPercent:0,defFlat:0,defTalents:0,accPercent:0,accFlat:0,accTalents:0,hitPercent:0,evaPercent:0,regenPercent:0,weaponPercent:0,armorPercent:0,critPercent:0,healthPercent:0,weaponScaling:0,armorScaling:0,baseAttackSpeed:0,OOCRegen:0,enemyCrit:0,exploreSpeed:0,friendshipMulti:0,critChance:0,lootFlat:0,lootTalent:0,moteChance:0,shadeFlat:0,regenOnKill:0,dexToStr:0,endToRec:0,agiToDef:0,allPercent:0,guardianTalent:0,governanceTalent:0,agilityScaling:0},this.runes=[]}rebirth(){this.statBlock.rebirth(),this._init()}increaseStat(e,t){var i=Math.min(this.statPoints,t);if(0!=i){switch(this.statPoints-=i,e){case"str":this.statBlock.stats.strength+=i;break;case"dex":this.statBlock.stats.dexterity+=i;break;case"agi":this.statBlock.stats.agility+=i;break;case"end":this.statBlock.stats.endurance+=i;break;case"rec":this.statBlock.stats.recovery+=i;break;case"def":this.statBlock.stats.defense+=i;break;case"acc":this.statBlock.stats.accuracy+=i}this._onStatChanged()}}_onStatChanged(){for(var e=0;e<this.statChangedHandlers.length;e++)this.statChangedHandlers[e]()}_onResourcesChanged(){for(var e=0;e<this.resourceChangedHandlers.length;e++)this.resourceChangedHandlers[e]()}_onTalentChanged(){for(var e=0;e<this.talentChangedHandlers.length;e++)this.talentChangedHandlers[e]()}registerEvent(e,t){"onStatChanged"===e?this.statChangedHandlers.push(t):"onResourcesChanged"===e?this.resourceChangedHandlers.push(t):"onTalentChanged"===e&&this.talentChangedHandlers.push(t)}earnableMoonlight(e){return Je.getMoonlightEarned(this.statLevel-1+3*(this.talentLevel-1),e)}getExploreMulti(){return(1+.2*this.talents.explorer.level)*(1+this.runeBonuses.exploreSpeed)*(1+z*Math.pow(this.statBlock.Agility(),j+this.runeBonuses.agilityScaling))*(1+.1*Je.getInstance().moonperks.farstrider.level)*this.challengeExploreMulti}getStatCost(e){for(var t=0,i=0;i<e;i++)t+=$+ee*(this.statLevel-1+i);return t}getTalentCost(e){for(var t=0,i=.008*Je.getInstance().challenges.talent.completions,s=0;s<e;s++)t+=ie*Math.pow(se-i,this.talentLevel-1+s);return t}getTalentLevel(e){if(void 0===this.talents[e])return 0;switch(e){case"str":case"cleave":case"stun":return this.talents[e].level+this.runeBonuses.strTalents;case"dex":case"hit":case"followthrough":return this.talents[e].level+this.runeBonuses.dexTalents;case"agi":case"evasion":case"dodge":return this.talents[e].level+this.runeBonuses.agiTalents;case"end":case"resilient":case"defydeath":return this.talents[e].level+this.runeBonuses.endTalents;case"rec":case"quickrecovery":case"secondwind":return this.talents[e].level+this.runeBonuses.recTalents;case"def":case"block":case"parry":return this.talents[e].level+this.runeBonuses.defTalents;case"acc":case"crit":case"doublecrit":return this.talents[e].level+this.runeBonuses.accTalents;case"bounty":return this.talents[e].level+this.runeBonuses.lootTalent;case"governance":return this.talents[e].level+this.runeBonuses.governanceTalent;case"guardian":return this.talents[e].level+this.runeBonuses.guardianTalent}return this.talents[e].level}buyStat(e){for(var t=0;t<e;t++)this.statPoints+=te,this.shade-=this.nextStatCost,this.nextStatCost=$+ee*this.statLevel,this.statLevel+=1}buyTalent(e){for(var t=Je.getInstance().challenges.talent.completions>0?.02:0,i=0;i<e;i++)this.talentPoints+=1,this.shade-=this.nextTalentCost,this.nextTalentCost=ie*Math.pow(se-t,this.talentLevel),this.talentLevel+=1;this._onTalentChanged()}levelTalent(e){(e.level<e.maxLevel||-1===e.maxLevel)&&(e.level+=1,this.talentPoints-=1,this._onTalentChanged())}addResource(e,t){this.resourceTierReached=Math.max(this.resourceTierReached,t);for(var i=0;i<e.length;i++)this.resources[t][i]+=e[i];this._onResourcesChanged()}spendResource(e,t){for(var i=0;i<e.length;i++)this.resources[t][i]=Math.max(0,this.resources[t][i]-e[i]);this._onResourcesChanged()}addGold(e){var t=new vt;this.gold=Math.min(t.getGoldCap(),this.gold+e),this._onResourcesChanged()}addMote(e){this.motes+=e,this._onResourcesChanged()}addShade(e){this.shade+=e}addRune(e){this.runes.push(e)}removeRune(e){e<0||e>=this.runes.length||this.runes.splice(e,1)}equip(e){switch(e.slotType){case S:void 0!==this.weapon&&this.unequip(S),this.weapon=e,this.statBlock.equip(this.weapon);break;case H:void 0!==this.armor&&this.unequip(H),this.armor=e,this.statBlock.equip(this.armor);break;case _:void 0!==this.trinket&&this.unequip(_),this.trinket=e,this.statBlock.equip(this.trinket)}var t=e.getRuneBonuses();for(const e in t)this.runeBonuses[e]+=t[e];this._onStatChanged()}unequip(e){var t={};switch(e){case S:this.statBlock.unequip(this.weapon),t=this.weapon.getRuneBonuses(),this.weapon=void 0;break;case H:this.statBlock.unequip(this.armor),t=this.armor.getRuneBonuses(),this.armor=void 0;break;case _:this.statBlock.unequip(this.trinket),t=this.trinket.getRuneBonuses(),this.trinket=void 0}for(const e in t)this.runeBonuses[e]-=t[e];this._onStatChanged()}applyForgeUpgrade(e){for(var t=0;t<e;t++)this.craftingCosts[t]=this.craftingCosts[t]*We}save(){return{stats:this.statBlock.save(),shade:this.shade,sp:this.statPoints,tp:this.talentPoints,spl:this.statLevel,tpl:this.talentLevel,nsp:this.nextStatCost,ntp:this.nextTalentCost,res:this.resources,rtr:this.resourceTierReached,crf:this.craftingCosts,gold:this.gold,mote:this.motes,talents:this.talents,runes:this.runes,w:void 0===this.weapon?"":this.weapon.name,a:void 0===this.armor?"":this.armor.name,t:void 0===this.trinket?"":this.trinket.name}}load(e,t){this.statBlock.load(e.stats,t),this.shade=e.shade,this.statPoints=e.sp,this.talentPoints=e.tp,this.statLevel=e.spl,this.talentLevel=e.tpl,this.nextStatCost=e.nsp,this.nextTalentCost=e.ntp,this.resources=e.res,this.resourceTierReached=e.rtr,this.craftingCosts=e.crf,this.gold=e.gold,this.motes=e.mote,this.runes=void 0===e.runes?[]:e.runes;for(let t in Object.keys(e.talents))void 0!==this.talents[t]&&(this.talents[t]=e.talents[t]);var i=nt.getInstance();""!==e.w&&this.equip(i.getGearByName(e.w)),""!==e.a&&this.equip(i.getGearByName(e.a)),""!==e.t&&this.equip(i.getGearByName(e.t))}}class lt{static getTechGoldCost(e,t){var i=e.level,s=e.goldCosts[0],a=i*e.goldCosts[1],r=Math.pow(i*e.goldCosts[2],be),n=Math.pow(ve,t-1);return 5*Math.floor((s+a+r)/5*n)}static getTechResourceCost(e,t){for(var i=e.level,s=[],a=0;a<e.resources.length;a++){var r=e.resources[a][0],n=i*e.resources[a][1],o=Math.pow(i*e.resources[a][2],be),h=Math.pow(ve,t-1);s.push(5*Math.floor((r+n+o)/5*h))}return s}static calcFriendshipToLevel(e){var t=we-.015*Je.getInstance().challenges.outcast.completions;return ke+Math.floor(Math.pow(e*Te,t)/Te)*Te}constructor(e){var t=new Je;this.currentPopulation=50,this.maxPopulation=100,this.tavernPopulation=0,this.tier=e,this.economyMulti=1,this.bountyMulti=1,this.productionMulti=1,this.exploreMulti=1,this.townDefenseBonus=0,this.goldCapBonus=100*t.moonperks.heropouch.level,this.baseIncome=ue+.1*t.moonperks.vault.level,this.buildingIncome=0,this.townExplored=!1,this.researchEnabled=!1,this.alchemyEnabled=!1,this.friendship=0,this.friendshipLevel=0,this.friendshipToNext=25,this.tilesExplored=0,this.nightLabourActive=!1,this.buildings={forge:{name:"Forge",level:0,maxLevel:-1,requires:[],goldCosts:[50,25,15],resources:[[0,0,0],[0,0,0],[10,10,5],[0,0,0],[10,10,5],[0,0,0]]},guilds:{name:"Guilds",level:0,maxLevel:-1,requires:[],goldCosts:[100,50,25],resources:[[0,0,0],[10,10,5],[0,0,0],[10,10,5],[0,0,0],[10,10,5]]},townhall:{name:"Town Hall",level:0,maxLevel:-1,requires:[],goldCosts:[50,30,15],resources:[[15,10,8],[0,0,0],[0,0,0],[0,0,0],[10,10,5],[0,0,0]]}},this.upgrades={reinforcedhouses:{name:"Reinforced Houses",level:0,maxLevel:5,requires:[],goldCosts:[75,75,40],resources:[[0,0,0],[0,0,0],[20,20,10],[0,0,0],[40,40,20],[0,0,0]]},banking:{name:"Banking",level:0,maxLevel:-1,requires:[],goldCosts:[20,20,15],resources:[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[15,15,8],[10,10,5]]},mapmaking:{name:"Map Making",level:0,maxLevel:-1,requires:[],goldCosts:[25,25,15],resources:[[0,0,0],[10,10,5],[0,0,0],[5,5,5],[0,0,0],[0,0,0]]},tavern:{name:"Tavern",level:0,maxLevel:3,requires:[],goldCosts:[250,150,50],resources:[[150,150,40],[0,0,0],[0,0,0],[0,0,0],[100,100,35],[0,0,0]]},market:{name:"Market",level:0,maxLevel:3,requires:[],goldCosts:[400,250,60],resources:[[150,150,30],[75,75,30],[0,0,0],[75,75,30],[100,100,35],[75,75,30]]}}}increaseTechLevel(e){switch(e.level+=1,e.name){case"Forge":for(var t=new ht,i=0;i<this.tier;i++)t.craftingCosts[i]=t.craftingCosts[i]*We;break;case"Guilds":this.productionMulti+=.1;break;case"Town Hall":this.bountyMulti+=.1;break;case"Reinforced Houses":this.townDefenseBonus+=1,vt.getInstance().getCurrentRegion().handleReinforcedHouses();break;case"Banking":this.economyMulti+=.05,this.goldCapBonus+=50;break;case"Map Making":this.exploreMulti+=.1}}increaseMaxPop(e){this.maxPopulation+=e}calculateEconMulti(e){this.economyMulti=1+e+.05*this.upgrades.banking.level}getTownIncome(){var e=new ht;return(Math.floor(this.currentPopulation)*this.baseIncome+this.buildingIncome)*this.economyMulti*(1+.04*e.getTalentLevel("governance"))}getGoldCap(){var e=new ht,t=2*Je.getInstance().moonperks.crownlands.level;return(this.currentPopulation*me+this.goldCapBonus+t)*this.economyMulti*(1+.04*e.getTalentLevel("governance"))}getMaxPopulation(){return this.maxPopulation+this.tavernPopulation}getMarketLevel(){return this.upgrades.market.level}getTavernLevel(){return this.upgrades.tavern.level}setTavernPopulation(e){this.tavernPopulation=e}setTilesExplored(e){this.tilesExplored=e}getProductionMulti(){var e=!0===this.nightLabourActive?1+.1*Je.getInstance().moonperks.nightlabour.level:1,t=this.productionMulti*(1+.01*this.friendshipLevel*Je.getInstance().moonperks.motivatedlabor.level)*e*ot.getInstance().productionMulti;return!0===ot.getInstance().friendshipToProduction?t+.05*this.friendshipLevel:t}addFriendship(e){this.friendship+=e,this.friendship>=this.friendshipToNext&&(this.friendshipLevel+=1,this.friendshipToNext=lt.calcFriendshipToLevel(this.friendshipLevel))}spendFriendship(e){this.friendship=Math.max(0,this.friendship-e);for(var t=0;t<this.friendshipLevel;t++){var i=lt.calcFriendshipToLevel(t);if(this.friendship<i){this.friendshipLevel=t,this.friendshipToNext=i;break}}}getFriendshipBonus(){return 1+this.friendshipLevel*xe}toggleNightLabour(){!0===this.nightLabourActive?(this.baseIncome=ue+.1*moonData.moonperks.vault.level,this.nightLabourActive=!1):(this.baseIncome=(ue+.1*moonData.moonperks.vault.level)/2,this.nightLabourActive=!0)}endOfDay(){}endOfWeek(){!0===this.townExplored&&(this.currentPopulation=Math.min(this.getMaxPopulation(),this.currentPopulation*ge),ht.getInstance().addGold(this.getTownIncome()),ht.getInstance().addShade(.1*this.currentPopulation*Je.getInstance().moonperks.shadow3.level))}save(){var e=[];for(const t in this.buildings)e.push([t,this.buildings[t].level]);var t=[];for(const e in this.upgrades)t.push([e,this.upgrades[e].level]);return{cp:this.currentPopulation,mp:this.maxPopulation,t:this.tier,em:this.economyMulti,bm:this.bountyMulti,pm:this.productionMulti,exm:this.exploreMulti,bi:this.baseIncome,bld:e,up:t,gc:this.goldCapBonus,te:this.townExplored,re:this.researchEnabled,fr:this.friendship,frl:this.friendshipLevel,alc:this.alchemyEnabled,tl:this.tilesExplored}}load(e,t){this.currentPopulation=e.cp,this.maxPopulation=e.mp,this.tier=e.t,this.economyMulti=e.em,this.bountyMulti=e.bm,this.productionMulti=e.pm,this.exploreMulti=e.exm,this.baseIncome=e.bi,this.goldCapBonus=e.gc,this.townExplored=e.te,this.researchEnabled=e.re,this.friendship=e.fr,this.friendshipLevel=e.frl,this.alchemyEnabled=e.alc,this.tilesExplored=e.tl?e.tl:0,this.friendshipToNext=lt.calcFriendshipToLevel(this.friendshipLevel);for(var i=0;i<e.bld.length;i++)this.buildings[e.bld[i][0]].level=e.bld[i][1];for(i=0;i<e.up.length;i++)this.upgrades[e.up[i][0]].level=e.up[i][1]}}var ct={TILE_TYPES:{mountain:{name:"Mountains",enemies:["wolf","bear","goblin","formation"],clr:[140,110,0],explorationNeeded:25e3,yields:[1.25,0,2.25,0,1.5,1]},drakemountain:{name:"Drake Mountains",enemies:["wolf","bear","goblin","formation","drake"],clr:[130,30,30],explorationNeeded:27500,yields:[0,0,2.25,0,2.25,1.5]},forest:{name:"Forest",enemies:["wolf","bear","plant","bloom","slime","goblin"],clr:[0,160,0],explorationNeeded:13e3,yields:[1.75,1.25,0,1.5,0,0]},wode:{name:"Wode",enemies:["wolf","bear","plant","bloom","slime","elk"],clr:[0,130,30],explorationNeeded:16e3,yields:[2.25,1,0,1.5,0,.6]},ancientforest:{name:"Ancient Forest",enemies:["bear","moss","plant","elk","bloom"],clr:[0,90,0],explorationNeeded:2e4,yields:[2.5,0,0,1.25,1,1]},plains:{name:"Plains",enemies:["slime","goblin","lizard","bloom"],clr:[20,220,20],explorationNeeded:9e3,yields:[.9,2.5,0,1.25,.75,0]},savanna:{name:"Savanna",enemies:["gnoll","lion","coyote","lizard","bloom"],clr:[190,190,60],explorationNeeded:13e3,yields:[.75,1.5,0,2,1.25,0]},desert:{name:"Desert",enemies:["formation","coyote","slime","cactus"],clr:[220,190,140],explorationNeeded:12e3,yields:[.75,0,0,0,1.75,2]},hills:{name:"Hills",enemies:["slime","goblin","lizard","bloom","formation"],clr:[130,190,50],explorationNeeded:11e3,yields:[0,1,0,0,2.75,.75]},plateau:{name:"Plateau",enemies:["elk","goblin","lizard","cactus","wolf"],clr:[200,120,40],explorationNeeded:15e3,yields:[0,3,0,.75,2,0]},lake:{name:"Lake",enemies:["whale","slime","bear","fish"],clr:[20,40,170],explorationNeeded:19e3,yields:[0,0,0,0,0,0]},oasis:{name:"Oasis",enemies:["catfish","fish","coyote","cactus"],clr:[0,140,190],explorationNeeded:15e3,yields:[0,0,0,0,0,0]},swamp:{name:"Swamp",enemies:["lizard","slime","goblin","bloom"],clr:[0,110,90],explorationNeeded:19e3,yields:[1,1.5,0,2.25,0,.7]},town:{name:"Town",enemies:["wolf"],clr:[230,230,230],explorationNeeded:10,yields:[0,0,0,0,0,0]},mysticgate:{name:"Mystic Gate",enemies:["gateguardian"],clr:[153,50,204],explorationNeeded:3e4,yields:[0,0,0,0,0,0]}},REGION_TYPES:{temperate:{name:"Temperate",points:[{terrain:"mountain",power:[7,12],amount:2},{terrain:"mountain",power:[3,7],amount:3},{terrain:"forest",power:[6,11],amount:2},{terrain:"forest",power:[4,9],amount:1},{terrain:"wode",power:[5,10],amount:2},{terrain:"wode",power:[3,8],amount:2},{terrain:"plains",power:[4,9],amount:5},{terrain:"lake",power:[4,9],amount:3},{terrain:"swamp",power:[3,8],amount:2},{terrain:"swamp",power:[5,10],amount:1},{terrain:"hills",power:[3,8],amount:5}]},mountains:{name:"Mountains",points:[{terrain:"mountain",power:[7,12],amount:3},{terrain:"mountain",power:[3,7],amount:4},{terrain:"forest",power:[4,9],amount:3},{terrain:"wode",power:[5,10],amount:2},{terrain:"wode",power:[3,6],amount:4},{terrain:"plateau",power:[3,7],amount:4},{terrain:"lake",power:[4,9],amount:3},{terrain:"hills",power:[3,8],amount:4},{terrain:"drakemountain",power:[5,8],amount:3}]},desert:{name:"Desert",points:[{terrain:"mountain",power:[3,6],amount:4},{terrain:"forest",power:[3,5],amount:4},{terrain:"plateau",power:[3,6],amount:3},{terrain:"oasis",power:[3,5],amount:3},{terrain:"hills",power:[3,6],amount:3},{terrain:"savanna",power:[3,5],amount:5},{terrain:"desert",power:[7,10],amount:5}]},forest:{name:"Forest",points:[{terrain:"mountain",power:[7,12],amount:2},{terrain:"forest",power:[6,9],amount:4},{terrain:"wode",power:[5,8],amount:3},{terrain:"plains",power:[4,6],amount:2},{terrain:"ancientforest",power:[5,7],amount:4},{terrain:"lake",power:[8,11],amount:2},{terrain:"swamp",power:[4,9],amount:3},{terrain:"hills",power:[3,8],amount:2}]},hills:{name:"Hills",points:[{terrain:"mountain",power:[4,7],amount:1},{terrain:"forest",power:[3,6],amount:3},{terrain:"plateau",power:[3,7],amount:4},{terrain:"plains",power:[4,6],amount:3},{terrain:"lake",power:[6,8],amount:2},{terrain:"savanna",power:[3,5],amount:3},{terrain:"hills",power:[4,7],amount:3}]}}};class dt{static getBuildingByName(e){switch(e){case"wood":return new gt("Lumberyard","wood",1,ut.PRODUCTION,{sprite:"bldicons",tile:0,w:32,h:32},[0,15,0,30,45,0],50,5);case"leather":return new gt("Hunter's Lodge","leather",1,ut.PRODUCTION,{sprite:"bldicons",tile:1,w:32,h:32},[60,0,30,0,0,0],50,5);case"metal":return new gt("Mine","metal",1,ut.PRODUCTION,{sprite:"bldicons",tile:2,w:32,h:32},[30,0,0,0,45,15],50,5);case"fiber":return new gt("Herbalist's Hut","fiber",1,ut.PRODUCTION,{sprite:"bldicons",tile:3,w:32,h:32},[45,30,0,0,0,15],50,5);case"stone":return new gt("Quarry","stone",1,ut.PRODUCTION,{sprite:"bldicons",tile:4,w:32,h:32},[20,0,60,0,0,0],50,5);case"crystal":return new gt("Crystal Loom","crystal",1,ut.PRODUCTION,{sprite:"bldicons",tile:5,w:32,h:32},[30,0,15,0,45,0],50,5);case"house":return new gt("Town House","house",1,ut.HOUSE,{sprite:"bldicons",tile:6,w:32,h:32},[5,5,5,5,5,0],15,5);case"watchtower":return new gt("Watch Tower","watchtower",1,ut.OTHER,{sprite:"bldicons",tile:7,w:32,h:32},[25,0,0,0,40,0],40,5);case"market":return new gt("Market","market",1,ut.ECON,{sprite:"bldicons",tile:32,w:32,h:32},[20,10,0,10,10,10],50,5);case"tavern":return new gt("Tavern","tavern",1,ut.HOUSE,{sprite:"bldicons",tile:33,w:32,h:32},[20,5,0,15,0,5],50,5);case"road":return new gt("Road","road",1,ut.ROAD,{sprite:"roadicons",tile:0,w:32,h:32},[5,0,0,0,3,0],5,7);case"docks":return new gt("Docks","docks",1,ut.ROAD,{sprite:"bldicons",tile:34,w:32,h:32},[15,10,0,0,10,0],50,5);case"town":return new gt("Town","town",3,ut.ROAD,{sprite:"roadicons",tile:38,w:50,h:50},[15,10,0,0,10,0],50,5);case"alchemy":return new gt("Alchemy Lab","alchemy",1,ut.ECON,{sprite:"bldicons",tile:35,w:32,h:32},[10,0,20,0,10,15],150,5);case"warehouse":return new gt("Warehouse","warehouse",1,ut.OTHER,{sprite:"bldicons",tile:36,w:32,h:32},[25,5,0,5,25,0],75,5)}}}const ut={PRODUCTION:0,ROAD:1,HOUSE:2,ECON:3,OTHER:4};class gt{constructor(e,t,i,s,a,r,n,o){this.name=e,this.regName=t,this.tier=i,this.buildingType=s,this.texture=a,this.resourceCosts=r,this.goldCost=n,this.costMulti=o}increaseCosts(){for(var e=0;e<this.resourceCosts.length;e++)this.resourceCosts[e]=this.resourceCosts[e]*this.costMulti;this.goldCost=this.goldCost*this.costMulti}save(){return{t:this.tier,reg:this.regName}}static loadFromFile(e,t){for(var i=dt.getBuildingByName(e.reg),s=i.tier;s<=e.t;s++)i.increaseCosts();return i.tier=e.t,i}static getTooltip(e,t,i,s=!1){var a=vt.getInstance().getCurrentRegion(),r=1+e.defense*Je.getInstance().moonperks.moonlightworkers.level*.01,n=e.roadBonus*a._getBuildingEfficiency(e.x,e.y,s);r=r*a.townData.getProductionMulti()*n;switch(t){case"Lumberyard":var o=i*e.yields[0]*r;return"Produces "+Math.floor(100*o)/100+" Wood at the end of each day. Production at "+Math.floor(100*n)+"% based on distance to roads and other buildings.";case"Hunter's Lodge":o=i*e.yields[1]*r;return"Produces "+Math.floor(100*o)/100+" Leather at the end of each day. Production at "+Math.floor(100*n)+"% based on distance to roads and other buildings.";case"Mine":o=i*e.yields[2]*r;return"Produces "+Math.floor(100*o)/100+" Metal at the end of each day. Production at "+Math.floor(100*n)+"% based on distance to roads and other buildings.";case"Herbalist's Hut":o=i*e.yields[3]*r;return"Produces "+Math.floor(100*o)/100+" Fiber at the end of each day. Production at "+Math.floor(100*n)+"% based on distance to roads and other buildings.";case"Quarry":o=i*e.yields[4]*r;return"Produces "+Math.floor(100*o)/100+" Stone at the end of each day. Production at "+Math.floor(100*n)+"% based on distance to roads and other buildings.";case"Crystal Loom":o=i*e.yields[5]*r;return"Produces "+Math.floor(100*o)/100+" Crystal at the end of each day. Production at "+Math.floor(100*n)+"% based on distance to roads and other buildings.";case"Town House":return"Increases the Town's max population by "+5*i+".";case"Watch Tower":return"Increases the defense of all tiles within 2 tiles of this watch tower by "+2*i+".";case"Market":var h=Qe.nearestPointInList(e.x,e.y,a.markets,!0),l=5+Je.getInstance().moonperks.nightmarket.level,c=Math.max(0,Math.min(l,h[1]/ye*l))*i/100;return"Increases the Town's economy by "+Math.floor(1e4*c)/100+"%, based on distance to the Town and other Markets.";case"Tavern":c=0;for(var d=0,u=Math.max(0,e.y-1);u<Math.min(a.height,e.y+1+1);u++)for(var g=Math.max(0,e.x-1);g<Math.min(a.width,e.x+1+1);g++)Math.abs(u-e.y)+Math.abs(g-e.x)<=1&&void 0!==a.map[u][g].building&&"Town House"===a.map[u][g].building.name&&(c+=.02,d+=1);return"Increases the Town's population by "+d+" and economy by "+Math.floor(i*c*100)+"%, based on nearby Town Houses.";case"Road":return"Most buildings must be built adjacent to roads. Production buildings get a boost being adjacent to a road, and produce nothing when more than "+i+" tiles away.";case"Docks":var p=a._getDockEfficiency(e.x,e.y,s);c=i*Ce*a.townData.economyMulti*p;return"Docks don't need roads and enables roads to be built beside them. Increases gold earned per week by "+Math.floor(c)+".";case"Alchemy Lab":var m=Math.floor([.05,.3,.9,3,8][i-1]*(1+Je.getInstance().moonperks.mysticcauldron.level)*100)/100;return"Through strange magic converts "+[1,5,13,33,77][i-1]+" of all resources into "+m+" of resources of the next highest tier each day.";case"Warehouse":return"Stores goods for transport, increasing production of nearby buildings by "+(c=20*i)+"%."}}}class pt{constructor(e=65280,t=0,i=0){this.regName="plains",this.explored=!1,this.revealed=!1,this.difficulty=0,this.amountExplored=0,this.isInvaded=!1,this.invasionPower=0,this.invasionFights=0,this.building=void 0,this.defense=0,this.hasRune=!1,this.x=t,this.y=i,this.name="",this.exploreSpeed=1,this.color=e,this.borderColor=[255,255,255],this.explorationNeeded=1e3,this.enemies=[],this.yields=[],this.roadDist=-1,this.roadBonus=0,this.roadBuildable=!1,this.dockBuildable=!1,this.houseBuildable=!1,this.parent=void 0}save(){return{exp:this.explored,rev:this.revealed,dif:this.difficulty,rn:this.regName,ae:this.amountExplored,in:this.isInvaded,ip:this.invasionPower,if:this.invasionFights,bld:void 0===this.building?"":this.building.save(),def:this.defense,hr:this.hasRune,x:this.x,y:this.y}}static loadFromSave(e,t){var i=new pt;return i.regName=e.rn,i.explored=e.exp,i.revealed=e.rev,i.difficulty=e.dif,i.amountExplored=e.ae,i.isInvaded=e.in,i.invasionPower=e.ip,i.invasionFights=e.if,i.building=""===e.bld?void 0:gt.loadFromFile(e.bld,t),i.defense=e.def,i.hasRune=void 0!==e.hr&&e.hr,i.x=e.x,i.y=e.y,i}init(e,t,i,s){var a=ct.TILE_TYPES[e];this.regName=e,this.difficulty=t,this.exploreSpeed=1+t*pe,this.color=a.clr,this.name=a.name,this.enemies=a.enemies,this.explorationNeeded=a.explorationNeeded;var r=i+ot.getInstance().regionDifficultyIncrease,n=Math.min(1,Math.max(0,t-i)/r);this.borderColor=[255,255-(n>.5?255*(n-.5)*2:0),255-Math.min(255,255*n*2)],this.yields=[],this.parent=s}sighting(){this.isInvaded=!0,this.invasionPower=0,this.invasionFights=5}invade(e=!0){this.isInvaded=!1,this.invasionPower=0,this.amountExplored=0,this.invasionFights=0,!0===e&&(this.explored=!1,this.revealed=!0)}getInvasionMulti(){return Math.min(5,Math.floor(Math.max(0,Math.log2(this.invasionPower/_e))))}getFriendshipReward(){return 1+.05*(this.difficulty-this.parent.regionLevel*ot.getInstance().regionDifficultyIncrease)}explore(e){if(!0===this.explored)return!1;var t=ht.getInstance().getExploreMulti()*ot.getInstance().exploreSpeed*vt.getInstance().getCurrentRegion().townData.exploreMulti;return t/=this.exploreSpeed,this.amountExplored+=e*t,this.amountExplored>=this.explorationNeeded&&!1===this.explored}incInvasionPower(e){if(this.getInvasionMulti()<5){var t=e+this.defense,i=Math.max(.1,1+.1*(this.difficulty-t));this.invasionPower+=qe*i}}generateMonsters(){var e=[];if(!0===this.isInvaded){var t=this.difficulty+this.getInvasionMulti();e.push(tt.GetCreatureByName(this.enemies[Qe.randint(0,this.enemies.length)],t)),e.push(tt.GetCreatureByName(this.enemies[Qe.randint(0,this.enemies.length)],this.difficulty-1)),e.push(tt.GetCreatureByName(this.enemies[Qe.randint(0,this.enemies.length)],this.difficulty-1))}else for(var i=this.difficulty<30?1:2,s=(this.difficulty<5?2:3)+(this.difficulty>15?1:0),a=this.difficulty>0?Qe.randint(i,s):1,r=0;r<a;r++)if(Math.random()<=.005*ht.getInstance().getTalentLevel("lootgoblin"))e.push(tt.GetCreatureByName("lootgoblin",this.difficulty));else{var n=Qe.randint(0,this.enemies.length);e.push(tt.GetCreatureByName(this.enemies[n],this.difficulty))}for(r=0;r<e.length;r++){e[r].level>100&&Math.random()<.05&&e[r].addTrait("Dire",1);for(var o=0;o<this.parent.traits.length;o++)e[r].addTrait(this.parent.traits[o].type,this.parent.traits[o].level);e[r].applyTraits()}return e}}class mt{constructor(e=8,t=8,i,s,a,r=!1){if(this.tileChangedHandler=void 0,this.sightingHandler=void 0,this.resourcesPerDay=[0,0,0,0,0,0],this.taverns=[],this.roads=[],this.markets=[],this.productionBuildings=[],this.warehouses=[],this.alchemyDrain=0,this.alchemyGain=0,!0===r)return!0;this.width=e,this.height=t,this.regionLevel=i,this.townData=new lt(i+1),this.tilesExplored=0,this.sightings=[],this.sightingsDelay=0,this.invasionCounter=0,this.worldHeight=350,this.type=s,this.map=[];for(var n=0;n<t;n++){for(var o=[],h=0;h<e;h++)o.push(new pt(0,h,n));this.map.push(o)}this.traits=a;var l=[];for(n=0;n<ct.REGION_TYPES[s].points.length;n++)for(var c=ct.REGION_TYPES[s].points[n],d=0;d<c.amount;d++)l.push({x:Qe.randint(0,e),y:Qe.randint(0,t),power:Qe.randint(c.power[0],c.power[1]),terrainData:c.terrain});this.generateTerrain(l),this._init()}save(){for(var e=[],t=0;t<this.height;t++){for(var i=[],s=0;s<this.width;s++)i.push(this.map[t][s].save());e.push(i)}return{w:this.width,h:this.height,rl:this.regionLevel,td:this.townData.save(),te:this.tilesExplored,map:e,sight:this.sightings,sd:this.sightingsDelay,ic:this.invasionCounter,wh:this.worldHeight,type:this.type,tr:this.traits}}static loadFromSave(e,t){var i=new mt(0,0,0,"temperate",[],!0);i.width=e.w,i.height=e.h,i.regionLevel=e.rl,i.townData=new lt(1),i.townData.load(e.td),i.tilesExplored=e.te,i.sightings=e.sight,i.sightingsDelay=e.sd,i.invasionCounter=e.ic,i.worldHeight=e.wh,i.type=e.type,i.traits=e.tr,i.map=[];for(var s=0;s<e.map.length;s++){for(var a=[],r=0;r<e.map[s].length;r++){var n=pt.loadFromSave(e.map[s][r],t);n.init(n.regName,n.difficulty,i.regionLevel*ot.getInstance().regionDifficultyIncrease,i),a.push(n)}i.map.push(a)}for(s=0;s<i.height;s++)for(r=0;r<i.width;r++)i.map[s][r].yields=i._getTileYields(r,s);return i._init(),i}_getTileYields(e,t){for(var i=ct.TILE_TYPES[this.map[t][e].regName].yields,s=[0,0,0,0,0,0],a=Math.max(0,t-1);a<Math.min(this.height,t+2);a++)for(var r=Math.max(0,e-1);r<Math.min(this.width,e+2);r++)for(var n=0;n<s.length;n++)0!==i[n]&&(s[n]+=ct.TILE_TYPES[this.map[a][r].regName].yields[n]*Re);return s[0]=s[0]*(1+.05*Je.getInstance().moonperks.wood.level),s[1]=s[1]*(1+.05*Je.getInstance().moonperks.leather.level),s[2]=s[2]*(1+.05*Je.getInstance().moonperks.metal.level),s[3]=s[3]*(1+.05*Je.getInstance().moonperks.fiber.level),s[4]=s[4]*(1+.05*Je.getInstance().moonperks.stone.level),s[5]=s[5]*(1+.05*Je.getInstance().moonperks.crystal.level),s}generateTerrain(e){var t=this.regionLevel*ot.getInstance().regionDifficultyIncrease,i=t+ot.getInstance().regionDifficultyIncrease,s=[Math.floor(this.width/2),this.height-3],a=[s[0]+Math.floor(2*Math.random())];a.push(s[1]+2-Math.abs(s[0]-a[0]));var r=[];r.push({x:s[0],y:s[1],power:t-2}),r.push({x:a[0],y:a[1],power:t-4});for(var n=0;n<8;n++){for(var o=Qe.randint(0,this.width),h=Qe.randint(0,this.height);Qe.pointInList(o,h,r);)o=Qe.randint(0,this.width),h=Qe.randint(0,this.height);var l=t+Qe.getDistance(o,h,s[0],s[1])/(.7*this.height)*ot.getInstance().regionDifficultyIncrease;r.push({x:o,y:h,power:l+Qe.randint(-4,4)})}for(n=0;n<this.height;n++)for(var c=0;c<this.width;c++){var d=Qe.nearestPointsInList(c,n,e,2),u=void 0;u=e[d[0][0]].power/(1+d[0][1])>e[d[1][0]].power/(1+d[1][1])?e[d[0][0]].terrainData:e[d[1][0]].terrainData,d=Qe.nearestPointInList(c,n,r);var g=t+Qe.getDistance(c,n,s[0],s[1])/(.79*this.height)*ot.getInstance().regionDifficultyIncrease,p=Math.max(t,Math.min(i-1,Math.floor(g+(r[d[0]].power-g)/(2+d[1]))));this.map[n][c].init(u,p,t,this)}var m=[-1,-1];if(this.regionLevel>=ot.getInstance().minGateRegion){var y=[],v=0,b=[0,0];for(n=0;n<this.height;n++)for(c=0;c<this.width;c++)this.map[n][c].difficulty>=i-1&&y.push([n,c]),this.map[n][c].difficulty>v&&(b[0]=n,b[1]=c,v=this.map[n][c].difficulty);y.push(b),m=y[Qe.randint(0,y.length)],this.map[m[0]][m[1]].init("mysticgate",i,t,this)}var f=Je.getInstance().moonperks.runes.level>0?5:0;f+=Je.getInstance().moonperks.runelands.level;var x=(e,t)=>!(!1!==this.map[t][e].hasRune||e===s[0]&&t===s[1]||e===m[1]&&t===m[0]);for(n=0;n<f;n++){var w=Qe.randint(0,this.width),k=Qe.randint(0,this.height);if(!0===x(w,k))this.map[k][w].hasRune=!0;else{var T=k*this.width+w;for(c=0;c<20;c++){var C=(T+c)%(this.width*this.height);if(!0===x(w=C%this.width,k=Math.floor(C/this.width))){this.map[k][w].hasRune=!0;break}}}}for(n=0;n<this.height;n++)for(c=0;c<this.width;c++)this.map[n][c].yields=this._getTileYields(c,n);this.map[s[1]][s[0]].init("town",t,t,this),this.map[s[1]][s[0]].building=dt.getBuildingByName("town"),this.placeBuilding(s[0],s[1],dt.getBuildingByName("town")),this.map[a[1]][a[0]].revealed=!0}onTileChanged(e){this.tileChangedHandler=e}removeHandlers(){this.tileChangedHandler=void 0,this.sightingHandler=void 0}onSighting(e){this.sightingHandler=e}_onTileChanged(e){void 0!==this.tileChangedHandler&&this.tileChangedHandler(e)}getExplorePercent(){return this.tilesExplored/(this.width*this.height)}isExplorable(e,t){return this.map[t][e].revealed}exploreTile(e,t){if(!0===this.map[t][e].revealed&&!0!==this.map[t][e].explored){if(this.tilesExplored+=1,this.townData.setTilesExplored(this.tilesExplored),this.map[t][e].explored=!0,this.townData.addFriendship(10*Je.getInstance().moonperks.discovery.level),!0===this.map[t][e].hasRune){this.map[t][e].hasRune=!1;var i=at.getRandomRuneAtLevel(this.regionLevel+1);ht.getInstance().addRune(i)}"Town"===this.map[t][e].name&&(this.townData.townExplored=!0),this.tilesExplored>=10&&(this.townData.researchEnabled=!0),t>0&&(this.map[t-1][e].revealed=!0,this._onTileChanged(this.map[t-1][e])),t<this.height-1&&(this.map[t+1][e].revealed=!0,this._onTileChanged(this.map[t+1][e])),e>0&&(this.map[t][e-1].revealed=!0,this._onTileChanged(this.map[t][e-1])),e<this.width-1&&(this.map[t][e+1].revealed=!0,this._onTileChanged(this.map[t][e+1]))}return this.regionLevel>0&&this.regionLevel<=8&&!1===vt.getInstance().getRegion(this.regionLevel-1).townData.alchemyEnabled&&(vt.getInstance().getRegion(this.regionLevel-1).townData.alchemyEnabled=!0,Ze.getInstance().registerFeatureUnlocked(v,"You recieved a letter from the previous town. A mysterious old man came through and taught them the magic of alchemy. You may now build alchemy labs to convert tier "+(this.regionLevel-1)+" resources to tier "+this.regionLevel+" resources at a horribly inefficient rate! Thanks mysterious old man!")),this._onTileChanged(this.map[t][e]),this.map[t][e]}_invade(){this.invasionCounter=0;var e=this.sightings[Qe.randint(0,this.sightings.length)];Math.random()<=e.defense*ht.getInstance().getTalentLevel("townguard")*.005?(this.map[e[0]][e[1]].invade(!1),this.townData.currentPopulation=this.townData.currentPopulation*Ge):(this.map[e[0]][e[1]].invade(),null!=this.map[e[0]][e[1]].building&&this.destroyBuilding(e[1],e[0]),this.townData.currentPopulation=this.townData.currentPopulation*Ge,this.tilesExplored-=1,this.townData.setTilesExplored(this.tilesExplored)),this.endSighting(e[1],e[0])}_addSighting(){var e=Math.min(Oe*(1+this.sightings.length*Fe),Ue),t=Math.min(2*e,Ue);this.sightingsDelay=1e3*Qe.randint(e,t);for(var i=[],s=1;s<this.height-1;s++)for(var a=1;a<this.width-1;a++)if(!1!==this.map[s][a].explored&&"Town"!==this.map[s][a].name&&"Mystic Gate"!==this.map[s][a].name&&!0!==this.map[s][a].isInvaded){for(var r=!1,n=-1;n<2;n++)for(var o=-1;o<2;o++)!0===this.map[s+n][a+o].revealed&&!1===this.map[s+n][a+o].explored&&(r=!0);!0===r&&i.push([s,a])}if(!(i.length<=0)){var h=i[Qe.randint(0,i.length)];this.sightings.push(h),this.map[h[0]][h[1]].sighting(),void 0!==this.sightingHandler&&this.sightingHandler()}}endSighting(e,t){this.map[t][e].isInvaded=!1,this.map[t][e].invasionPower=0,this.invasionCounter=Math.max(0,this.invasionCounter-Ae),this.sightings=this.sightings.filter(e=>!0===this.map[e[0]][e[1]].isInvaded),this._onTileChanged(this.map[t][e])}_canDock(e,t){return t>0&&this.map[t-1][e].name!=this.map[t][e].name||t<this.height-1&&this.map[t+1][e].name!=this.map[t][e].name||e>0&&this.map[t][e-1].name!=this.map[t][e].name||e<this.width-1&&this.map[t][e+1].name!=this.map[t][e].name}_init(){this.roads=[],this.markets=[{x:Math.floor(this.width/2),y:this.height-3}],this.taverns=[],this.productionBuildings=[],this.warehouses=[];for(var e=0;e<this.height;e++)for(var t=0;t<this.width;t++)void 0!==this.map[e][t].building&&("Road"===this.map[e][t].building.name||"Town"===this.map[e][t].building.name?this.roads.push([e,t]):"Market"===this.map[e][t].building.name?this.markets.push({x:t,y:e}):"Tavern"===this.map[e][t].building.name?this.taverns.push([e,t]):"Warehouse"===this.map[e][t].building.name?this.warehouses.push([e,t]):"Town House"!==this.map[e][t].building.name&&this.productionBuildings.push([e,t])),"Lake"!==this.map[e][t].name&&"Oasis"!==this.map[e][t].name||(this.map[e][t].dockBuildable=this._canDock(t,e));this._calculateTileBonuses()}_getBuildingEfficiency(e,t,i=!1){let s=!1===i?0:1;for(var a=Math.max(0,t-1);a<Math.min(this.height,t+2);a++)for(var r=Math.max(0,e-1);r<Math.min(this.width,e+2);r++)if(void 0!==this.map[a][r].building)switch(this.map[a][r].building.buildingType){case ut.PRODUCTION:s+=1;break;case ut.ECON:s+=.3;break;case ut.HOUSE:s+=.15}return Math.pow(Me,s-1)}_getDockEfficiency(e,t,i=!1){let s=!1===i?0:1;for(var a=Math.max(0,t-1);a<Math.min(this.height,t+2);a++)for(var r=Math.max(0,e-1);r<Math.min(this.width,e+2);r++)void 0!==this.map[a][r].building&&"Docks"===this.map[a][r].building.name&&(s+=1);return Math.pow(Me,s-1)}_calculateTileBonuses(){var e=0,t=0;this.townData.buildingIncome=0,this.resourcesPerDay=[0,0,0,0,0,0],this.alchemyDrain=0,this.alchemyGain=0;for(var i=0;i<this.height;i++)for(var s=0;s<this.width;s++)this.map[i][s].roadDist=-1,this.map[i][s].roadBonus=0,this.map[i][s].roadBuildable=!1,this.map[i][s].houseBuildable=!1;var a=[[1,.5,0],[1.25,.75,.25],[1.5,1,.5]];for(i=0;i<this.roads.length;i++)for(var r=3,n=this.map[this.roads[i][0]][this.roads[i][1]].building.tier,o=Math.max(0,this.roads[i][0]-r);o<Math.min(this.height,this.roads[i][0]+r+1);o++)for(var h=Math.max(0,this.roads[i][1]-r);h<Math.min(this.width,this.roads[i][1]+r+1);h++){var l=Math.abs(o-this.roads[i][0])+Math.abs(h-this.roads[i][1]);Math.abs(o-this.roads[i][0])+Math.abs(h-this.roads[i][1])<=r&&(this.map[o][h].roadDist=-1===this.map[o][h].roadDist?l:Math.min(this.map[o][h].roadDist,l),this.map[o][h].roadBuildable=this.map[o][h].roadDist<=1,this.map[o][h].roadBonus=Math.max(this.map[o][h].roadBonus,a[n-1][l-1]),this.map[o][h].houseBuildable=this.map[o][h].houseBuildable||Math.abs(o-this.roads[i][0])<=1&&Math.abs(h-this.roads[i][1])<=1)}var c=Math.floor(this.width/2),d=this.height-3;this.map[d][c-1].roadBuildable=!0,this.map[d][c+1].roadBuildable=!0,this.map[d-1][c].roadBuildable=!0,this.map[d+1][c].roadBuildable=!0;for(i=1;i<this.markets.length;i++){var u=5+Je.getInstance().moonperks.nightmarket.level,g=(n=this.map[this.markets[i].y][this.markets[i].x].building.tier,Qe.nearestPointInList(this.markets[i].x,this.markets[i].y,this.markets,!0));e+=Math.max(0,Math.min(u,g[1]/ye*u))*n/100}for(i=0;i<this.taverns.length;i++){r=1+Je.getInstance().moonperks.moonwine.level;var p=0;for(n=this.map[this.taverns[i][0]][this.taverns[i][1]].building.tier,o=Math.max(0,this.taverns[i][0]-r);o<Math.min(this.height,this.taverns[i][0]+r+1);o++)for(h=Math.max(0,this.taverns[i][1]-r);h<Math.min(this.width,this.taverns[i][1]+r+1);h++)Math.abs(o-this.taverns[i][0])+Math.abs(h-this.taverns[i][1])<=r&&void 0!==this.map[o][h].building&&"Town House"===this.map[o][h].building.name&&(p+=.02,t+=1);e+=p*n}for(i=1;i<this.warehouses.length;i++)for(p=.15*this.map[this.warehouses[i][0]][this.warehouses[i][1]].building.tier,o=Math.max(0,this.warehouses[i][0]-1);o<Math.min(this.height,this.warehouses[i][0]+2);o++)for(h=Math.max(0,this.warehouses[i][1]-1);h<Math.min(this.width,this.warehouses[i][1]+2);h++)this.map[o][h].roadBonus+=p;var m=[1,1.25,1.5,1.75,2];for(i=0;i<this.productionBuildings.length;i++){switch((b=this.map[this.productionBuildings[i][0]][this.productionBuildings[i][1]]).building.name){case"Docks":b.y>0&&(this.map[b.y-1][b.x].roadBuildable=!0,this.map[b.y-1][b.x].houseBuildable=!0,this.map[b.y-1][b.x].roadBonus=Math.max(this.map[b.y-1][b.x].roadBonus,m[b.building.tier-1])),b.y<this.height-1&&(this.map[b.y+1][b.x].roadBuildable=!0,this.map[b.y+1][b.x].houseBuildable=!0,this.map[b.y+1][b.x].roadBonus=Math.max(this.map[b.y+1][b.x].roadBonus,m[b.building.tier-1])),b.x>0&&(this.map[b.y][b.x-1].roadBuildable=!0,this.map[b.y][b.x-1].houseBuildable=!0,this.map[b.y][b.x-1].roadBonus=Math.max(this.map[b.y][b.x-1].roadBonus,m[b.building.tier-1])),b.x<this.width-1&&(this.map[b.y][b.x+1].roadBuildable=!0,this.map[b.y][b.x+1].houseBuildable=!0,this.map[b.y][b.x+1].roadBonus=Math.max(this.map[b.y][b.x+1].roadBonus,m[b.building.tier-1]))}}var y=[1,5,13,33,77],v=[.05,.3,.9,3,8];for(i=0;i<this.productionBuildings.length;i++){var b,f=1+(b=this.map[this.productionBuildings[i][0]][this.productionBuildings[i][1]]).defense*Je.getInstance().moonperks.moonlightworkers.level*.01;switch(f=f*(1+Je.getInstance().challenges.buildings.completions)*this._getBuildingEfficiency(b.x,b.y)*b.roadBonus,b.building.name){case"Lumberyard":this.resourcesPerDay[M]+=b.building.tier*b.yields[0]*f;break;case"Hunter's Lodge":this.resourcesPerDay[R]+=b.building.tier*b.yields[1]*f;break;case"Mine":this.resourcesPerDay[B]+=b.building.tier*b.yields[2]*f;break;case"Herbalist's Hut":this.resourcesPerDay[P]+=b.building.tier*b.yields[3]*f;break;case"Quarry":this.resourcesPerDay[I]+=b.building.tier*b.yields[4]*f;break;case"Crystal Loom":this.resourcesPerDay[L]+=b.building.tier*b.yields[5]*f;break;case"Docks":var x=this._getDockEfficiency(b.x,b.y);this.townData.buildingIncome+=Ce*b.building.tier*x;break;case"Alchemy Lab":this.alchemyDrain+=y[b.building.tier-1],this.alchemyGain+=v[b.building.tier-1]}}this.townData.setTavernPopulation(t),this.townData.calculateEconMulti(e)}_addBuilding(e){switch(e.defense+=Je.getInstance().moonperks.hardenedvillagers.level+this.townData.upgrades.reinforcedhouses.level,e.building.name){case"Lumberyard":case"Hunter's Lodge":case"Mine":case"Herbalist's Hut":case"Quarry":case"Crystal Loom":case"Docks":case"Alchemy Lab":this.productionBuildings.push([e.y,e.x]);break;case"Town House":this.townData.increaseMaxPop(5*e.building.tier);break;case"Watch Tower":for(var t=Math.max(0,e.y-2);t<Math.min(this.height,e.y+3);t++)for(var i=Math.max(0,e.x-2);i<Math.min(this.width,e.x+3);i++)Math.abs(i-e.x)+Math.abs(t-e.y)<=2&&(this.map[t][i].defense+=2*e.building.tier);break;case"Market":this.markets.push({x:e.x,y:e.y});break;case"Tavern":this.taverns.push([e.y,e.x]);break;case"Road":case"Town":this.roads.push([e.y,e.x]);break;case"Warehouse":this.warehouses.push([e.y,e.x])}}_removeBuilding(e){switch(e.defense-=Je.getInstance().moonperks.hardenedvillagers.level+this.townData.upgrades.reinforcedhouses.level,e.building.name){case"Lumberyard":case"Hunter's Lodge":case"Mine":case"Herbalist's Hut":case"Quarry":case"Crystal Loom":case"Docks":case"Alchemy Lab":this.productionBuildings=this.productionBuildings.filter(t=>t[1]!==e.x||t[0]!==e.y);break;case"Town House":this.townData.increaseMaxPop(-5*e.building.tier);break;case"Watch Tower":for(var t=Math.max(0,e.y-2);t<Math.min(this.height,e.y+3);t++)for(var i=Math.max(0,e.x-2);i<Math.min(this.width,e.x+3);i++)Math.abs(i-e.x)+Math.abs(t-e.y)<=2&&(this.map[t][i].defense-=2*e.building.tier);break;case"Market":this.markets=this.markets.filter(t=>t.x!==e.x||t.y!==e.y);break;case"Tavern":this.taverns=this.taverns.filter(t=>t[1]!==e.x||t[0]!==e.y);break;case"Road":this.roads=this.roads.filter(t=>t[1]!==e.x||t[0]!==e.y);break;case"Warehouse":this.warehouses=this.warehouses.filter(t=>t[1]!==e.x||t[0]!==e.y)}}nextWeakestTile(){for(var e=[-1,-1],t=this.regionLevel*ot.getInstance().regionDifficultyIncrease+9999,i=0;i<this.height;i++)for(var s=0;s<this.width;s++)!1===this.map[i][s].explored&&!0===this.map[i][s].revealed&&this.map[i][s].difficulty<t&&(e=[s,i],t=this.map[i][s].difficulty);return e}handleReinforcedHouses(){for(var e=0;e<this.height;e++)for(var t=0;t<this.width;t++)void 0!==this.map[e][t].building&&(this.map[e][t].defense+=1);this._calculateTileBonuses()}placeBuilding(e,t,i){this.map[t][e].building=i,this.map[t][e].building.increaseCosts(),this._addBuilding(this.map[t][e]),this._calculateTileBonuses(),this._onTileChanged(this.map[t][e])}upgradeBuilding(e,t){this._removeBuilding(this.map[t][e]),this.map[t][e].building.tier+=1,this.map[t][e].building.increaseCosts(),this._addBuilding(this.map[t][e]),this._calculateTileBonuses(),this._onTileChanged(this.map[t][e])}destroyBuilding(e,t){this._removeBuilding(this.map[t][e]),this.map[t][e].building=void 0,this._calculateTileBonuses(),this._onTileChanged(this.map[t][e])}update(e){}_getResourcesPerDay(){for(var e=[],t=this.townData.getProductionMulti()*(1+.04*ht.getInstance().getTalentLevel("governance")),i=0;i<this.resourcesPerDay.length;i++)e.push(Math.max(0,this.resourcesPerDay[i]*t));return e}updateDay(){this.townData.endOfDay();var e=new ht,t=Math.min(this.regionLevel,8),i=this._getResourcesPerDay();if(e.addResource(i,t),this.alchemyDrain>0){i=[];for(var s=1+.1*Je.getInstance().moonperks.mysticcauldron.level,a=0;a<e.resources[t].length;a++)i.push(Math.min(this.alchemyDrain,e.resources[t][a]));e.spendResource(i,t);for(a=0;a<e.resources[t].length;a++)i[a]=i[a]/this.alchemyDrain*this.alchemyGain*s;e.addResource(i,Math.min(t+1,8))}this.tilesExplored>=11&&(this.sightingsDelay-=qe,this.sightingsDelay<=0&&this._addSighting());for(a=0;a<this.sightings.length;a++){var r=this.sightings[a];this.map[r[0]][r[1]].incInvasionPower(this.regionLevel*ot.getInstance().regionDifficultyIncrease),this.invasionCounter+=this.map[r[0]][r[1]].getInvasionMulti()*(1/(1+.25*e.getTalentLevel("guardian")))}this.invasionCounter>Ee&&this._invade()}updateWeek(){this.townData.endOfWeek()}}class yt{constructor(e=0){this.time=e,this.offlineTime=0,this.frameDelta=0,this.delta=0,this.timescale=1,this.onDayEndHandlers=[],this.onWeekEndHandlers=[]}getYears(){return Math.floor(this.time/Ke)}getMonths(){return Math.floor(this.time%Ke/Xe)}getDays(){return Math.floor(this.time%Ke%Xe/qe)}getHours(){return Math.floor(this.time%Ke%Xe%qe/Ve)}getOfflineTimeString(){var e=Math.floor(this.offlineTime/36e5),t=Math.floor(this.offlineTime%36e5/6e4),i=Math.floor(this.offlineTime%6e4/1e3);return("0"+e).slice(-2)+":"+("0"+t).slice(-2)+":"+("0"+i).slice(-2)}_onDayEnd(){for(var e=0;e<this.onDayEndHandlers.length;e++)this.onDayEndHandlers[e]()}_onWeekEnd(){for(var e=0;e<this.onWeekEndHandlers.length;e++)this.onWeekEndHandlers[e]()}registerEvent(e,t){"onDayEnd"===e?this.onDayEndHandlers.push(t):"onWeekEnd"===e&&this.onWeekEndHandlers.push(t)}setTimeScale(e){this.offlineTime<=0||(this.timescale=e)}setFrameDelta(e){this.delta=e,this.frameDelta=e*this.timescale}addOfflineTime(e){this.offlineTime=Math.min(864e5,this.offlineTime+e)}update(e){var t=this.getDays();this.time+=this.frameDelta;var i=this.getDays();t!==i&&this._onDayEnd(),Math.floor(t/7)!==Math.floor(i/7)&&this._onWeekEnd(),this.timescale>1&&(this.offlineTime-=this.delta*(this.timescale-1),this.offlineTime<=0&&(this.timescale=1,this.offlineTime=0))}timeSince(e){return new yt(this.time-e)}getText(){return"Year "+(this.getYears()+1)+", "+Ne[this.getMonths()]+" "+(this.getDays()+1)+", "+this.getHours()+":00"}getTimespanText(){var e="",t=this.getYears();t>0&&(e+=t+" Years");var i=this.getMonths();i>0&&(e+=(e.length>0?", ":"")+i+" Months");var s=this.getDays();s>0&&(e+=(e.length>0?", ":"")+s+" Days");var a=this.getHours();return a>0&&(e+=(e.length>0?", ":"")+a+" Hours"),e}save(){return{time:this.time,otime:this.offlineTime}}load(e,t){t<=4&&(e.otime=0),this.time=e.time,this.offlineTime=e.otime}}class vt{constructor(){if(!vt.instance){var e=ot.getInstance().regionSize;this.regionList=[],this.regionList.push(new mt(e[0],e[1],0,"temperate",this._randomizeTraits(0))),this.currentRegion=0,this.nextRegions=[],this.timeAtRunStart=0,this.time=new yt,this.time.registerEvent("onDayEnd",()=>{this.updateDay()}),this.time.registerEvent("onWeekEnd",()=>{this.updateWeek()}),this.onRegionChangedHandlers=[],vt.instance=this}return vt.instance}static getInstance(){return vt.instance?vt.instance:new vt}rebirth(){var e=ot.getInstance().regionSize;this.regionList=[],this.regionList.push(new mt(e[0],e[1],0,"temperate",this._randomizeTraits(0))),this.currentRegion=0,this.nextRegions=[],this.timeAtRunStart=this.time.time,this._onRegionChangedHandler()}onRegionChanged(e){this.onRegionChangedHandlers.push(e)}_onRegionChangedHandler(){for(var e=0;e<this.onRegionChangedHandlers.length;e++)this.onRegionChangedHandlers[e]()}getRegion(e){return this.regionList[e]}setRegion(e){this.currentRegion=e}getCurrentRegion(){return this.getRegion(this.currentRegion)}setCurrentRegion(e){this.currentRegion=e,this._onRegionChangedHandler()}getGoldCap(){for(var e=0,t=0;t<this.regionList.length;t++)e+=this.regionList[t].townData.getGoldCap();return e}_randomizeTraits(e){for(var t=ot.getInstance(),i=[],s=0;s<t.fixedTraits.length;s++)i.push({type:t.fixedTraits[s].type,level:t.fixedTraits[s].level});for(s=0;s<e+t.startingTraits;s++){var a=Qe.randint(1,7),r=i.find(e=>e.type===a);void 0!==r?r.level+=1:i.push({type:a,level:1})}return i=i.sort((e,t)=>t.level-e.level)}generateRegionChoices(){var e=Qe.randint(2,5),t=["temperate","mountains","desert","forest","hills"];this.nextRegions=[];for(var i=0;i<e;i++){var s=Qe.randint(0,t.length),a=Math.floor(this.regionList.length/2);this.nextRegions.push({type:t[s],traits:this._randomizeTraits(a)}),t.splice(s,1)}}addRegion(e){var t=ot.getInstance().regionSize;this.regionList.push(new mt(t[0],t[1],this.regionList.length,this.nextRegions[e].type,this.nextRegions[e].traits)),this.regionList[this.regionList.length-1].worldHeight=Math.floor((e+1)*(700/(this.nextRegions.length+1))),this.nextRegions=[],this._onRegionChangedHandler()}handleRunCompletion(){var e=ht.getInstance().earnableMoonlight(this.getCurrentRegion().regionLevel+1)*(1+.15*Je.getInstance().challenges.time.completions);if(Je.getInstance().moonlight+=e,this.getCurrentRegion().regionLevel>=1&&(Ze.getInstance().persistentUnlocks.challenges=!0),this.getCurrentRegion().regionLevel>=3&&(Je.getInstance().challenges.buildings.unlocked=!0,Je.getInstance().challenges.talent.unlocked=!0),this.getCurrentRegion().regionLevel>=4&&(Je.getInstance().challenges.megamonsters.unlocked=!0),this.getCurrentRegion().regionLevel>=6&&(Je.getInstance().challenges.outcast.unlocked=!0),-1===ot.getInstance().maxRunTime||this.time.time-this.timeAtRunStart<ot.getInstance().maxRunTime){var t=Je.getInstance().getChallengeFromName(ot.getInstance().challengeName);if(void 0!==t){if(t.completions<t.maxCompletions){switch(t.name){case"A Matter of Years":Je.getInstance().challenges.forge.unlocked=!0,Je.getInstance().challenges.explore.unlocked=!0,Je.getInstance().challengePoints+=2;break;case"Forged Ahead":Je.getInstance().challengePoints+=2;break;case"Giant Lands":case"Lazy Townsfolk":Je.getInstance().challengePoints+=3;break;case"Talentless":Je.getInstance().challengePoints+=4;break;case"Mega Monsters":Je.getInstance().challengePoints+=5}t.completions+=1}0===t.fastestTime?t.fastestTime=this.time.time-this.timeAtRunStart:t.fastestTime=Math.min(this.time.time-this.timeAtRunStart,t.fastestTime)}}ot.getInstance().reset()}update(e){this.time.update(e);for(var t=0;t<this.regionList.length;t++)this.regionList[t].update(e)}updateDay(){for(var e=0;e<this.regionList.length;e++)this.regionList[e].updateDay()}updateWeek(){for(var e=0;e<this.regionList.length;e++)this.regionList[e].updateWeek()}save(){for(var e=[],t=0;t<this.regionList.length;t++)e.push(this.regionList[t].save());return{rl:e,cr:this.currentRegion,nr:this.nextRegions,st:this.timeAtRunStart,time:this.time.save()}}load(e,t){t<=4&&(e.st=0),this.regionList=[];for(var i=0;i<e.rl.length;i++)this.regionList.push(mt.loadFromSave(e.rl[i],t));this.currentRegion=e.cr,this.nextRegions=e.nr,this.timeAtRunStart=e.st,this.time.load(e.time,t)}}class bt{constructor(e,t,i,s,a,r){this.backgroundRect=e.add.rectangle(t,i,s,a,0).setOrigin(0,0),this.backgroundRect.isStroked=!0,this.backgroundRect.strokeColor=Phaser.Display.Color.GetColor(255,255,255),this.backgroundRect.lineWidth=1,this.rawText=r,this.text=e.add.bitmapText(t+s/2,i+a/2-1,"courier20",r).setOrigin(.5),this.enabled=!0,this.width=s,this.height=a,this.isNotifying=!1,this.textClr=16777215}setNotification(){return this.isNotifying=!0,this.text.setText("!"+this.rawText+"!"),this.text.setTint(Phaser.Display.Color.GetColor(255,255,0)),this}setPosition(e,t){return this.backgroundRect.setPosition(e,t),this.text.setPosition(e+this.width/2,t+this.height/2),this}setVisible(e){return this.backgroundRect.setVisible(e),this.text.setVisible(e),this.text.setTint(!0===e?this.textClr:10066329),this}setEnable(e){return this.enabled=e,this.text.setTint(!0===e?this.textClr:10066329),this}setText(e){return this.text.setText(e),this}setTextColor(e){return this.text.setTint(e),this.textClr=e,this}_onClick(e){!0===this.isNotifying&&(this.isNotifying=!1,this.text.setText(this.rawText),this.text.setTint(this.textClr)),!0===this.enabled&&e()}_onPointerUp(e){!0===this.enabled&&e()}_onPointerOut(e){!0===this.enabled&&e()}_onPointerOver(e){!0===this.enabled&&e()}onClickHandler(e){return this.backgroundRect.setInteractive({useHandCursor:!0}).on("pointerdown",()=>{this._onClick(e)}),this}onPointerOutHandler(e){return this.backgroundRect.setInteractive({useHandCursor:!0}).on("pointerout",()=>{this._onPointerOut(e)}),this}onPointerUpHandler(e){return this.backgroundRect.setInteractive({useHandCursor:!0}).on("pointerup",()=>{this._onPointerUp(e)}),this}onPointerOverHandler(e){return this.backgroundRect.setInteractive({useHandCursor:!0}).on("pointerover",()=>{this._onPointerOver(e)}),this}destroy(){this.backgroundRect.destroy(),this.text.destroy()}}class ft{constructor(e,t,i,s,a,r){this.backgroundRect=e.add.rectangle(t,i,s,a,0).setOrigin(0,0),this.backgroundRect.isStroked=!0,this.backgroundRect.strokeColor=Phaser.Display.Color.GetColor(255,255,255),this.backgroundRect.lineWidth=1,this.img=e.add.image(t+s/2,i+a/2,r.sprite,r.tile).setOrigin(.5),this.img.displayWidth=s,this.img.displayHeight=a,this.enabled=!0,this.width=s,this.height=a}setPosition(e,t){this.backgroundRect.setPosition(e,t),this.img.setPosition(e+this.width/2,t+this.height/2)}setVisible(e){this.backgroundRect.setVisible(e),this.img.setVisible(e)}setEnable(e){this.enabled=e}setTint(e){this.img.setTint(e)}clearTint(){this.img.clearTint()}setBorderTint(e){this.backgroundRect.strokeColor=e}removeBackground(){this.backgroundRect.alpha=.01}_onClick(e){!0===this.enabled&&e()}_onPointerUp(e){!0===this.enabled&&e()}_onPointerOut(e){!0===this.enabled&&e()}_onPointerOver(e){!0===this.enabled&&e()}onClickHandler(e){return this.backgroundRect.setInteractive({useHandCursor:!0}).on("pointerdown",()=>{this._onClick(e)}),this}onPointerOutHandler(e){return this.backgroundRect.setInteractive({useHandCursor:!0}).on("pointerout",()=>{this._onPointerOut(e)}),this}onPointerUpHandler(e){return this.backgroundRect.setInteractive({useHandCursor:!0}).on("pointerup",()=>{this._onPointerUp(e)}),this}onPointerOverHandler(e){return this.backgroundRect.setInteractive({useHandCursor:!0}).on("pointerover",()=>{this._onPointerOver(e)}),this}destroy(){this.backgroundRect.destroy(),this.img.destroy()}}class xt{constructor(e,t,i,s,a){this.boundingBox=e.add.rectangle(t,i,s,a,2236962).setOrigin(0),this.boundingBox.strokeColor=12303291,this.boundingBox.isStroked=!0,this.boundingBox.lineWidth=2,this.x=t,this.y=i,this.context=e,this.textList=[]}addText(e,t,i,s,a){var r=this.context.add.bitmapText(this.x+e,this.y+t,i,s);return void 0!==a&&r.setTint(a),this.textList.push(r),this}setVisible(e){this.boundingBox.setVisible(e);for(var t=0;t<this.textList.length;t++)this.textList[t].setVisible(e)}destroy(){this.boundingBox.destroy();for(var e=0;e<this.textList.length;e++)this.textList[e].destroy()}}class wt{constructor(e,t,i,s){var r=new Ze,n=(new vt).getCurrentRegion(),o=Math.min(n.regionLevel,8);this.backRect=e.add.rectangle(t,i,500,220,Phaser.Display.Color.GetColor(0,0,0)).setInteractive().setOrigin(0,0),this.backRect.isStroked=!0,this.backRect.strokeColor=Phaser.Display.Color.GetColor(128,128,128),this.backRect.lineWidth=2,this.titleLabel=e.add.bitmapText(t+5,i+5,"courier20",s.name);var h="";s.difficulty<1?h+="Difficulty: Weak\n":h+="Difficulty: "+s.difficulty+"\n",!1===s.explored?h+="Explored: "+Math.floor(s.amountExplored/s.explorationNeeded*100)+"%\n":h+="Explored\nDefense: "+Math.floor(s.defense)+"\n";var l=s.yields.reduce((e,t)=>e+t);if(!0===s.explored&&l>0){h+="Yields:\n";for(var c=0;c<s.yields.length;c++)s.yields[c]>0&&(h+=" "+D[c]+": "+Math.floor(100*s.yields[c])/100+"\n")}if(this.infoLabel=e.add.bitmapText(t+10,i+25,"courier16",h),this.buildingLabel=void 0,this.floatingText=void 0,this.buildingDesc=void 0,this.buildingCostLabels=[],this.upgradeButton=void 0,this.destroyButton=void 0,this.buildingButtons=[],!0===r.unlocks.buildings&&!0===s.explored)if(void 0===s.building){this.buildingLabel=e.add.bitmapText(t+180,i+5,"courier20","Buildings:");var d=[];0!==l&&!0===s.roadBuildable&&d.push("road"),!0===ot.getInstance().buildingsAllowed&&(s.yields[0]>0&&d.push("wood"),s.yields[1]>0&&d.push("leather"),s.yields[2]>0&&d.push("metal"),s.yields[3]>0&&d.push("fiber"),s.yields[4]>0&&d.push("stone"),s.yields[5]>0&&d.push("crystal")),!0===s.dockBuildable&&d.push("docks"),l>0&&(s.houseBuildable&&(d.push("house"),n.townData.getMarketLevel()>0&&d.push("market"),!0===n.townData.alchemyEnabled&&d.push("alchemy"),Je.getInstance().challenges.buildings.completions>0&&d.push("warehouse")),n.townData.getTavernLevel()>0&&d.push("tavern"),d.push("watchtower"));for(c=0;c<d.length;c++){var u=t+180+c%9*34,g=i+30+34*Math.floor(c/9),p=dt.getBuildingByName(d[c]);this.buildingButtons.push(this._makeBuildingBtn(e,u,g,s,p))}}else{this.buildingLabel=e.add.bitmapText(t+150,i+5,"courier20",s.building.name);var m=Qe.processText(gt.getTooltip(s,s.building.name,s.building.tier),27);if(this.buildingDesc=e.add.bitmapText(t+150,i+25,"courier16",m),this._canUpgrade(s.building)){this.buildingCostLabels.push(e.add.bitmapText(t+395,i+25,"courier16","Upgrade:"));var y=i+42;for(c=0;c<s.building.resourceCosts.length;c++)if(s.building.resourceCosts[c]>0){var v=ht.getInstance().resources[o][c]>=s.building.resourceCosts[c]?Phaser.Display.Color.GetColor(255,255,255):Phaser.Display.Color.GetColor(255,80,80);(b=e.add.bitmapText(t+395,y,"courier16",D[c]+": "+Qe.numberString(s.building.resourceCosts[c]))).setTint(v),this.buildingCostLabels.push(b),y+=17}var b=e.add.bitmapText(t+395,y,"courier16","Gold: "+s.building.goldCost);v=ht.getInstance().gold>=s.building.goldCost?Phaser.Display.Color.GetColor(255,255,255):Phaser.Display.Color.GetColor(255,80,80);b.setTint(v),this.buildingCostLabels.push(b),this.upgradeButton=new bt(e,t+175,i+195,140,20,"Upgrade").onClickHandler(()=>{this._onAction("upgrade",{tile:s})})}this.destroyButton=new ft(e,t+130,i+5,16,16,{sprite:"icons",tile:23}).onClickHandler(()=>{this._onAction("destroy",{tile:s})}).onPointerOverHandler(()=>{var r="Remove the building from this tile. Costs "+s.building.tier*fe+"g.",n=t+130,o=i+5;this.floatingText=new a(e,Qe.processText(r,25),n+16,o-60,220,60,"courier16",16)}).onPointerOutHandler(()=>{this._clearTooltip()})}this.exploreButton=new bt(e,t+30,i+195,140,20,"Explore").onClickHandler(()=>{this._onAction("explore",{tile:s})}),this.cancelButton=new bt(e,t+320,i+195,140,20,"Cancel").onClickHandler(()=>{this._onAction("cancel")}),this.onActionHandlers=[]}_canUpgrade(e){return"Market"===e.name?e.tier<vt.instance.getCurrentRegion().townData.getMarketLevel():"Tavern"===e.name?e.tier<vt.instance.getCurrentRegion().townData.getTavernLevel():e.tier<3}_makeBuildingBtn(e,t,i,s,a){return new ft(e,t,i,32,32,a.texture).onClickHandler(()=>{this._onAction("build",{tile:s,building:a})}).onPointerOverHandler(()=>{void 0!==this.floatingText&&this.floatingText.destroy();var r=Math.min(vt.getInstance().getCurrentRegion().regionLevel,8),n=Qe.processText(gt.getTooltip(s,a.name,a.tier,!0),24);this.floatingText=new xt(e,t+(t+350>1100?-350:0),i-150,350,150).addText(5,5,"courier20",a.name).addText(230,5,"courier20","Costs:").addText(10,25,"courier16",n);for(var o=25,h=0;h<a.resourceCosts.length;h++)if(a.resourceCosts[h]>0){var l=ht.getInstance().resources[r][h]>=a.resourceCosts[h]?Phaser.Display.Color.GetColor(255,255,255):Phaser.Display.Color.GetColor(255,80,80);this.floatingText.addText(235,o,"courier16",D[h]+": "+Qe.numberString(a.resourceCosts[h]),l),o+=17}l=ht.getInstance().gold>=a.goldCost?Phaser.Display.Color.GetColor(255,255,255):Phaser.Display.Color.GetColor(255,80,80);this.floatingText.addText(235,o,"courier16","Gold: "+a.goldCost,l)}).onPointerOutHandler(()=>{this._clearTooltip()})}_clearTooltip(){this.floatingText.destroy(),this.floatingText=void 0}addOnActionHandler(e){this.onActionHandlers.push(e)}_onAction(e,t={}){for(var i=0;i<this.onActionHandlers.length;i++)this.onActionHandlers[i](e,t)}destroy(){this.backRect.destroy(),this.titleLabel.destroy(),this.infoLabel.destroy(),this.exploreButton.destroy(),this.cancelButton.destroy(),void 0!==this.floatingText&&this.floatingText.destroy(),void 0!==this.buildingLabel&&this.buildingLabel.destroy();for(var e=0;e<this.buildingButtons.length;e++)this.buildingButtons[e].destroy();void 0!==this.buildingDesc&&this.buildingDesc.destroy();for(e=0;e<this.buildingCostLabels.length;e++)this.buildingCostLabels[e].destroy();void 0!==this.upgradeButton&&this.upgradeButton.destroy(),void 0!==this.destroyButton&&this.destroyButton.destroy()}}class kt{constructor(e,t,i,s){this.backingRect=e.add.rectangle(t,i,400,270,Phaser.Display.Color.GetColor(0,0,0)).setOrigin(0,0).setInteractive(),this.backingRect.isStroked=!0,this.backingRect.strokeColor=Phaser.Display.Color.GetColor(200,0,200),this.backingRect.lineWidth=2,this.titleLabel=e.add.bitmapText(t+200,i+10,"courier20","Mystic Gate").setOrigin(.5,0),this.titleLabel.setTint(Phaser.Display.Color.GetColor(200,0,200));var a="You approach the mysterious, ancient gate. The air buzzes with energy as you peer into the pale blue portal. All those shadow beasts, guarding this place.. what's so important about this?";a=Qe.processText(a,48),this.descLabel=e.add.bitmapText(t+200,i+30,"courier16",a,16,1).setOrigin(.5,0);var r=Phaser.Display.Color.GetColor(96,172,177);switch(s){case 0:a='"THE MOON CALLS TO ALL IN THESE LANDS THAT WOULD HEAR IT. BE REBORN IN MOONLIGHT."';break;case 1:a='"THE CHILD RETURNS, TRAVELLING THE HORIZON. MY BOUNTY FLURISHES WITH EACH STEP."';break;case 2:a='"I SPEAK, YET DO NOT HEAR. MYRAH KEEPS ALL IN SHADOW. THE STARLESS NIGHT RETURNS."';break;case 3:a='"MOONLIGHT STRENGTHENS YOU, BUT I OFFER MORE. FACE MY CHALLENGES, FOR THERE ARE GREATER DANGERS."';break;case 4:a='"DO YOU WAVER, CHILD OF MOONLIGHT? YOUR STRENGTH GROWS, BUT FAR HAS MYRAH HID... TURNING ALL AGAINST US."';break;case 5:a='"..."';break;case 6:a='"YOU TRAVEL FAR. MYRAH TRIES TO HIDE MY VOICE. COME, MY CHALLENGES WILL PREPARE YOU FOR THE COMING NIGHT."';break;case 7:a='"WE WILL NOT RETURN, SLAVE OF MOONLIGHT. THE STARS WILL NOT COME TO YOU. LEAVE NOW."',r=Phaser.Display.Color.GetColor(177,100,169);break;case 8:a='"DO NOT LISTEN. THEIR LIES ARE AS NUMEROUS AS THE STARS IN THE SKY. WE SHALL PURGE THEM BOTH."';break;default:a='"..."'}a=Qe.processText(a,48),this.desc2Label=e.add.bitmapText(t+200,i+107,"courier16",a,16,1).setOrigin(.5,0),this.desc2Label.setTint(r),a="You hear a voice calling to you. Do you enter into the unknown, or continue your journey?",a=Qe.processText(a,48),this.desc3Label=e.add.bitmapText(t+200,i+150,"courier16",a,16,1).setOrigin(.5,0);var n=new ht,o="MOONLIGHT\n"+Math.round(n.earnableMoonlight(s+1)*(1+.15*Je.instance.challenges.time.completions));this.moonlightLabel=e.add.bitmapText(t+200,i+190,"courier20",o,20,1).setOrigin(.5,0),this.moonlightLabel.setTint(Phaser.Display.Color.GetColor(206,238,240)),this.rebirthButton=new bt(e,t+30,i+240,155,20,"Enter"),this.leaveButton=new bt(e,t+215,i+240,155,20,"Leave")}onRebirthHandler(e){return this.rebirthButton.onClickHandler(e),this}onLeaveHandler(e){return this.leaveButton.onClickHandler(e),this}destroy(){this.backingRect.destroy(),this.titleLabel.destroy(),this.descLabel.destroy(),this.desc2Label.destroy(),this.desc3Label.destroy(),this.moonlightLabel.destroy(),this.rebirthButton.destroy(),this.leaveButton.destroy()}}class Tt{constructor(e,t,i,s,a,r,n,o){this.backgroundRect=e.add.rectangle(t,i,s,a,n).setOrigin(0,0),this.fillRect=e.add.rectangle(t+1,i+1,s-2,a-2,r).setOrigin(0,0),this.fillRect2=e.add.rectangle(t+1,i+1,s-2,a-2,Phaser.Display.Color.GetColor(255,255,255)).setOrigin(0,0),this.fillRect2.displayWidth=0,this.width=s,this.height=a,this.progressText=e.add.bitmapText(t+s/2,i+a/2,"courier16",o).setOrigin(.5,.5)}setPosition(e,t){this.backgroundRect.setPosition(e,t),this.fillRect.setPosition(e+1,t+1),this.fillRect2.setPosition(e+1,t+1),this.progressText.setPosition(e+this.width/2,t+this.height/2)}setVisible(e){this.backgroundRect.setVisible(e),this.fillRect.setVisible(e),this.fillRect2.setVisible(e),this.progressText.setVisible(e)}setFillPercent(e,t=""){e=Math.max(0,Math.min(1,e)),this.fillRect.displayWidth=Math.floor(e*(this.width-2)),this.progressText.setText(t)}setSecondaryFillPercent(e){e=Math.max(0,Math.min(1,e)),this.fillRect2.displayWidth=Math.floor(e*(this.width-2))}}var Ct=e=>Phaser.Display.Color.GetColor(e[0],e[1],e[2]);class Mt extends s{constructor(e,t){super(e,t),this.WIDTH=50,this.HEIGHT=50,this.tileClickHandlers=[];var i=new vt;this.region=i.getCurrentRegion(),this.offsetX=360-this.region.width*this.WIDTH/2,this.offsetY=370-this.region.height*this.HEIGHT/2,this.progression=new Ze,this.letters=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q"],this.sightingVal=0,this.tileSelectWindow=void 0,this.rebirthDialog=void 0,this.autoExploreActive=!1,this.updateBuildings=!1,this.upgradeKey=void 0,this.hoveredTile=[-1,-1],this.regionTiles=[],this.regionStats=void 0,this.activeTile=void 0,vt.getInstance().onRegionChanged(()=>{this._onRegionChanged()})}preload(){}registerEvent(e,t){"onTileClick"===e&&this.tileClickHandlers.push(t)}_handleProgressionEvent(e,t,i){e===g&&this.invasionLabel.setVisible(!0)}_setupRegionButton(e,t,i){return new bt(this,t,i,20,20,e+1+"").onClickHandler(()=>{vt.getInstance().setCurrentRegion(e),this.scene.get("DarkWorld").changeRegion(),this.scene.get("RegionScene").changeRegion(),this.scene.get("TownScene").changeRegion()})}_onRegionChanged(){for(var e=0;e<this.regionTiles.length;e++)this.regionTiles[e].destroy();if(this.regionTiles=[],vt.getInstance().regionList.length>1){this.regionTiles.push(this.add.bitmapText(this.relativeX(660),this.relativeY(10),"courier20","Regions:"));for(e=0;e<vt.getInstance().regionList.length;e++){var t=this.relativeX(660+20*e),i=this.relativeY(35);this.regionTiles.push(this._setupRegionButton(e,t,i))}}}_updateRegionStats(){if(void 0!==this.regionStats&&this.regionStats.destroy(),!0===this.region.townData.townExplored){for(var e="Daily Production:\n",t=this.region._getResourcesPerDay(),i=0;i<t.length;i++)e+=" "+D[i]+": "+Math.floor(100*t[i])/100+"\n";this.regionStats=this.add.bitmapText(this.relativeX(660),this.relativeY(250),"courier20",e)}}_nextToConnector(e,t){return"Town"===this.region.map[t][e].name||void 0!==this.region.map[t][e].building&&"Docks"===this.region.map[t][e].building.name}_getRoadTexture(e,t){var i=e>0&&(0===this.region.map[t][e-1].roadDist||this._nextToConnector(e-1,t))?"1":"0",s=e<this.region.width-1&&(0===this.region.map[t][e+1].roadDist||this._nextToConnector(e+1,t))?"1":"0",a=t>0&&(0===this.region.map[t-1][e].roadDist||this._nextToConnector(e,t-1))?"1":"0",r=t<this.region.height-1&&(0===this.region.map[t+1][e].roadDist||this._nextToConnector(e,t+1))?"1":"0";return{sprite:"roadicons",tile:ze[i+s+a+r]+20*(this.region.map[t][e].building.tier-1),w:50,h:50}}_getBuildingImage(e,t){return"Road"===this.region.map[t][e].building.name?this._getRoadTexture(e,t):{sprite:this.region.map[t][e].building.texture.sprite,tile:this.region.map[t][e].building.texture.tile+8*(this.region.map[t][e].building.tier-1),w:this.region.map[t][e].building.texture.w,h:this.region.map[t][e].building.texture.h}}_setupTile(e,t){var i=Ct(this.region.map[t][e].color),s=Ct(this.region.map[t][e].borderColor);!1===this.region.map[t][e].revealed?(i=Phaser.Display.Color.GetColor(0,0,0),s=Phaser.Display.Color.GetColor(40,80,40)):!1===this.region.map[t][e].explored&&!0===this.region.map[t][e].revealed&&(i=Qe.colorLerp(i,Phaser.Display.Color.GetColor(0,0,0),.65));var a=this.add.rectangle(this.relativeX((e+.5)*this.WIDTH+this.offsetX),this.relativeY((t+.5)*this.HEIGHT+this.offsetY),this.WIDTH-1,this.HEIGHT-1,i);a.strokeColor=s,a.isStroked=!0,a.lineWidth=1.5,a.setInteractive({useHandCursor:!0}).on("pointerdown",()=>{this._handleTileClick(e,t)}).on("pointerover",()=>{this.hoveredTile=[e,t],this._setTooltip(e,t)}).on("pointerout",()=>{this.hoveredTile=[-1,-1],this._disableTooltip()});var r=void 0;if(void 0!==this.region.map[t][e].building&&!0===this.region.map[t][e].revealed){var n=this._getBuildingImage(e,t);(r=this.add.image(this.relativeX((e+.5)*this.WIDTH+this.offsetX),this.relativeY((t+.5)*this.HEIGHT+this.offsetY),n.sprite,n.tile)).displayWidth=n.w,r.displayHeight=n.h}return{rect:a,building:r}}_setTooltip(e,t){void 0!==this.floatingText&&this._disableTooltip();var i="Tile "+this.letters[t]+(e+1)+"\n";!0===this.region.map[t][e].revealed?(i+=this.region.map[t][e].name+"\n",this.region.map[t][e].difficulty<1?i+="Difficulty: Weak\n":i+="Difficulty: "+this.region.map[t][e].difficulty+"\n",!1===this.region.map[t][e].explored?i+="Explored: "+Math.floor(this.region.map[t][e].amountExplored/this.region.map[t][e].explorationNeeded*100)+"%\n":i+="Explored\n"):i+="Unknown";var s=this.relativeX(e*this.WIDTH+this.offsetX);s+=s+190>1100?-150:0;var r=this.relativeY(t*this.HEIGHT+this.offsetY-82);r+=r<100?115:0,this.floatingText=new a(this,i,s,r,190,82)}_disableTooltip(){void 0!==this.floatingText&&(this.floatingText.destroy(),this.floatingText=void 0)}_exploreTown(e,t){!1===this.progression.unlocks.townTab&&this.progression.registerFeatureUnlocked(l,"You've finally made it to the town you saw in the distance, the only square not covered in this horrible fog. As you approach the gate a voice calls to you from the wall.\n\n\"Oh hey, you must be the new hero we've heard about, give me a minute to open the gate.\"\n\nHero? You woke up naked and alone in the wilderness. Come to think of it, it's amazing you're even still alive. You're still contemplating your existence when the door opens.\n\n\"So hero, you don't mind if I call you hero do you? Just makes things easier. Anyway we have a house laid out for you, don't expect much. The Forge has seen better days and the guilds have all been abandoned but I'm sure you'll see to that, Mr. Hero.\"\n\nYou begin to ask what all this hero nonsense is about when they speak up again.\n\n \"Oh that reminds me, we don't have much, but we can pay you for every one of those monsters you kill. Don't try to lie about how many you've beat, we can tell. Oh, and we'll pay you more when you're clearing new land for us. What were you trying to ask?\"\n\nYou say it was nothing and ask them to lead the way. You don't know about this hero stuff, but money is money. Besides you were already fighting this monsters anyway, might as well make money while you do it."),this.region.map[t][e].amountExplored=this.region.map[t][e].explorationNeeded,this.region.exploreTile(e,t),this.scene.get("DarkWorld").townButton.setVisible(!0)}_handleTileClick(e,t){!1===this.region.map[t][e].explored&&!1===this.region.map[t][e].revealed||("Town"!==this.region.map[t][e].name?"Mystic Gate"!==this.region.map[t][e].name||!0!==this.region.map[t][e].explored?(void 0!==this.tileSelectWindow&&(this.tileSelectWindow.destroy(),this.tileSelectWindow=void 0),this.tileSelectWindow=new wt(this,this.relativeX(200),this.relativeY(200),this.region.map[t][e]),this.tileSelectWindow.addOnActionHandler((e,t)=>{this._tileActionHandler(e,t)})):this.rebirthDialog=new kt(this,this.relativeX(250),this.relativeY(215),this.region.regionLevel).onRebirthHandler(()=>{this._rebirthClickedHandler()}).onLeaveHandler(()=>{this._leaveClickedHandler()}):this._exploreTown(e,t))}_canUpgrade(e){return"Market"===e.building.name?e.building.tier<this.region.townData.getMarketLevel():"Tavern"===e.building.name?e.building.tier<this.region.townData.getTavernLevel():e.building.tier<3}_tileActionHandler(e,t){switch(e){case"explore":this._exploreTile(t.tile.x,t.tile.y,!1);break;case"build":var i=new ht,s=Math.floor(this.region.regionLevel);!0===Qe.canCraft(t.building.resourceCosts,i.resources[s])&&t.building.goldCost<=i.gold&&(i.spendResource(t.building.resourceCosts,s),i.addGold(-t.building.goldCost),this.region.placeBuilding(t.tile.x,t.tile.y,t.building),t.tile.building=t.building,this.scene.get("TownScene")._updateStatus()),this._updateRegionStats();break;case"upgrade":i=new ht,s=Math.floor(this.region.regionLevel);!0===Qe.canCraft(t.tile.building.resourceCosts,i.resources[s])&&t.tile.building.goldCost<=i.gold&&this._canUpgrade(t.tile)&&(i.spendResource(t.tile.building.resourceCosts,s),i.addGold(-t.tile.building.goldCost),this.region.upgradeBuilding(t.tile.x,t.tile.y),this.tileElements[t.tile.y][t.tile.x].building.setTexture(t.tile.building.texture.sprite,t.tile.building.texture.tile+8*(t.tile.building.tier-1)),this.scene.get("TownScene")._updateStatus()),this._updateRegionStats();break;case"destroy":ht.instance.gold>=t.tile.building.tier*fe&&(ht.instance.addGold(-t.tile.building.tier*fe),this.region.destroyBuilding(t.tile.x,t.tile.y)),this._updateRegionStats()}void 0!==this.tileSelectWindow&&(this.tileSelectWindow.destroy(),this.tileSelectWindow=void 0)}_rebirthClickedHandler(){this.rebirthDialog.destroy(),this.rebirthDialog=void 0,vt.getInstance().handleRunCompletion();var e=this.scene.get("MoonlightScene");e.enableLeveling(),e._onMoonlightChanged(),this.scene.bringToTop("MoonlightScene")}_leaveClickedHandler(){this.rebirthDialog.destroy(),this.rebirthDialog=void 0}_exploreTile(e,t,i){this.activeTile=this.region.map[t][e],!1===this.progression.unlocks.combatTab&&this.progression.registerFeatureUnlocked(h,"Well this isn't so bad, walking aimlessly through this fog covered wilderness.\nI wonder if I'll meet a new friend.\n");for(var s=0;s<this.tileClickHandlers.length;s++)this.tileClickHandlers[s](e,t,i)}_onExploredCallback(e,t){if((0===e.y&&(!1===this.progression.unlocks.worldTab&&this.progression.registerFeatureUnlocked(m,"You did it, you've reached the edge of the world. This is all there is...\n\nOh wait, it looks like there's a trail over there leading to a new region! there's a whole world out there. I was wondering what that last tab was going to be."),vt.instance.regionList.length-1===t&&0===vt.instance.nextRegions.length&&(vt.instance.generateRegionChoices(),this.scene.get("WorldScene")._refreshRegions())),!1===e.explored)&&(!0===e.hasRune&&(this.scene.get("DarkWorld").notifyGear(),!1===this.progression.unlocks.runes&&this.progression.registerFeatureUnlocked(b,"You found an interesting rock in that last tile and shoved it into your pack, probably due to your crippling need to hoard things like some RPG character. The rock was glowing so it would probably make a neat good luck charm if you shoved it into the holes on your gear.")),this.region.exploreTile(e.x,e.y),this.progression.registerTileExplored(),!0===this.autoExploreActive&&-1!==(i=this.region.nextWeakestTile())[0])){var i;if("Town"===this.region.map[i[1]][i[0]].name)if(this._exploreTown(e.x,e.y),-1===(i=this.region.nextWeakestTile())[0])return;this._exploreTile(i[0],i[1],!0)}}_updateTile(e){this.scene.get("TownScene").updateResearchButton();var t=Ct(e.color),i=Ct(e.borderColor);if(!1===e.revealed?(t=Phaser.Display.Color.GetColor(0,0,0),i=Phaser.Display.Color.GetColor(40,80,40)):!1===e.explored&&!0===e.revealed&&(t=Qe.colorLerp(t,Phaser.Display.Color.GetColor(0,0,0),.65)),this.tileElements[e.y][e.x].rect.fillColor=t,this.tileElements[e.y][e.x].rect.strokeColor=i,void 0!==e.building&&!0===e.revealed){this.updateBuildings=!0;var s=this._getBuildingImage(e.x,e.y);if(void 0!==this.tileElements[e.y][e.x].building?this.tileElements[e.y][e.x].building.setTexture(s.sprite,s.tile):(this.tileElements[e.y][e.x].building=this.add.image(this.relativeX((e.x+.5)*this.WIDTH+this.offsetX),this.relativeY((e.y+.5)*this.HEIGHT+this.offsetY),s.sprite,s.tile),this.tileElements[e.y][e.x].building.displayWidth=s.w,this.tileElements[e.y][e.x].building.displayHeight=s.h),"Road"===e.building.name){if(e.x>0&&void 0!==this.region.map[e.y][e.x-1].building&&"Road"===this.region.map[e.y][e.x-1].building.name){var a=this._getBuildingImage(e.x-1,e.y);this.tileElements[e.y][e.x-1].building.setTexture(a.sprite,a.tile)}if(e.x<this.region.width-1&&void 0!==this.region.map[e.y][e.x+1].building&&"Road"===this.region.map[e.y][e.x+1].building.name){a=this._getBuildingImage(e.x+1,e.y);this.tileElements[e.y][e.x+1].building.setTexture(a.sprite,a.tile)}if(e.y>0&&void 0!==this.region.map[e.y-1][e.x].building&&"Road"===this.region.map[e.y-1][e.x].building.name){a=this._getBuildingImage(e.x,e.y-1);this.tileElements[e.y-1][e.x].building.setTexture(a.sprite,a.tile)}if(e.y<this.region.height-1&&void 0!==this.region.map[e.y+1][e.x].building&&"Road"===this.region.map[e.y+1][e.x].building.name){a=this._getBuildingImage(e.x,e.y+1);this.tileElements[e.y+1][e.x].building.setTexture(a.sprite,a.tile)}}}else void 0!==this.tileElements[e.y][e.x].building&&(this.tileElements[e.y][e.x].building.destroy(),this.tileElements[e.y][e.x].building=void 0)}refresh(){this.rebirth()}changeRegion(){this.rebirth()}rebirth(){this.region.removeHandlers(),this.region=vt.instance.getCurrentRegion(),this.region.onTileChanged(e=>{this._updateTile(e)}),this.region.onSighting(e=>{this.scene.get("DarkWorld").notifyRegion()}),this.offsetX=360-this.region.width*this.WIDTH/2,this.offsetY=370-this.region.height*this.HEIGHT/2;for(var e=0;e<this.tileElements.length;e++)for(var t=0;t<this.tileElements[0].length;t++)this.tileElements[e][t].rect.destroy(),void 0!==this.tileElements[e][t].building&&this.tileElements[e][t].building.destroy();for(e=0;e<this.guides.length;e++)this.guides[e].destroy();this.tileElements=[];for(e=0;e<this.region.height;e++){var i=[];for(t=0;t<this.region.width;t++)i.push(this._setupTile(t,e));this.tileElements.push(i)}this.guides=[];for(e=0;e<this.region.height;e++)this.guides.push(this.add.bitmapText(this.relativeX(this.offsetX-this.WIDTH/2),this.relativeY(this.offsetY+(e+.5)*this.HEIGHT),"courier20",this.letters[e]).setOrigin(.5));for(e=0;e<this.region.width;e++)this.guides.push(this.add.bitmapText(this.relativeX(this.offsetX+(e+.5)*this.WIDTH),this.relativeY(this.offsetY-this.HEIGHT/2),"courier20",""+(e+1)).setOrigin(.5));var s=this.region.invasionCounter/Ee;this.invasionLabel.setText("Invasion\n"+Math.floor(100*s)+"%"),this.invasionLabel.setVisible(this.progression.unlocks.buildings),this.autoExploreLabel.setVisible(this.progression.persistentUnlocks.autoExplore),this.autoExploreButton.setVisible(this.progression.persistentUnlocks.autoExplore),this._updateRegionStats()}_toggleAutoExplore(){this.autoExploreActive=!this.autoExploreActive,!0===this.autoExploreActive?(this.autoExploreButton.setText("ON"),this.autoExploreButton.setTextColor(Phaser.Display.Color.GetColor(255,255,255))):(this.autoExploreButton.setText("OFF"),this.autoExploreButton.setTextColor(Phaser.Display.Color.GetColor(175,0,140)))}create(){this.scene.get("CombatScene").registerEvent("onExplore",(e,t)=>{this._onExploredCallback(e,t)}),this.add.rectangle(this.relativeX(0),this.relativeY(0),900,700,0).setOrigin(0).setInteractive(),this.invasionLabel=this.add.bitmapText(this.relativeX(720),this.relativeY(90),"courier20","Invasion",20,1),this.invasionLabel.setVisible(this.progression.unlocks.buildings);var e=this.region.invasionCounter/Ee;this.invasionLabel.setTint(Phaser.Display.Color.GetColor(40+215*e,40+215*e,40+215*e)),this.offlineLabel=this.add.bitmapText(this.relativeX(660),this.relativeY(140),"courier20","Offline Time: "+vt.instance.time.getOfflineTimeString()),this.speed1xButton=new bt(this,this.relativeX(795),this.relativeY(160),30,20,"1x").onClickHandler(()=>{vt.instance.time.setTimeScale(1)}),this.speed2xButton=new bt(this,this.relativeX(830),this.relativeY(160),30,20,"2x").onClickHandler(()=>{vt.instance.time.setTimeScale(2)}),this.speed5xButton=new bt(this,this.relativeX(865),this.relativeY(160),30,20,"5x").onClickHandler(()=>{vt.instance.time.setTimeScale(5)}),this.autoExploreLabel=this.add.bitmapText(this.relativeX(660),this.relativeY(190),"courier20","Auto Explore:"),this.autoExploreButton=new bt(this,this.relativeX(795),this.relativeY(190),40,20,"OFF").onClickHandler(()=>{this._toggleAutoExplore()}),this.autoExploreButton.setTextColor(Phaser.Display.Color.GetColor(175,0,140)),this.autoExploreLabel.setVisible(this.progression.persistentUnlocks.autoExplore),this.autoExploreButton.setVisible(this.progression.persistentUnlocks.autoExplore),this.exploreLabel=this.add.bitmapText(this.relativeX(660),this.relativeY(220),"courier20","Exploring:"),this.exploreProgressBar=new Tt(this,this.relativeX(765),this.relativeY(220),130,20,Phaser.Display.Color.GetColor(0,0,255),Phaser.Display.Color.GetColor(32,32,64)),this.exploreProgressBar.setFillPercent(0),this.floatingText=void 0,this.tileElements=[];for(var t=0;t<this.region.height;t++){for(var i=[],s=0;s<this.region.width;s++)i.push(this._setupTile(s,t));this.tileElements.push(i)}this.guides=[];for(t=0;t<this.region.height;t++)this.guides.push(this.add.bitmapText(this.relativeX(this.offsetX-this.WIDTH/2),this.relativeY(this.offsetY+(t+.5)*this.HEIGHT),"courier20",this.letters[t]).setOrigin(.5));for(t=0;t<this.region.width;t++)this.guides.push(this.add.bitmapText(this.relativeX(this.offsetX+(t+.5)*this.WIDTH),this.relativeY(this.offsetY-this.HEIGHT/2),"courier20",""+(t+1)).setOrigin(.5));this.progression.addOnUnlockHandler((e,t,i)=>{this._handleProgressionEvent(e,t,i)}),this.region.onTileChanged(e=>{this._updateTile(e)}),this.region.onSighting(e=>{this.scene.get("DarkWorld").notifyRegion()}),this.upgradeKey=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.U),this._updateRegionStats(),this._onRegionChanged()}update(e,t){if(this.offlineLabel.setText("Offline Time: "+vt.instance.time.getOfflineTimeString()),this.region.sightings.length>0){var i=this.region.invasionCounter/Ee;this.invasionLabel.setText("Invasion\n"+Math.floor(100*i)+"%"),this.invasionLabel.setTint(Phaser.Display.Color.GetColor(40+215*i,40+215*i,40+215*i)),this.sightingVal=(this.sightingVal+t)%2e3;for(var s=.5*Math.sin(this.sightingVal/2e3*Math.PI*2)+.5,a=0;a<this.region.sightings.length;a++){var r=this.region.sightings[a],n=Ct(this.region.map[r[0]][r[1]].color);this.tileElements[r[0]][r[1]].rect.fillColor=Qe.colorLerp(n,Phaser.Display.Color.GetColor(255,0,255),s)}}if(Phaser.Input.Keyboard.JustUp(this.upgradeKey)&&-1!==this.hoveredTile[0]&&this._tileActionHandler("upgrade",{tile:this.region.map[this.hoveredTile[1]][this.hoveredTile[0]]}),!0===this.updateBuildings){this.updateBuildings=!1;for(a=0;a<this.region.roads.length;a++){var o=this.region.roads[a],h=this._getBuildingImage(o[1],o[0]);this.tileElements[o[0]][o[1]].building.setTexture(h.sprite,h.tile)}}if(void 0!==this.activeTile){const e=this.letters[this.activeTile.y]+""+(this.activeTile.x+1)+" - "+this.activeTile.name;this.exploreProgressBar.setFillPercent(this.activeTile.amountExplored/this.activeTile.explorationNeeded,e)}}}class Rt{constructor(e,t,i,s,a,r,n){this.backRect=e.add.rectangle(t,i,s,a,0).setOrigin(0,0),this.backRect.isStroked=!0,this.backRect.strokeColor=Phaser.Display.Color.GetColor(255,255,255),this.backRect.lineWidth=1,this.img=e.add.image(t+s/2,i+a/2,r.sprite,r.tile).setOrigin(.5),this.img.displayWidth=s,this.img.displayHeight=a,this.scene=e,this.floatingText=void 0,this.x=t,this.y=i,this.width=s,this.height=a,this.tooltip=Qe.processText(n,40),this.backRect.setInteractive().on("pointerover",()=>{this._showTooltip()}).on("pointerout",()=>{this._removeTooltip()})}setPosition(e,t){this.x=e,this.y=t,this.backRect.setPosition(e,t),this.img.setPosition(e+this.width/2,t+this.height/2)}setVisible(e){this.backRect.setVisible(e),this.img.setVisible(e)}setTooltip(e){this.tooltip=Qe.processText(e,40)}_showTooltip(){if(""!=this.tooltip){void 0!==this.floatingText&&this.floatingText.destroy();var e=this.x+20+(this.x+350>1100?-350:0),t=this.y+(this.y-100<0?0:-100);this.floatingText=new a(this.scene,this.tooltip,e,t,350,100,"courier16",16)}}_removeTooltip(){this.floatingText.destroy(),this.floatingText=void 0}destroy(){void 0!==this.floatingText&&this.floatingText.destroy(),this.backRect.destroy(),this.img.destroy()}}class Bt{static getTalentTooltip(e,t){switch(e.name){case"Strength":return"Each point of Strength increases your damage more. Increases Damage gained by Strength by "+7*t+"% + (7%).";case"Dexterity":return"Each point of Dexterity gives more Hit. You gain "+(7+t)+" + (1) Hit per Dexterity.";case"Agility":return"Each point of Agility gives more Evasion. You gain "+(7+t)+" + (1) Evasion per Agility.";case"Endurance":return"Get more health from Endurance. You gain "+(5+t)+" + (1) max Health per Endurance.";case"Recovery":return"Heal wounds as fast as you get them! Increases Health Regen from Recovery by "+8*t+"% + (8%).";case"Defense":return"Get more armor from Defense. Increases Armor from Defense by "+13*t+"% + (13%).";case"Accuracy":return"Crit even harder. You gain "+(3+.5*t)+" + (0.5) Crit Power per Accuracy.";case"Hit":return"Gain even more Hit from all sources. Increase your Hit by "+4*t+"% + (4%).";case"Evasion":return"Gain even more Evasion from all sources. Increase your Evasion by "+4*t+"% + (4%).";case"Critical":return"Everyone loves to crit, so here is some free crit chance. Increase your crit chance by "+1*t+"% + (1%).";case"Bounty":return"Somehow improves how much loot enemies drop. Increases your perception or something? Gain a "+10*t+"% + (10%) chance for enemies to drop loot twice.";case"Explorer":return"If you want to explore fast you gotta go fast. Increases your explore speed by "+20*t+"% + (20%).";case"Cleave":return"Hit everything super hard. You gain a 20% chance your attacks hit an additional target dealing "+20*t+"% + (20%) of your Strength in damage";case"Resilient":return"Brush off critical attacks like they were merely normal attacks. When hit by a crit you reduce the damage by "+5*t+"% + (5%) of your Endurance, to a minimum of 2.";case"Quick Recovery":return"All you need is a quick rest between fights and your good to go. Your Health Regen increases by "+25*t+"% + (25%) while out of combat.";case"Block":return"Your mastery of defense allows you to sometimes block part of a hit, isn't that great? You have a 20% chance to block "+25*t+" + (25%) of your Defense worth of damage.";case"Stunning Hit":return"Hit them so hard you leave them concussed, causing serious long term damage. Each attack has a "+5*t+"% + (5%) chance to halt their attack bar for 0.5 seconds.";case"Follow Through":return"The best attacks are those that are immediately followed by more attacks. After attacking, gives a "+5*t+"% + (5%) chance that your attack bar starts half full, or half empty if you prefer.";case"Dodge":return"All the Hit in the world can't touch you some of the time. You automatically dodge every "+(13-t)+" - (1) Attacks against you.";case"Defy Death":return"Have you tried just... not dying? The next time you take lethal damage, you survive at 1 Health. Can be used again after "+(8-t)+" - (1) encounters. I didn't even know I tracked encounters!";case"Second Wind":return"All the best heroes are able to get right back to it after a beat down. When you drop below 50% health your Health Regen is tripled for 10 seconds. Has a "+(80-10*t)+" - (10) second cooldown.";case"Parry":return"Why block when you can parry? gives a "+5*t+"% + (5%) chance an enemy causes a glancing hit, dealing half damage. Thats still something, right?";case"Double Crit":return"Crit so hard your crits have crits. Gain a chance to crit twice, doubling your crit damage for the attack. Double crit chance is "+1*t+"% + (1%) of your normal crit chance.";case"Guardian":return"Getting invaded while you weren't paying attention sucks. Isn't this supposed to be an idle game? Invasions build up "+25*t+"% + (25%) slower.";case"Governance":return"Spend less time fighting things and more time learning how they can fight for you! Increases economy and production by "+4*t+"% + (4%). This effect is multiplicative, not additive.";case"Loot Goblin":return"Your desire for loot is so strong you've summoned the Loot Goblin! Each enemy has a "+.5*t+"% + (0.5%) chance to be a Loot Goblin, giving 10x the usual reward.";case"Bundle":return"The villagers say they don't have anymore money to pay you a better bounty, so have these rocks instead! While exploring you earn "+3*t+"% + (3%) of the Towns daily production per kill.";case"Charisma":return"Your screams of terror while fighting the monsters has charmed the villagers. Gain "+10*t+"% + (10%) more friendship from killing monsters.";case"Town Guard":return"Motivate the elderly to throw their bodies at enemy invasions! When the invasion counter reaches 100% you have a "+.5*t+"% + (0.5%) chance per defense to not be invaded! You'll still lose population, but that's a sacrifice you're willing to make."}}static getTechTooltip(e,t){switch(e.name){case"Forge":return"Each level reduces crafting costs of T"+t+" gear and below by 5%. Don't ask me how this works.";case"Guilds":return"Each level increases resource gain from buildings by 10%.";case"Town Hall":return"Each level increases Bounty gold from killing monsters in this region by 10%. The best quest is the one that pays the most.";case"Market":return"Unlocks the Market. Once built the Market increases tax income by 0-5% based on distance to the Town and other Markets.";case"Tavern":return"Everyone Needs a drink. Unlocks the Tavern, combining your two loves, getting more money and people that pay you money.";case"Reinforced Houses":return"Every man's home is a castle, but more literal. Increases the defense of all buildings by 1.";case"Banking":return"Learn how to make money from nothing! Each level increases tax income by 5% and increases your base gold cap by 50.";case"Map Making":return"Instead of wandering aimlessly, get some villagers to make some maps. Increases exploration speed by 10%."}}static getMoonlightTooltip(e){switch(e.name){case"Moon's Strength":return"Increases your starting Strength by "+e.level+" + (1) and increases Strength from all sources by "+e.level+"% + (1%).";case"Moon's Dexterity":return"Increases your starting Dexterity by "+e.level+" + (1) and increases Dexterity from all sources by "+e.level+"% + (1%).";case"Moon's Agility":return"Increases your starting Agility by "+e.level+" + (1) and increases Agility from all sources by "+e.level+"% + (1%).";case"Moon's Endurance":return"Increases your starting Endurance by "+e.level+" + (1) and increases Endurance from all sources by "+e.level+"% + (1%).";case"Moon's Recovery":return"Increases your starting Recovery by "+e.level+" + (1) and increases Recovery from all sources by "+e.level+"% + (1%).";case"Moon's Defense":return"Increases your starting Defense by "+e.level+" + (1) and increases Defense from all sources by "+e.level+"% + (1%).";case"Moon's Accuracy":return"Increases your starting Accuracy by "+e.level+" + (1) and increases Accuracy from all sources by "+e.level+"% + (1%).";case"Hero's Vault":return"Increases the base income per villager by "+.1*e.level+" + (0.1) gold.";case"Moonwine":return"Taverns count Town Houses within "+(1+e.level)+" + (1) tiles for their bonus.";case"Hardened Villagers":return"Buildings have "+e.level+" + (1) more defense.";case"Shadow's Blessing":return"You gain "+10*e.level+"% + (10%) more shade from monsters.";case"Moon Runes":return"Unlocks Runes. Runes can be found after exploring a tile and can be socketed into gear to provide a random set of bonuses.";case"Dire Beasts":return"Dire versions of beasts can be found which are much stronger than their normal counterparts. Defeating them grants bonus shade, resources, and Motes of Darkness.";case"Heart of Darkness":return"Defeating invasion monsters give "+e.level+" + (1) additional Motes of Darkness.";case"Blackiron Gear":return"Motes of Darkness can reach a "+(20+10*e.level)+"% + (10%) bonus before diminishing returns.";case"Runelands":return"Each region contains "+(5+e.level)+" + (1) hidden runes.";case"Moonlight Workers":return"Production buildings generate "+e.level+"% + (1%) more resources per defense.";case"Hero's Pouch":return"Increases your gold cap by "+100*e.level+" + (100) per town.";case"Night Market":return"Markets increase your economy by 0-"+(5+e.level)+"% + (1%) based on distance between the Town and other Markets.";case"Shadow's Metal":return"Metal yields are increased by "+5*e.level+"% + (5%).";case"Shadow's Leather":return"Leather yields are increased by "+5*e.level+"% + (5%).";case"Shadow's Fiber":return"Fiber yields are increased by "+5*e.level+"% + (5%).";case"Shadow's Stone":return"Stone yields are increased by "+5*e.level+"% + (5%).";case"Shadow's Wood":return"Wood yields are increased by "+5*e.level+"% + (5%).";case"Shadow's Crystal":return"Crystal yields are increased by "+5*e.level+"% + (5%).";case"Shadow's Gold":return"Monsters drop "+.25*e.level+" + (0.25) more gold.";case"Discovery":return"Gain "+10*e.level+" + (10) friendship each time you fully explore a tile.";case"Shadow's Chosen":return"Monsters base shade reward increased by "+2*e.level+" + (2). This is added before other multipliers, such as Shadow's Blessing or monster level.";case"Corrupted Runes":return"Upgrading and Rerolling Runes costs "+Math.floor(100*Math.pow(.93,e.level))+"% - (~7%) fewer Motes of Darkness.";case"Soulbound":return"Gear gains an additional "+e.level+"% + (1%) of their base stats every level.";case"Farstrider":return"Your explore speed is increased by "+10*e.level+"% + (10%).";case"Motivated Labor":return"Production is increased by "+e.level+"% + (1%) per friendship level.";case"Crown Lands":return"Each explored tile increases your base gold cap by "+2*e.level+" + (2).";case"Mystic Cauldron":return"Alchemy Labs create "+10*e.level+"% + (10%) more resources from the same inputs.";case"Shadow's Harvest":return"Each day you gain "+.1*e.level+" + (0.1) shade per villager. This bonus is increased by Shadow's Blessing.";case"Shadow Wolf Charm":return"Unlocks the Shadow Wolf Charm trinket which grants Strength and Damage. Available up to tier "+e.level+" + (1)";case"Moonlight Circlet":return"Unlocks the Moonlight Circlet trinket which grants Dexterity and Hit. Available up to tier "+e.level+" + (1)";case"Moon Treads":return"Unlocks the Moon Treads trinket which grants Agility and Evasion. Available up to tier "+e.level+" + (1)";case"Moonstone":return"Unlocks the Moonstone trinket which grants Endurance, Health, and Crit Resistance. Available up to tier "+e.level+" + (1)";case"Dreamlight Bracer":return"Unlocks the Dreamlight Bracer trinket which grants Recovery and Health Regen. Available up to tier "+e.level+" + (1)";case"Shadow Veil":return"Unlocks the Shadow Veil trinket which grants Defense and Armor. Available up to tier "+e.level+" + (1)";case"Nightmare Pendant":return"Unlocks the Nightmare Pendant trinket which grants Accuracy, Crit Chance and Crit Power. Available up to tier "+e.level+" + (1)";case"Night Labour":return"Unlocks Night Labour for Towns. When active, villagers gold income is reduced by 50% while all production is increased by "+10*e.level+"% + (10%)."}}static getRegionTooltip(e){switch(e){case"temperate":return"A balanced area where all resources are equally abundant.";case"mountains":return"Mountains and plateau's as far as the eye can see. Home to flying beasts, there is plenty of metal and stone to be found here.";case"desert":return"A hot desert full of horrible creatures with the occasional dry plains full of hungry beasts. At least the crystals shine in the moonlight.";case"forest":return"A massive forest full of the oldest trees waiting to be cut down, beasts to be hunted and plants to be gathered.";case"hills":return"Rolling hills with few plains between them. Full of wild beasts, plants, and the Gnoll's who hunt them."}}static getChallengeDescription(e){switch(e.name){case"A Matter of Years":return"Now that you've reached out into the world and understand the basics why not do it again, but faster. As they say, practice makes perfect!\n\nRestrictions: Reach the 2nd Gate within "+(5-e.completions)+" Years.\n\nOn First Completion: Unlock new challenges.\nOn Every Completion: Increases moonlight earned by 15%\n                     +2 Challenge Points\n\nIt is possible to fail this challenge!\n\nCompletions: "+e.completions+"/"+e.maxCompletions+"\nFastest Time: "+new yt(e.fastestTime).getTimespanText();case"Forged Ahead":return"Those forge upgrades sure are useful, especially now that all your gear costs "+(10+10*e.completions)+" times as much.\n\nRestrictions: Gear costs increased by "+(10+10*e.completions)+" times.\n              Reach the 2nd Gate.\n\nOn Every Completion: Gear costs are multiplied by x0.925\n                     +2 Challenge Points\n\nCompletions: "+e.completions+"/"+e.maxCompletions+"\nFastest Time: "+new yt(e.fastestTime).getTimespanText();case"Giant Lands":return"Is this land massive, or are you just really small? Each region is smaller, but takes 25 times longer to explore. Also all monsters have the Monstrous "+(2+2*e.completions)+" trait.\n\nRestrictions: Exploration needed is increased by 25x\n              Reach Gate "+(1+e.completions)+".\n\nOn Every Completion: Increases explore speed by 25%\n                     +3 Challenge Points\n\nCompletions: "+e.completions+"/"+e.maxCompletions+"\nFastest Time: "+new yt(e.fastestTime).getTimespanText();case"Talentless":return"You rely way too much on those talents. Let's see you get through without them.\n\nRestrictions: Talents are removed.\n              Reach Gate "+(3+e.completions)+".\n\nOn Every Completion: Start with +1 Talent points.\n                     Talent costs scale slightly slower.\n                     +3 Challenge Points\n\nCompletions: "+e.completions+"/"+e.maxCompletions+"\nFastest Time: "+new yt(e.fastestTime).getTimespanText();case"Lazy Townsfolk":return"None of the townsfolk in this realm know how to work. Either that or they're just really lazy.\n\nRestrictions: Production buildings are unavailable.\n              Reach Gate "+(3+e.completions)+".\n\nOn First Completion: Unlock the Warehouse building.\nOn Every Completion: Increases building production by 10%\n                     +4 Challenge Points\n\nCompletions: "+e.completions+"/"+e.maxCompletions+"\nFastest Time: "+new yt(e.fastestTime).getTimespanText();case"Mega Monsters":return"*slaps monster* this baby can fit so many traits inside it. How many? "+(4+2*e.completions)+" traits. That's how many.\n\nRestrictions: Monsters start with "+(4+2*e.completions)+" traits.\n              Reach Gate "+(5+e.completions)+".\n\nOn Every Completion: Monsters give 5% more shade, plus 1% per trait.\n                     +5 Challenge Points\n\nCompletions: "+e.completions+"/"+e.maxCompletions+"\nFastest Time: "+new yt(e.fastestTime).getTimespanText();case"Outcast":return"You rely too much on others. Time to learn the true meaning of friendship.\n\nRestrictions: Building Production reduced by "+(50+10*e.completions)+"%.\n              Town Upgrades cost 1 level of friendship.\n              Region spans "+(40+5*e.completions)+" levels.\n              Reach Gate "+(5+e.completions)+".\n\nOn Every Completion: Gain 10% more friendship.\n                     Friendship tiers scale slightly slower.\n                     +5 Challenge Points\n\nCompletions: "+e.completions+"/"+e.maxCompletions+"\nFastest Time: "+new yt(e.fastestTime).getTimespanText()}}static getTraitTooltip(e){switch(e.type){case Be:return"Dire "+e.level+": Core stats are increased by "+20*e.level+"%, drops motes and gives "+75*e.level+"% more experience.";case Pe:return"Poisoned "+e.level+": Deals "+3*e.level+"% of its max damage per second as true damage.";case Ie:return"Monstrous "+e.level+": Attack speed is reduced by 15%. Has "+25*e.level+"% increased health and "+10*e.level+"% increased damage.";case Le:return"Quick "+e.level+": Attack speed is increased by 20%. Has "+25*e.level+"% increased evasion.";case De:return"Deadly "+e.level+": Crit chance is doubled and has "+5*e.level+"% more damage and crit power.";case Se:return"Shielded "+e.level+": Every second gains "+20*e.level+"% of their armor as a shield that absorbs incoming damage. Crit Resistance is increased 1000% while shielded.";case He:return"Beserk "+e.level+": Hit chance is increased by "+20*e.level+"%, health regen by "+10*e.level+"% and has a "+Math.floor(100*(1-Math.pow(.92,e.level)))+"% chance to trigger Follow Through."}}static getRuneBonusText(e,t){var i=t>=0?"+":"";switch(e){case"strPercent":return i+Math.round(100*t)+"% Strength";case"strFlat":return i+Math.floor(t)+" Strength";case"strTalents":return i+Math.floor(t)+" Strength Talents";case"dexPercent":return i+Math.round(100*t)+"% Dexterity";case"dexFlat":return i+Math.floor(t)+" Dexterity";case"dexTalents":return i+Math.floor(t)+" Dexterity Talents";case"agiPercent":return i+Math.round(100*t)+"% Agility";case"agiFlat":return i+Math.floor(t)+" Agility";case"agiTalents":return i+Math.floor(t)+" Agility Talents";case"endPercent":return i+Math.round(100*t)+"% Endurance";case"endFlat":return i+Math.floor(t)+" Endurance";case"endTalents":return i+Math.floor(t)+" Endurance Talents";case"recPercent":return i+Math.round(100*t)+"% Recovery";case"recFlat":return i+Math.floor(t)+" Recovery";case"recTalents":return i+Math.floor(t)+" Recovery Talents";case"defPercent":return i+Math.round(100*t)+"% Defense";case"defFlat":return i+Math.floor(t)+" Defense";case"defTalents":return i+Math.floor(t)+" Defense Talents";case"accPercent":return i+Math.round(100*t)+"% Accuracy";case"accFlat":return i+Math.floor(t)+" Accuracy";case"accTalents":return i+Math.floor(t)+" Accuracy Talents";case"hitPercent":return i+Math.round(100*t)+"% Hit Chance";case"evaPercent":return i+Math.round(100*t)+"% Evasion";case"weaponPercent":return i+Math.round(100*t)+"% Gear Damage";case"armorPercent":return i+Math.round(100*t)+"% Gear Armor";case"critPercent":return i+Math.round(100*t)+"% Crit Power";case"healthPercent":return i+Math.round(100*t)+"% Health";case"regenPercent":return i+Math.round(100*t)+"% HP Regen";case"weaponScaling":return i+Math.round(100*t)+" Gear Damage Scaling";case"armorScaling":return i+Math.round(100*t)+" Gear Armor Scaling";case"baseAttackSpeed":return i+Math.round(100*t)+"% Faster Attacks";case"OOCRegen":return i+t+" Out of Combat Regen";case"enemyCrit":return Math.round(100*Math.pow(.92,t))+"% Crit Damage Taken";case"exploreSpeed":return i+Math.round(100*t)+"% Explore Speed";case"friendshipMulti":return i+Math.round(100*t)+"% Friendship Earned";case"critChance":return i+Math.round(100*t)+"% Crit Chance";case"lootFlat":return i+t+" to Loot Dropped";case"lootTalent":return i+t+" Bounty Talent";case"moteChance":return i+Math.round(1e3*t)/10+"% Mote on Kill";case"shadeFlat":return i+t+" Shade per Kill";case"regenOnKill":return i+Math.round(10*t)/10+"s of Regen on Kill";case"dexToStr":return i+Math.round(100*t)+"% Dexterity to Strength";case"endToRec":return i+Math.round(100*t)+"% Endurance to Recovery";case"agiToDef":return i+Math.round(100*t)+"% Agility to Defense";case"allPercent":return i+Math.round(100*t)+"% All Attributes";case"governanceTalent":return i+t+" Governance Talent";case"guardianTalent":return i+t+" Guardian Talent";case"agilityScaling":return i+Math.round(100*t)+" Agility Explore Scaling"}return""}}class Pt{constructor(e,t,i){this.x=t,this.y=i,this.sceneContext=e,this.backingRect=e.add.rectangle(t,i,250,170,Phaser.Display.Color.GetColor(0,0,0)).setOrigin(0,0),this.backingRect.isStroked=!0,this.backingRect.strokeColor=Phaser.Display.Color.GetColor(200,0,0),this.backingRect.lineWidth=2,this.imageRect=e.add.rectangle(t+5,i+5,64,64,Phaser.Display.Color.GetColor(0,0,0)).setOrigin(0,0),this.imageRect.isStroked=!0,this.imageRect.strokeColor=Phaser.Display.Color.GetColor(200,0,0),this.imageRect.lineWidth=2,this.image=e.add.image(t+5,i+5,"enemyicons",63).setOrigin(0),this.image.displayWidth=64,this.image.displayHeight=64,this.nameLabel=e.add.bitmapText(t+75,i+5,"courier20",""),this.damageLabel=e.add.bitmapText(t+75,i+25,"courier16",""),this.armorLabel=e.add.bitmapText(t+75,i+45,"courier16",""),this.hitnameLabel=e.add.bitmapText(t+75,i+65,"courier16",""),this.evasionLabel=e.add.bitmapText(t+75,i+85,"courier16",""),this.healthBar=new Tt(e,t+5,i+125,240,14,Phaser.Display.Color.GetColor(170,0,0),Phaser.Display.Color.GetColor(32,32,32)),this.attackBar=new Tt(e,t+5,i+145,240,14,Phaser.Display.Color.GetColor(0,140,40),Phaser.Display.Color.GetColor(32,32,32)),this.traitButtons=[]}initWithCreature(e){this.nameLabel.setText(e.name),this.damageLabel.setText("Damage: "+Qe.numberString(Math.floor(e.DamageMin()))+"-"+Qe.numberString(Math.floor(e.DamageMax()))),this.armorLabel.setText("Armor: "+Qe.numberString(Math.floor(e.Armor()))),this.hitnameLabel.setText("Hit: "+Qe.numberString(Math.floor(e.Hit()))),this.evasionLabel.setText("Evasion: "+Qe.numberString(Math.floor(e.Evasion()))),this.backingRect.strokeColor=Phaser.Display.Color.GetColor(200,0,0),this.healthBar.setFillPercent(e.currentHealth/e.MaxHealth(),Qe.numberString(Math.ceil(e.currentHealth))+"/"+Qe.numberString(e.MaxHealth())),this.attackBar.setFillPercent(e.attackCooldown/e.attackSpeed,Math.floor(e.attackCooldown/e.attackSpeed*100)+"%"),this.image.setTexture(e.icon.sprite,e.icon.tile);for(var t=0;t<this.traitButtons.length;t++)this.traitButtons[t].destroy();this.traitButtons=[];for(t=0;t<e.traits.length;t++){var i={sprite:"icons",tile:63};switch(e.traits[t].type){case Be:i={sprite:"icons",tile:43};break;case Pe:i={sprite:"icons",tile:46};break;case Ie:i={sprite:"icons",tile:42};break;case Le:i={sprite:"icons",tile:49};break;case De:i={sprite:"icons",tile:41};break;case Se:i={sprite:"icons",tile:44};break;case He:i={sprite:"icons",tile:45}}this.traitButtons.push(new Rt(this.sceneContext,this.x+75+20*t,this.y+105,16,16,i,Bt.getTraitTooltip(e.traits[t])))}}setVisible(e){this.backingRect.setVisible(e),this.imageRect.setVisible(e),this.image.setVisible(e),this.nameLabel.setVisible(e),this.damageLabel.setVisible(e),this.armorLabel.setVisible(e),this.hitnameLabel.setVisible(e),this.evasionLabel.setVisible(e),this.healthBar.setVisible(e),this.attackBar.setVisible(e);for(var t=0;t<this.traitButtons.length;t++)this.traitButtons[t].setVisible(e)}setHealthBar(e,t=""){this.healthBar.setFillPercent(e,t)}setShieldBar(e){this.healthBar.setSecondaryFillPercent(e)}setAttackBar(e,t=""){this.attackBar.setFillPercent(e,t)}setInvader(){this.backingRect.strokeColor=Phaser.Display.Color.GetColor(200,0,200)}getCenterX(){return this.x+125}getCenterY(){return this.y+85}}class It{static getAttackSpeedMultiplier(e,t){return e=Math.max(1,e),t=Math.max(1,t),Math.pow(e,A)/Math.pow(t,A)}static getAnimInfoFromKey(e){var t=[];switch(e){case"claws":case"clawscrit":t.push({frameId:0,duration:80}),t.push({frameId:1,duration:80}),t.push({frameId:2,duration:80}),t.push({frameId:3,duration:80})}return t}}class Lt{constructor(e,t,i,s,a,r){this.animInfo=a,this.frameIdx=0,this.duration=0,this.onCompleteCallback=r,this.spriteObj=e.add.image(t,i,s,a[0].frameId)}update(e){this.duration+=e,this.duration>this.animInfo[this.frameIdx].duration&&(this.duration-=this.animInfo[this.frameIdx].duration,this.frameIdx++,this.frameIdx>=this.animInfo.length&&(this.frameIdx=this.frameIdx%this.animInfo.length,void 0!==this.onCompleteCallback&&this.onCompleteCallback()),this.spriteObj.setFrame(this.animInfo[this.frameIdx].frameId))}destroy(){this.spriteObj.destroy()}}class Dt{constructor(){this.combatActive=!1,this.monsters=[],this.globalAttackCooldown=0,this.target=0,this.fightCooldown=ce,this.dropChances=[],this.dropTotals=0,this.activeTile=void 0,this.playerHitCallback=void 0,this.creatureHealthCallback=void 0,this.creatureAttackCallback=void 0,this.creatureHitCallback=void 0,this.rewardCallback=void 0,this.playerDefeatCallback=void 0,this.exploreCallback=void 0,this.combatCallback=void 0}registerEvent(e,t){switch(e){case"onPlayerHit":this.playerHitCallback=t;break;case"onCreatureHealthChanged":this.creatureHealthCallback=t;break;case"onCreatureAttackChanged":this.creatureAttackCallback=t;break;case"onCreatureHit":this.creatureHitCallback=t;break;case"onReward":this.rewardCallback=t;break;case"onPlayerDefeat":this.playerDefeatCallback=t;break;case"onExplore":this.exploreCallback=t;break;case"onCombatStart":this.combatCallback=t}return this}_monstersAlive(){for(var e=0;e<this.monsters.length;e++)if(this.monsters[e].currentHealth>0)return!0;return!1}_getTarget(){if(!1===this._monstersAlive())return 0;for(var e=Qe.randint(0,this.monsters.length);this.monsters[e].currentHealth<=0;)e=(e+1)%this.monsters.length;return e}_creatureWorkaround(e){this.monsters[e].registerEvent("onHealthChanged",t=>{this._creatureHealthChanged(t,e)}),this.monsters[e].registerEvent("onAttackCooldownChanged",t=>{this._creatureAttackChanged(t,e)})}_creatureHealthChanged(e,t){void 0!==this.creatureHealthCallback&&this.creatureHealthCallback(e,t)}_creatureAttackChanged(e,t){void 0!==this.creatureAttackCallback&&this.creatureAttackCallback(e,t)}setTile(e){this.activeTile=e,this.dropChances=[100,100,100,100,100,100],this.dropTotals=0;for(var t=ct.TILE_TYPES[e.regName],i=0;i<t.yields.length;i++)this.dropChances[i]+=t.yields[i],this.dropTotals+=this.dropChances[i]}initFight(){this.combatActive=!0,this.monsters=this.activeTile.generateMonsters();for(var e=0;e<this.monsters.length;e++)this._creatureWorkaround(e);this.target=this._getTarget(),void 0!==this.combatCallback&&this.combatCallback(this.activeTile.isInvaded)}isInCombat(){return!0===this.combatActive&&this.fightCooldown<=0}stopCombat(){this.combatActive=!1}_getDropIndex(){for(var e=Qe.randint(0,this.dropTotals),t=0;t<this.dropChances.length;t++){if(e<this.dropChances[t])return t;e-=this.dropChances[t]}return 0}_handleRewards(){this.fightCooldown=ce;for(var e={tier:this.activeTile.parent.regionLevel,resource:[0,0,0,0,0,0],shade:0,gold:0,motes:0,friendship:0},t=ht.getInstance(),i=0;i<this.monsters.length;i++){e.gold+=1+Math.max(1,this.monsters[i].level)/14+.25*Je.getInstance().moonperks.gold.level,e.shade+=this.monsters[i].xpReward+t.runeBonuses.shadeFlat,e.motes+=this.monsters[i].motes,Math.random()<t.runeBonuses.moteChance&&(e.motes+=1);for(var s=t.getTalentLevel("bounty"),a=1+s/10+(s%10/10>Math.random()?1:0),r=this.activeTile.parent.regionLevel*ot.getInstance().regionDifficultyIncrease,n=0;n<a;n++){var o=this._getDropIndex(),h=1+.2*(this.monsters[i].level-r)+.1*this.activeTile.parent.regionLevel;e.resource[o]+=Math.max(0,this.monsters[i].dropBase*h)+t.runeBonuses.lootFlat}e.friendship+=this.activeTile.getFriendshipReward()}if(t.getTalentLevel("bundle")>0){var l=this.monsters.length*t.getTalentLevel("bundle")*.03,c=vt.getInstance().getCurrentRegion()._getResourcesPerDay();for(i=0;i<c.length;i++)e.resource[i]+=c[i]*l}e.gold=(e.gold+(this.activeTile.explored?1:5))*this.activeTile.parent.townData.bountyMulti,e.shade*=Je.getInstance().getShadowBonus()*this.activeTile.parent.townData.getFriendshipBonus(),e.friendship*=(1+t.runeBonuses.friendshipMulti)*(1+.1*Je.getInstance().challenges.outcast.completions)*(1+.1*t.getTalentLevel("charisma")),!0===this.activeTile.isInvaded&&(!1===Ze.getInstance().unlocks.motes&&Ze.getInstance().registerFeatureUnlocked(y,"Well it happened. Some big bad monsters came back to spew their horrible mists all over the place again, but fortunately for you you had prepared for this. After killing the great misty one in the back it dropped something you haven't seen before... sort of like Shade, but like, more solid. You should probably just call them Motes of Darkness. I'm sure the townsfolk will be super impressed if you bring this dumb stone back and call it that.\n\nOh, you can probably try putting it on your weapon if you really wanted to. It's up to you."),e.motes+=1+Je.getInstance().moonperks.heartofdarkness.level,this.activeTile.invasionFights-=1,this.activeTile.invasionFights<=0&&vt.getInstance().getCurrentRegion().endSighting(this.activeTile.x,this.activeTile.y)),void 0!==this.rewardCallback&&this.rewardCallback(e)}update(e){if(!1!==this.combatActive)if(this.globalAttackCooldown>0)this.globalAttackCooldown-=e;else{var t=ht.getInstance();if(!0===this._monstersAlive()){for(var i=0;i<this.monsters.length;i++)if(!(this.monsters[i].currentHealth<=0)){var s=It.getAttackSpeedMultiplier(this.monsters[i].Hit(),t.statBlock.Evasion());this.monsters[i].tickAttackCooldown(e,s),this.monsters[i].tickRegen(e);var a=this.monsters[i].findTrait(Pe);if(void 0!==a&&t.statBlock.takeDamage(.03*this.monsters[i].DamageMax()*a.level*(e/1e3),!1,!0),!0===this.monsters[i].canAttack()){var r=this.monsters[i].CritChance()>Math.random();this.monsters[i].attack(t.statBlock,r);this.globalAttackCooldown=de,void 0!==this.playerHitCallback&&this.playerHitCallback(this.monsters[i],r);break}}s=It.getAttackSpeedMultiplier(t.statBlock.Hit(),this.monsters[this.target].Evasion());if(t.statBlock.tickAttackCooldown(e,s),!0===t.statBlock.canAttack()){r=t.statBlock.CritChance()>Math.random();if(t.statBlock.attack(this.monsters[this.target],r),this.monsters[this.target].currentHealth<=0&&t.statBlock.heal(t.statBlock.HealthRegen()*t.runeBonuses.regenOnKill),t.getTalentLevel("cleave")>0&&Math.random()<.2){var n=this.target;for(i=0;i<this.monsters.length;i++){var o=(n+i)%this.monsters.length;if(void 0!==this.monsters[o]&&this.monsters[o].currentHealth>0){n=o;break}}n!==this.target&&(r=t.statBlock.CritChance()>Math.random(),t.statBlock.cleave(this.monsters[n],r),this.monsters[n].currentHealth<=0&&t.statBlock.heal(t.statBlock.HealthRegen()*t.runeBonuses.regenOnKill),void 0!==this.creatureHitCallback&&this.creatureHitCallback(n,r))}void 0!==this.creatureHitCallback&&this.creatureHitCallback(this.target,r),this.target=this._getTarget(),this.globalAttackCooldown=de}!1===this._monstersAlive()&&(this._handleRewards(),t.statBlock.encounterCounter-=1),t.statBlock.currentHealth<=0&&void 0!==this.playerDefeatCallback&&(t.statBlock.currentHealth=0,this.combatActive=!1,this.playerDefeatCallback())}else{this.fightCooldown-=e;var h=this.activeTile.explore(e);void 0!==this.exploreCallback&&this.exploreCallback(this.activeTile,h),this.fightCooldown<=0&&this.initFight()}}}}class St extends s{constructor(e,t){super(e,t),this.player=ht.getInstance(),this.onRewardHandlers=[],this.onExploreHandlers=[],this.regionTier=0,this.playerHitAnim=void 0,this.monsterHitAnim=[void 0,void 0,void 0],this.progression=new Ze,this.combatManager=(new Dt).registerEvent("onPlayerHealthChanged",e=>{this._playerHealthCallback(e)}).registerEvent("onPlayerAttackChanged",e=>{this._playerAttackCooldownCallback(e)}).registerEvent("onPlayerHit",(e,t)=>{this._setupPlayerAnim(e,t)}).registerEvent("onCreatureHealthChanged",(e,t)=>{this._monsterHealthCallback(e,t)}).registerEvent("onCreatureAttackChanged",(e,t)=>{this._monsterAttackCooldownCallback(e,t)}).registerEvent("onCreatureHit",(e,t)=>{this._setupMonsterAnim(e,t)}).registerEvent("onReward",(e,t)=>{this._rewardCallback(e,t)}).registerEvent("onPlayerDefeat",()=>{this._playerDefeatCallback()}).registerEvent("onExplore",(e,t)=>{this._exploreCallback(e,t)}).registerEvent("onCombatStart",e=>{this._onCombatCallback(e)})}enableScene(){}disableScene(){}_playerHealthCallback(e){this.playerDisplay.setHealthBar(e/this.player.statBlock.MaxHealth(),Qe.numberString(Math.ceil(e))+"/"+Qe.numberString(this.player.statBlock.MaxHealth()))}_playerAttackCooldownCallback(e){this.playerDisplay.setAttackBar(e/this.player.statBlock.attackSpeed,Math.floor(e/this.player.statBlock.attackSpeed*100)+"%")}_monsterHealthCallback(e,t){e=Math.max(0,e);var i=this.combatManager.monsters[t].shieldValue/this.combatManager.monsters[t].MaxHealth(),s="";s=i>0?Qe.numberString(Math.ceil(e))+"+("+Qe.numberString(Math.ceil(this.combatManager.monsters[t].shieldValue))+")/"+Qe.numberString(this.combatManager.monsters[t].MaxHealth()):Qe.numberString(Math.ceil(e))+"/"+Qe.numberString(this.combatManager.monsters[t].MaxHealth()),this.monsterDiplays[t].setHealthBar(e/this.combatManager.monsters[t].MaxHealth(),s),this.monsterDiplays[t].setShieldBar(i)}_monsterAttackCooldownCallback(e,t){this.monsterDiplays[t].setAttackBar(e/this.combatManager.monsters[t].attackSpeed,Math.floor(e/this.combatManager.monsters[t].attackSpeed*100)+"%")}_rewardCallback(e,t){this._hideEnemyDisplays(),this.restButton.setVisible(!0);for(var i=0;i<this.onRewardHandlers.length;i++)this.onRewardHandlers[i](e,t)}_playerDefeatCallback(){this._hideEnemyDisplays(),this.progression.registerDeath(1),this.restButton.setVisible(!0)}_updatePlayerBlock(){this.playerDisplay.initWithCreature(this.player.statBlock)}_onExplore(e){for(var t=0;t<this.onExploreHandlers.length;t++)this.onExploreHandlers[t](e,this.regionTier)}_hideEnemyDisplays(){for(var e=0;e<this.monsterDiplays.length;e++)this.monsterDiplays[e].setVisible(!1)}_setupPlayerAnim(e,t=!1){void 0!==this.playerHitAnim&&this._removePlayerAnim();var i=this.playerDisplay.getCenterX(),s=this.playerDisplay.getCenterY(),a=!0===t?e.critAnim:e.hitAnim;this.playerHitAnim=new Lt(this,i,s,a,It.getAnimInfoFromKey(a),()=>{this._removePlayerAnim()})}_removePlayerAnim(){this.playerHitAnim.destroy(),this.playerHitAnim=void 0}_setupMonsterAnim(e,t=!1){void 0!==this.monsterHitAnim[e]&&this._removeMonsterAnim(e);var i=this.monsterDiplays[e].getCenterX(),s=this.monsterDiplays[e].getCenterY(),a=!0===t?this.player.statBlock.critAnim:this.player.statBlock.hitAnim;this.monsterHitAnim[e]=new Lt(this,i,s,a,It.getAnimInfoFromKey(a),()=>{this._removeMonsterAnim(e)})}_removeMonsterAnim(e){this.monsterHitAnim[e].destroy(),this.monsterHitAnim[e]=void 0}_restHandler(){!0===this.combatManager.combatActive?(this.restButton.setText("Explore"),this.combatManager.stopCombat()):(this.restButton.setText("Rest"),this.combatManager.combatActive=!0)}registerEvent(e,t){"onReward"===e?this.onRewardHandlers.push(t):"onExplore"===e&&this.onExploreHandlers.push(t)}initFight(e){const t=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q"][e.y]+""+(e.x+1)+" - "+e.name;e.amountExplored>=e.explorationNeeded?this.explorationBar.setFillPercent(e.amountExplored/e.explorationNeeded,t+": Explored"):this.explorationBar.setFillPercent(e.amountExplored/e.explorationNeeded,t+": "+Math.floor(e.amountExplored/e.explorationNeeded*100)+"%"),this.invasionCounter.setVisible(e.isInvaded),this.invasionCounter.setText("Invaders: "+3*e.invasionFights),this.combatManager.setTile(e),this.combatManager.initFight(),this.regionTier=vt.instance.getCurrentRegion().regionLevel}rebirth(){this.combatManager.stopCombat(),this._hideEnemyDisplays()}preload(){this.load.spritesheet("claws","./../../assets/anims/clawanim.png",{frameWidth:128,frameHeight:128}),this.load.spritesheet("clawscrit","./../../assets/anims/clawanimcrit.png",{frameWidth:128,frameHeight:128})}create(){this.add.rectangle(this.relativeX(0),this.relativeY(0),900,700,0).setOrigin(0).setInteractive(),this.explorationBar=new Tt(this,this.relativeX(10),this.relativeY(10),880,20,Phaser.Display.Color.GetColor(0,0,255),Phaser.Display.Color.GetColor(32,32,64)),this.invasionCounter=this.add.bitmapText(this.relativeX(400),this.relativeY(35),"courier20","Invaders: 0").setTint(Phaser.Display.Color.GetColor(220,0,220)),this.invasionCounter.setVisible(!1),this.monsterDiplays=[],this.monsterDiplays.push(new Pt(this,this.relativeX(325),this.relativeY(70))),this.monsterDiplays.push(new Pt(this,this.relativeX(100),this.relativeY(170))),this.monsterDiplays.push(new Pt(this,this.relativeX(550),this.relativeY(170))),this.playerDisplay=new Pt(this,this.relativeX(325),this.relativeY(460)),this.playerDisplay.initWithCreature(this.player.statBlock),this._hideEnemyDisplays(),this.restButton=new bt(this,this.relativeX(800),this.relativeY(40),80,20,"Rest").onClickHandler(()=>{this._restHandler()}),this.player.statBlock.registerEvent("onHealthChanged",e=>{this._playerHealthCallback(e)}),this.player.statBlock.registerEvent("onAttackCooldownChanged",e=>{this._playerAttackCooldownCallback(e)}),this.player.registerEvent("onStatChanged",()=>{this._updatePlayerBlock()})}_updateAnimations(e){void 0!==this.playerHitAnim&&this.playerHitAnim.update(e);for(var t=0;t<this.monsterHitAnim.length;t++)void 0!==this.monsterHitAnim[t]&&this.monsterHitAnim[t].update(e)}_exploreCallback(e,t){const i=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q"][e.y]+""+(e.x+1)+" - "+e.name;e.amountExplored>=e.explorationNeeded?this.explorationBar.setFillPercent(e.amountExplored/e.explorationNeeded,i+": Explored"):this.explorationBar.setFillPercent(e.amountExplored/e.explorationNeeded,i+": "+Math.floor(e.amountExplored/e.explorationNeeded*100)+"%"),!0===t&&this._onExplore(e)}_onCombatCallback(e){this._hideEnemyDisplays();for(var t=this.combatManager.monsters,i=0;i<t.length;i++)this.monsterDiplays[i].setVisible(!0),this.monsterDiplays[i].initWithCreature(t[i]),!0===e&&this.monsterDiplays[i].setInvader();this.invasionCounter.setVisible(this.combatManager.activeTile.isInvaded),this.invasionCounter.setText("Invaders: "+3*this.combatManager.activeTile.invasionFights),this.restButton.setVisible(!1),this.playerDisplay.initWithCreature(this.player.statBlock)}isInCombat(){return this.combatManager.isInCombat()}update(e,t){var i=vt.instance.time.frameDelta;this._updateAnimations(i),this.combatManager.update(i)}}class Ht{constructor(e,t,i,s,a,r,n){var o=Qe.processText(s,a);this.textLabel=e.add.bitmapText(t,i,r,o,n),this.height=this.textLabel.getTextBounds(!0).local.height+5,this.separator=e.add.rectangle(t+10,i+this.height,t+a*n-20,4,Phaser.Display.Color.GetColor(64,64,64)).setOrigin(0,0),this.x=t,this.y=i}getHeight(){return this.y+this.height+10}getPosX(){return this.x}getPosY(){return this.y}setPosition(e,t){this.textLabel.setPosition(e,t),this.separator.setPosition(e,t+this.height)}destroy(){this.textLabel.destroy(),this.separator.destroy()}}class _t{constructor(){return _t.instance||(this.lore=[],_t.instance=this),_t.instance}static getInstance(){return _t.instance?_t.instance:new _t}rebirth(){this.lore=[]}addLore(e){this.lore.push(e)}save(){return{lore:this.lore}}load(e,t){this.lore=e.lore}}class Et extends s{constructor(e,t){super(e,t),this.labels=[],this.labelIndex=0,this.loreStore=new _t,this.labelCount=void 0}relativeX(e){return super.relativeX(e)+1e3}refresh(){this.cameras.getCamera("loreBox").scrollY=this.relativeY(0);for(var e=0;e<this.labels.length;e++)this.labels[e].destroy();this.labels=[],this.labelIndex=0;for(e=0;e<this.loreStore.lore.length;e++)this.addText(this.loreStore.lore[e],!1);this._scrollTo(this.labels.length-1)}rebirth(){this.cameras.getCamera("loreBox").scrollY=this.relativeY(0);for(var e=0;e<this.labels.length;e++)this.labels[e].destroy();this.labels=[],this.labelIndex=0}create(){this.cameras.add(super.relativeX(0),this.relativeY(30),900,670,!1,"loreBox"),this.cameras.getCamera("loreBox").scrollX=this.relativeX(0),this.cameras.getCamera("loreBox").scrollY=this.relativeY(0),this.add.rectangle(super.relativeX(0),this.relativeY(0),900,700,0).setOrigin(0).setInteractive(),this.progresion=new Ze,this.progresion.addOnUnlockHandler((e,t,i)=>{this._handleProgressionEvents(e,t,i)}),this.upButton=new bt(this,super.relativeX(20),this.relativeY(5),60,20,"up"),this.upButton.onClickHandler(()=>{this._scrollUp()}),this.downButton=new bt(this,super.relativeX(80),this.relativeY(5),60,20,"down"),this.downButton.onClickHandler(()=>{this._scrollDown()});for(var e=0;e<this.loreStore.lore.length;e++)this.addText(this.loreStore.lore[e],!1);this._scrollTo(this.labels.length-1),this.labelCount=this.add.bitmapText(super.relativeX(170),this.relativeY(5),"courier20",this.labelIndex+1+"/"+this.labels.length)}_scrollUp(){this.labelIndex>0&&(this.labelIndex-=1),this._scrollTo(this.labelIndex)}_scrollDown(){this.labelIndex<this.labels.length-1&&(this.labelIndex+=1),this._scrollTo(this.labelIndex)}_scrollTo(e){e<0||e>=this.labels.length||(this.labelIndex=e,this.cameras.getCamera("loreBox").scrollY=this.labels[this.labelIndex].getPosY()-10,void 0!==this.labelCount&&this.labelCount.setText(this.labelIndex+1+"/"+this.labels.length))}_handleProgressionEvents(e,t,i){void 0!==i&&""!==i&&this.addText(i)}addText(e,t=!0){!0===t&&this.loreStore.addLore(e);var i=this.relativeX(10),s=this.relativeY(10);0!==this.labels.length&&(i=this.labels[this.labels.length-1].getPosX(),s=this.labels[this.labels.length-1].getHeight()),this.labels.push(new Ht(this,i,s,e,85,"courier20",20)),void 0!==this.labelCount&&this.labelCount.setText(this.labelIndex+1+"/"+this.labels.length)}}class At{constructor(e,t,i,s,a){this.tech=s,this.townTier=a,this.backingRect=e.add.rectangle(t+1,i+1,648,113,Phaser.Display.Color.GetColor(0,0,0)).setOrigin(0,0),this.backingRect.isStroked=!0,this.backingRect.strokeColor=Phaser.Display.Color.GetColor(200,112,65),this.backingRect.lineWidth=1,this.nameLabel=e.add.bitmapText(t+5,i+5,"courier20",s.name+" Lv"+s.level),this.nameLabel.setTint(Phaser.Display.Color.GetColor(212,175,55));var r=Qe.processText(Bt.getTechTooltip(s,a),77);this.descLabel=e.add.bitmapText(t+5,i+25,"courier16",r);for(var n="Cost: "+lt.getTechGoldCost(s,a)+" Gold",o=lt.getTechResourceCost(s,a),h=0;h<o.length;h++)o[h]>0&&(n+=", "+Qe.getCostText(h,o[h]));n+=", Friend Level "+s.level,n=Qe.processText(n,67),this.costLabel=e.add.bitmapText(t+5,i+80,"courier16",n),-1!==s.maxLevel&&s.level>=s.maxLevel?(this.buyBtn=new bt(e,t+545,i+90,100,20,"Maxed").onClickHandler(()=>{this._onClick()}),this.buyBtn.setEnable(!1)):this.buyBtn=new bt(e,t+545,i+90,100,20,"Upgrade").onClickHandler(()=>{this._onClick()}),this.onClickHandlers=[]}registerClick(e){return this.onClickHandlers.push(e),this}_onClick(){for(var e=0;e<this.onClickHandlers.length;e++)this.onClickHandlers[e]()}destroy(){this.backingRect.destroy(),this.nameLabel.destroy(),this.descLabel.destroy(),this.costLabel.destroy(),this.buyBtn.destroy()}}class Gt extends s{constructor(e,t){super(e,t),this.showBuildings=!0}refresh(){this.changeRegion()}rebirth(){this.showBuildings=!0,this._updateStatus(),this.upgradesBtn.setVisible(!1)}changeRegion(){this.showBuildings=!0,this._updateStatus(),this.updateResearchButton()}updateResearchButton(){this.upgradesBtn.setVisible(vt.instance.getCurrentRegion().townData.researchEnabled)}create(){this.add.rectangle(this.relativeX(0),this.relativeY(0),900,700,0).setOrigin(0).setInteractive(),this.townNameLabel=this.add.bitmapText(this.relativeX(10),this.relativeY(10),"courier20","Town"),this.regionNameLabel=this.add.bitmapText(this.relativeX(10),this.relativeY(30),"courier16","Region "),this.statsLabel=this.add.bitmapText(this.relativeX(15),this.relativeY(50),"courier16",""),this.nightLabourBtn=new bt(this,this.relativeX(15),this.relativeY(50),180,20,"Turn On Night Labour").onClickHandler(()=>{this._toggleNightLabour()}),this.nightLabourBtn.setVisible(!1),this.buildingBtn=new bt(this,this.relativeX(240),this.relativeY(10),120,20,"Buildings").onClickHandler(()=>{this._showBuildings(!0)}),this.upgradesBtn=new bt(this,this.relativeX(370),this.relativeY(10),120,20,"Research").onClickHandler(()=>{this._showBuildings(!1)}),this.upgradesBtn.setVisible(vt.instance.getCurrentRegion().townData.researchEnabled),this.buildingDisplays=[],this._updateStatus(),(new vt).time.registerEvent("onDayEnd",()=>{this._endOfDay()})}_setupTechDisplay(e,t,i,s){return new At(this,e,t,i,s).registerClick(()=>{this._handleTechUpgrade(i)})}_handleTechUpgrade(e){var t=vt.instance.getCurrentRegion(),i=lt.getTechGoldCost(e,t.townData.tier),s=lt.getTechResourceCost(e,t.townData.tier),a=new ht;if(a.gold>=i&&!0===Qe.canCraft(s,a.resources[t.townData.tier-1])&&t.townData.friendshipLevel>=e.level){if(!0===ot.getInstance().spendFriendship&&e.level>0){var r=25;e.level>1&&(r=lt.calcFriendshipToLevel(e.level)-lt.calcFriendshipToLevel(e.level-1)),t.townData.spendFriendship(r)}a.addGold(-i),a.spendResource(s,t.townData.tier-1),t.townData.increaseTechLevel(e),this._updateStatus()}}_toggleNightLabour(){var e=vt.instance.getCurrentRegion();e.townData.toggleNightLabour(),!0===e.townData.nightLabourActive?this.nightLabourBtn.setText("Turn Off Night Labour"):this.nightLabourBtn.setText("Turn On Night Labour"),this._updateStatus()}_showBuildings(e){this.showBuildings=e,this._updateStatus()}_updateStatus(){for(var e=vt.instance.getCurrentRegion(),t=new ht,i=e.townData.getProductionMulti(),s=1+.04*t.getTalentLevel("governance"),a="Population: "+Math.round(e.townData.currentPopulation)+"/"+Math.floor(e.townData.getMaxPopulation())+"\nTax Income: "+Math.round(e.townData.getTownIncome())+"g/week\nT"+e.townData.tier+" Crafting Cost: "+Math.round(1e4*t.craftingCosts[e.townData.tier-1])/100+"%\nEconomy: "+Math.round(100*e.townData.economyMulti*s)+"%\nProduction: "+Math.round(100*i)+"%\nBounty Gold: "+Math.round(100*e.townData.bountyMulti)+"%\nFriendship: "+Math.floor(e.townData.friendship)+"/"+e.townData.friendshipToNext+"\nFriendship\nLevel: "+e.townData.friendshipLevel+" (+"+Math.round(100*(e.townData.getFriendshipBonus()-1))+"% Shade)\nDaily Production:\n",r=0;r<e.resourcesPerDay.length;r++)a+="  "+D[r]+": "+Math.floor(e.resourcesPerDay[r]*i*s*100)/100+"\n";if(e.alchemyDrain>0&&(a+="  Alchemy Drain: "+e.alchemyDrain+"\n  Alchemy Gain: "+Math.round(100*e.alchemyGain)/100),this.statsLabel.setText(a),this.regionNameLabel.setText("Region "+(e.regionLevel+1)),Je.getInstance().moonperks.nightlabour.level>0){var n=this.statsLabel.getTextBounds().local.height+20;this.nightLabourBtn.setPosition(this.relativeX(15),n),this.nightLabourBtn.setVisible(!0)}for(r=0;r<this.buildingDisplays.length;r++)this.buildingDisplays[r].destroy();if(!0===this.showBuildings){var o=0;for(const t in e.townData.buildings)this.buildingDisplays.push(this._setupTechDisplay(this.relativeX(240),this.relativeY(50+120*o),e.townData.buildings[t],e.townData.tier)),o+=1}else{o=0;for(const t in e.townData.upgrades)this.buildingDisplays.push(this._setupTechDisplay(this.relativeX(240),this.relativeY(50+120*o),e.townData.upgrades[t],e.townData.tier)),o+=1}}_endOfDay(){this._updateStatus()}}class Ot{constructor(e,t,i,s){var a=new Ze;this.gear=s,this.backingRect=e.add.rectangle(t+1,i+1,298,208,Phaser.Display.Color.GetColor(0,0,0)).setOrigin(0,0),this.backingRect.isStroked=!0,this.backingRect.strokeColor=Phaser.Display.Color.GetColor(255,255,255),this.backingRect.lineWidth=1;var r=s.name+" Lv"+s.level;this.nameLabel=e.add.bitmapText(t+5,i+5,r.length>18?"courier16":"courier20",r);var n=["Weapon","Armor","Trinket"],o=0===s.tier?"Broken "+n[s.slotType]:"Tier "+s.tier+" "+n[s.slotType];this.typeLabel=e.add.bitmapText(t+5,i+25,"courier16",o),this.moteButton=void 0,this.runeButton=void 0,this.moteLabel=void 0,s.level>0&&!0===a.unlocks.motes&&(s.motesFused>0&&(this.moteLabel=e.add.bitmapText(t+258,i+21,"courier16","+"+Math.floor(1e3*s.getMotePower())/10+"%").setOrigin(1,.5),this.moteLabel.setTint(Phaser.Display.Color.GetColor(200,0,200))),this.moteButton=new ft(e,t+263,i+5,32,32,{sprite:"icons",tile:39}).onClickHandler(()=>{this._onFuse()})),s.level>0&&!0===a.unlocks.runes&&(this.runeButton=new ft(e,t+263,i+40,32,32,{sprite:"runeicons",tile:0}).onClickHandler(()=>{this._onRune()})),this.statLabels=[];var h="",l=s.getStatBonuses();const c=Math.max(0,s.tier-1);for(const e in l)0!==l[e]&&(h+=Qe.getBonusText(e,l[e])+"\n");if(this.statLabels.push(e.add.bitmapText(t+5,i+45,"courier16",h)),!0===a.unlocks.resourceUI)for(var d=new ht,u=s.tier<=0?1:d.craftingCosts[s.tier-1],g=0,p=0;p<s.costs.length;p++)if(0!==s.costs[p]){h=Qe.getCostText(p,Math.floor(s.costs[p]*u));var m=d.resources[c][p]>=s.costs[p]*u?Phaser.Display.Color.GetColor(255,255,255):Phaser.Display.Color.GetColor(255,80,80),y=e.add.bitmapText(t+148,i+45+17*g,"courier16",h);y.setTint(m),this.statLabels.push(y),g++}this.equipBtn=void 0,this.upgradeBtn=void 0,0===s.level?(this.upgradeBtn=new bt(e,t+79,i+185,142,20,"Forge"),this.upgradeBtn.onClickHandler(()=>{this._onUpgrade()})):!0===a.unlocks.resourceUI?(this.equipBtn=new bt(e,t+5,i+185,142,20,"Equip"),this.equipBtn.onClickHandler(()=>{this._onEquip()}),this.upgradeBtn=new bt(e,t+153,i+185,142,20,"Upgrade"),this.upgradeBtn.onClickHandler(()=>{this._onUpgrade()})):(this.equipBtn=new bt(e,t+79,i+185,142,20,"Equip"),this.equipBtn.onClickHandler(()=>{this._onEquip()})),this.onEquipHandlers=[],this.onUpgradeHandlers=[],this.onFuseHandlers=[],this.onRuneHandlers=[]}registerEvents(e,t){return"onEquip"===e?this.onEquipHandlers.push(t):"onUpgrade"===e?this.onUpgradeHandlers.push(t):"onFuse"===e?this.onFuseHandlers.push(t):"onRune"===e&&this.onRuneHandlers.push(t),this}_onEquip(){for(var e=0;e<this.onEquipHandlers.length;e++)this.onEquipHandlers[e](this.gear)}_onUpgrade(){for(var e=0;e<this.onUpgradeHandlers.length;e++)this.onUpgradeHandlers[e](this.gear)}_onFuse(){for(var e=0;e<this.onFuseHandlers.length;e++)this.onFuseHandlers[e](this.gear)}_onRune(){for(var e=0;e<this.onRuneHandlers.length;e++)this.onRuneHandlers[e](this.gear)}destroy(){this.backingRect.destroy(),this.nameLabel.destroy(),this.typeLabel.destroy();for(var e=0;e<this.statLabels.length;e++)this.statLabels[e].destroy();void 0!==this.equipBtn&&this.equipBtn.destroy(),void 0!==this.upgradeBtn&&this.upgradeBtn.destroy(),void 0!==this.moteLabel&&this.moteLabel.destroy(),void 0!==this.moteButton&&this.moteButton.destroy(),void 0!==this.runeButton&&this.runeButton.destroy()}}class Ut{constructor(e,t,i,s){if(void 0===s)this.nameLabel=e.add.bitmapText(t+5,i+5,"courier20","Nothing"),this.typeLabel=e.add.bitmapText(t+5,i+25,"courier16",""),this.statLabel=e.add.bitmapText(t+5,i+45,"courier16","");else{this.nameLabel=e.add.bitmapText(t+5,i+5,"courier20",s.name+" Lv"+s.level);this.typeLabel=e.add.bitmapText(t+5,i+25,"courier16","Tier "+s.tier+" "+["Weapon","Armor","Trinket"][s.slotType]);var a="",r=s.getStatBonuses();for(const e in r)a+=Qe.getBonusText(e,r[e])+"\n";this.statLabel=e.add.bitmapText(t+5,i+45,"courier16",a)}}getTextBounds(){return 30+this.statLabel.getTextBounds(!0).local.height}destroy(){this.nameLabel.destroy(),this.typeLabel.destroy(),this.statLabel.destroy()}}class Ft{constructor(e,t,i,s){this.selectedRune=-1,this.gear=s,this.scene=e,this.x=t,this.y=i,this.backRect=e.add.rectangle(t,i,700,500,Phaser.Display.Color.GetColor(0,0,0)).setInteractive().setOrigin(0,0),this.backRect.isStroked=!0,this.backRect.strokeColor=Phaser.Display.Color.GetColor(128,128,128),this.backRect.lineWidth=2,this.separator=e.add.rectangle(t+250,i,2,500,Phaser.Display.Color.GetColor(128,128,128)).setOrigin(0,0),this.socketTitle=e.add.bitmapText(t+5,i+5,"courier20","SOCKETS").setOrigin(0,0),this.runeTitle=e.add.bitmapText(t+260,i+5,"courier20","RUNES").setOrigin(0,0),this.cancelBtn=new bt(this.scene,this.x+575,this.y+475,120,20,"Cancel"),this.gearRuneImages=[],this.runeBonuses=[],this.runeInventory=[],this._setupViews()}_setupViews(){for(var e=0;e<this.gearRuneImages.length;e++)this.gearRuneImages[e].destroy();for(e=0;e<this.runeBonuses.length;e++)this.runeBonuses[e].destroy();for(e=0;e<this.runeInventory.length;e++)this.runeInventory[e].destroy();void 0!==this.floatingText&&this.floatingText.destroy(),this.gearRuneImages=[],this.runeBonuses=[],this.runeInventory=[];for(e=0;e<this.gear.runes.length;e++){var t=this.x+7+36*e,i=this.y+27+e%2*36;this.gearRuneImages.push(this._setupRuneSocket(this.scene,this.gear.runes[e],t,i,e))}var s=this.y+140;for(e=0;e<this.gear.compiledRunes.length;e++){var a=this.scene.add.bitmapText(this.x+15,s,"courier20",this.gear.compiledRunes[e].word+" Lv"+this.gear.compiledRunes[e].level);a.setTint(Phaser.Display.Color.GetColor(200,0,200)),this.runeBonuses.push(a);var r="";for(const t in this.gear.compiledRunes[e].bonus)r+=Bt.getRuneBonusText(t,this.gear.compiledRunes[e].bonus[t])+"\n";a=this.scene.add.bitmapText(this.x+15,s+20,"courier16",r),this.runeBonuses.push(a),s+=20+a.getTextBounds(!0).local.height+10}var n=ht.getInstance();for(e=0;e<n.runes.length;e++){t=this.x+258+e%8*55,i=this.y+30+55*Math.floor(e/8);this.runeInventory.push(this._setupRuneInventory(this.scene,n.runes[e],t,i,e))}}_slotRune(e){-1!==this.selectedRune&&(ht.getInstance().unequip(this.gear.slotType),this.gear.addRune(ht.getInstance().runes[this.selectedRune],e),ht.getInstance().removeRune(this.selectedRune),ht.getInstance().equip(this.gear),this._setupViews(),this.selectedRune=-1)}_selectRune(e){-1!==this.selectedRune&&this.runeInventory[this.selectedRune].setBorderTint(Phaser.Display.Color.GetColor(255,255,255)),this.selectedRune=e,this.runeInventory[this.selectedRune].setBorderTint(Phaser.Display.Color.GetColor(0,255,0))}_setupRuneSocket(e,t,i,s,a){var r=at.getBonusForRune(t),n=t.word+" Lv"+t.level+"\n";for(const e in r)n+=Bt.getRuneBonusText(e,r[e])+"\n";var o=new ft(e,i,s,48,48,at.getRuneTexture(t.word));return o.onClickHandler(()=>{this._slotRune(a)}),"Empty"!=t.word&&o.onPointerOverHandler(()=>{this._showTooltip(e,n,i,s)}).onPointerOutHandler(()=>{this._removeTooltip()}),o.removeBackground(),o}_setupRuneInventory(e,t,i,s,a){var r=at.getBonusForRune(t),n=t.word+" Lv"+t.level+"\n";for(const e in r)n+=Bt.getRuneBonusText(e,r[e])+"\n";var o=new ft(e,i,s,48,48,at.getRuneTexture(t.word));return o.onClickHandler(()=>{this._selectRune(a)}).onPointerOverHandler(()=>{this._showTooltip(e,n,i,s)}).onPointerOutHandler(()=>{this._removeTooltip()}),o}_showTooltip(e,t,i,s){void 0!==this.floatingText&&this.floatingText.destroy();var r=i+(i+200>1100?-152:0),n=s+(s-60<100?50:-62);this.floatingText=new a(e,t,r,n,200,60,"courier16",16)}_removeTooltip(){this.floatingText.destroy(),this.floatingText=void 0}onCancelHandler(e){return this.cancelBtn.onClickHandler(()=>{e()}),this}destroy(){this.backRect.destroy(),this.separator.destroy(),this.socketTitle.destroy(),this.runeTitle.destroy(),this.cancelBtn.destroy();for(var e=0;e<this.gearRuneImages.length;e++)this.gearRuneImages[e].destroy();for(e=0;e<this.runeBonuses.length;e++)this.runeBonuses[e].destroy();for(e=0;e<this.runeInventory.length;e++)this.runeInventory[e].destroy();void 0!==this.floatingText&&this.floatingText.destroy()}}class Wt{constructor(e,t,i){this.selectedRune=-1,this.scene=e,this.x=t,this.y=i,this.backRect=e.add.rectangle(t,i,700,500,Phaser.Display.Color.GetColor(0,0,0)).setInteractive().setOrigin(0,0),this.backRect.isStroked=!0,this.backRect.strokeColor=Phaser.Display.Color.GetColor(128,128,128),this.backRect.lineWidth=2,this.separator=e.add.rectangle(t+250,i,2,500,Phaser.Display.Color.GetColor(128,128,128)).setOrigin(0,0),this.upgradeTitle=e.add.bitmapText(t+5,i+5,"courier20","UPGRADE").setOrigin(0,0),this.runeTitle=e.add.bitmapText(t+260,i+5,"courier20","RUNES").setOrigin(0,0),this.runeInventory=[],this.upgradeRune=this.scene.add.image(t+125,i+50,"runeicons",0).setOrigin(.5),this.upgradeRune.displayWidth=48,this.upgradeRune.displayHeight=48,this.runeText=[],this.upgradeBtn=new bt(this.scene,this.x+20,this.y+315,120,20,"Upgrade"),this.upgradeBtn.onClickHandler(()=>{this._upgradeRune()}),this.rerollBtn=new bt(this.scene,this.x+20,this.y+390,120,20,"Reroll"),this.rerollBtn.onClickHandler(()=>{this._rerollRune()}),this.shatterBtn=new bt(this.scene,this.x+20,this.y+465,120,20,"Shatter"),this.shatterBtn.onClickHandler(()=>{this._shatterRune()}),this.upgradeTxt=this.scene.add.bitmapText(this.x+125,this.y+275,"courier16","Empower this rune with\nMotes of Darkness").setOrigin(.5,0),this.upgradeTxt.setCenterAlign(),this.rerollTxt=this.scene.add.bitmapText(this.x+125,this.y+345,"courier16","Use Motes to Reforge this\nRune into a different Rune.").setOrigin(.5,0),this.rerollTxt.setCenterAlign(),this.shatterTxt=this.scene.add.bitmapText(this.x+125,this.y+420,"courier16","Shatter this rune for\nMotes of Darkness.").setOrigin(.5,0),this.shatterTxt.setCenterAlign(),this.upgradeCost=this.scene.add.bitmapText(this.x+205,this.y+316,"courier16","").setOrigin(1,0),this.rerollCost=this.scene.add.bitmapText(this.x+205,this.y+391,"courier16","").setOrigin(1,0),this.shatterCost=this.scene.add.bitmapText(this.x+205,this.y+466,"courier16","").setOrigin(1,0),this.upgradeIcon=this.scene.add.image(t+220,i+325,"icons",39),this.upgradeIcon.displayWidth=20,this.upgradeIcon.displayHeight=20,this.rerollIcon=this.scene.add.image(t+220,i+400,"icons",39),this.rerollIcon.displayWidth=20,this.rerollIcon.displayHeight=20,this.shatterIcon=this.scene.add.image(t+220,i+475,"icons",39),this.shatterIcon.displayWidth=20,this.shatterIcon.displayHeight=20,this.upgradeUI=[this.upgradeTxt,this.upgradeBtn,this.rerollTxt,this.rerollBtn,this.upgradeCost,this.rerollCost,this.upgradeIcon,this.rerollIcon,this.shatterTxt,this.shatterBtn,this.shatterCost,this.shatterIcon],this.cancelBtn=new bt(this.scene,this.x+575,this.y+475,120,20,"Cancel"),this._setupViews();for(var s=0;s<this.upgradeUI.length;s++)this.upgradeUI[s].setVisible(!1)}_setupViews(){for(var e=0;e<this.runeInventory.length;e++)this.runeInventory[e].destroy();void 0!==this.floatingText&&this.floatingText.destroy(),this.runeInventory=[];var t=ht.getInstance();for(e=0;e<t.runes.length;e++){var i=this.x+258+e%8*55,s=this.y+30+55*Math.floor(e/8);this.runeInventory.push(this._setupRuneInventory(this.scene,t.runes[e],i,s,e))}if(-1!==this.selectedRune)this._selectRune(this.selectedRune);else{for(e=0;e<this.runeText.length;e++)this.runeText[e].destroy();this.runeText=[],this.upgradeRune.destroy(),this.upgradeRune=this.scene.add.image(this.x+125,this.y+50,"runeicons",0).setOrigin(.5),this.upgradeRune.displayWidth=48,this.upgradeRune.displayHeight=48}}_selectRune(e){for(var t=0;t<this.runeText.length;t++)this.runeText[t].destroy();this.runeText=[],-1!==this.selectedRune&&this.runeInventory[this.selectedRune].setBorderTint(Phaser.Display.Color.GetColor(255,255,255)),this.selectedRune=e,this.runeInventory[this.selectedRune].setBorderTint(Phaser.Display.Color.GetColor(0,255,0));var i=ht.getInstance().runes[this.selectedRune],s=at.getRuneTexture(i.word);this.upgradeRune.destroy(),this.upgradeRune=this.scene.add.image(this.x+125,this.y+50,s.sprite,s.tile).setOrigin(.5),this.upgradeRune.displayWidth=48,this.upgradeRune.displayHeight=48;var a=at.getBonusForRune(i);this.runeText.push(this.scene.add.bitmapText(this.x+15,this.y+100,"courier20",i.word+" Lv"+i.level)),this.runeText[this.runeText.length-1].setTint(Phaser.Display.Color.GetColor(200,0,200));var r=i.word+" Lv"+i.level+"\n";for(const e in a)r+=Bt.getRuneBonusText(e,a[e])+"\n";this.runeText.push(this.scene.add.bitmapText(this.x+20,this.y+120,"courier16",r));var n=at.getUpgradeCost(i);this.upgradeCost.setText(Qe.numberString(n)),this.rerollCost.setText(Qe.numberString(Math.floor(n/2))),this.shatterCost.setText(Qe.numberString(at.getSellCost(i)));for(t=0;t<this.upgradeUI.length;t++)this.upgradeUI[t].setVisible(!0)}_upgradeRune(){var e=ht.getInstance().runes[this.selectedRune],t=Math.floor(at.getUpgradeCost(e));ht.getInstance().motes>=t&&(ht.getInstance().addMote(-t),ht.getInstance().runes[this.selectedRune].level+=1,this._setupViews())}_rerollRune(){var e=ht.getInstance().runes[this.selectedRune],t=Math.floor(at.getUpgradeCost(e)/2);if(ht.getInstance().motes>=t){ht.getInstance().addMote(-t);var i=at.getRandomRuneAtLevel(e.level);ht.getInstance().runes[this.selectedRune]=i,this._setupViews()}}_shatterRune(){var e=ht.getInstance().runes[this.selectedRune],t=at.getSellCost(e);ht.getInstance().removeRune(this.selectedRune),ht.getInstance().addMote(t),this.selectedRune=-1,this._setupViews();for(var i=0;i<this.upgradeUI.length;i++)this.upgradeUI[i].setVisible(!1)}_setupRuneInventory(e,t,i,s,a){var r=at.getBonusForRune(t),n=t.word+" Lv"+t.level+"\n";for(const e in r)n+=Bt.getRuneBonusText(e,r[e])+"\n";var o=new ft(e,i,s,48,48,at.getRuneTexture(t.word));return o.onClickHandler(()=>{this._selectRune(a)}).onPointerOverHandler(()=>{this._showTooltip(e,n,i,s)}).onPointerOutHandler(()=>{this._removeTooltip()}),o}_showTooltip(e,t,i,s){void 0!==this.floatingText&&this.floatingText.destroy();var r=i+(i+200>1100?-152:0),n=s+(s-60<100?50:-62);this.floatingText=new a(e,t,r,n,200,60,"courier16",16)}_removeTooltip(){this.floatingText.destroy(),this.floatingText=void 0}onCancelHandler(e){return this.cancelBtn.onClickHandler(()=>{e()}),this}destroy(){this.backRect.destroy(),this.separator.destroy(),this.upgradeTitle.destroy(),this.runeTitle.destroy(),this.cancelBtn.destroy(),this.upgradeRune.destroy();for(var e=0;e<this.runeInventory.length;e++)this.runeInventory[e].destroy();void 0!==this.floatingText&&this.floatingText.destroy();for(e=0;e<this.runeText.length;e++)this.runeText[e].destroy();for(e=0;e<this.upgradeUI.length;e++)this.upgradeUI[e].destroy()}}class Yt extends s{constructor(e,t){super(e,t),this.player=new ht,this.page=0,this.gearList=[],this.craftDisplays=[],this.gearDisplays=[],this.progression=new Ze,vt.getInstance().time.registerEvent("onDayEnd",()=>{this._setupView()})}create(){this.add.rectangle(this.relativeX(0),this.relativeY(0),900,700,0).setOrigin(0).setInteractive(),this.runeBtn=new ft(this,this.relativeX(250),this.relativeY(10),32,32,{sprite:"runeicons",tile:0}),this.runeBtn.onClickHandler(()=>{this._onRuneUpgradeHandler()}),this.runeBtn.setVisible(Ze.getInstance().unlocks.runes),this.allBtn=new bt(this,this.relativeX(290),this.relativeY(10),50,20,"All"),this.allBtn.onClickHandler(()=>{this._changeFilter(-1)}),this.tier0Btn=new bt(this,this.relativeX(340),this.relativeY(10),80,20,"Broken"),this.tier0Btn.onClickHandler(()=>{this._changeFilter(0)}),this.tier1Btn=new bt(this,this.relativeX(420),this.relativeY(10),30,20,"T1"),this.tier1Btn.onClickHandler(()=>{this._changeFilter(1)}),this.tier2Btn=new bt(this,this.relativeX(450),this.relativeY(10),30,20,"T2"),this.tier2Btn.onClickHandler(()=>{this._changeFilter(2)}),this.tier3Btn=new bt(this,this.relativeX(480),this.relativeY(10),30,20,"T3"),this.tier3Btn.onClickHandler(()=>{this._changeFilter(3)}),this.tier4Btn=new bt(this,this.relativeX(510),this.relativeY(10),30,20,"T4"),this.tier4Btn.onClickHandler(()=>{this._changeFilter(4)}),this.tier5Btn=new bt(this,this.relativeX(540),this.relativeY(10),30,20,"T5"),this.tier5Btn.onClickHandler(()=>{this._changeFilter(5)}),this.tier6Btn=new bt(this,this.relativeX(570),this.relativeY(10),30,20,"T6"),this.tier6Btn.onClickHandler(()=>{this._changeFilter(6)}),this.tier7Btn=new bt(this,this.relativeX(600),this.relativeY(10),30,20,"T7"),this.tier7Btn.onClickHandler(()=>{this._changeFilter(7)}),this.tier8Btn=new bt(this,this.relativeX(630),this.relativeY(10),30,20,"T8"),this.tier8Btn.onClickHandler(()=>{this._changeFilter(8)}),this.prevPageBtn=new bt(this,this.relativeX(850),this.relativeY(10),20,20,"<").onClickHandler(()=>{this._prevPage()}),this.nextPageBtn=new bt(this,this.relativeX(870),this.relativeY(10),20,20,">").onClickHandler(()=>{this._nextPage()}),this.craftingCostLabel=this.add.bitmapText(this.relativeX(10),this.relativeY(10),"courier16","Crafting Cost: 100%"),this.weaponLabel=this.add.bitmapText(this.relativeX(0),this.relativeY(0),"courier20","Weapon"),this.armorLabel=this.add.bitmapText(this.relativeX(0),this.relativeY(0),"courier20","Armor"),this.trinketLabel=this.add.bitmapText(this.relativeX(0),this.relativeY(0),"courier20","Trinket"),this._updateTierButtons(),this._setupGearDisplays(),this._changeFilter(-1),(new Ze).addOnUnlockHandler((e,t,i)=>{this._handleProgressionEvents(e,t,i)})}_handleProgressionEvents(e,t,i){switch(e){case d:case u:case b:this._updateTierButtons(),this._setupView(),this.runeBtn.setVisible(Ze.getInstance().unlocks.runes)}}_updateTierButtons(){var e=new nt;this.tier1Btn.setVisible(e.tiersAvailable>=1),this.tier2Btn.setVisible(e.tiersAvailable>=2),this.tier3Btn.setVisible(e.tiersAvailable>=3),this.tier4Btn.setVisible(e.tiersAvailable>=4),this.tier5Btn.setVisible(e.tiersAvailable>=5),this.tier6Btn.setVisible(e.tiersAvailable>=6),this.tier7Btn.setVisible(e.tiersAvailable>=7),this.tier8Btn.setVisible(e.tiersAvailable>=8)}_nextPage(){6*this.page+6<this.gearList.length&&(this.page+=1),this._setupView()}_prevPage(){this.page>0&&(this.page-=1),this._setupView()}_changeFilter(e){-1===e?this.craftingCostLabel.setText("Crafting Cost: N/A"):0===e?this.craftingCostLabel.setText("Crafting Cost: 100%"):this.craftingCostLabel.setText("Crafting Cost: "+Math.round(1e4*this.player.craftingCosts[e-1])/100+"%");var t=new nt;this.gearList=[],this.page=0;for(var i=0;i<t.gear.length;i++)(-1===e||e===t.gear[i].tier)&&t.gear[i].tier<=t.tiersAvailable&&this.gearList.push(t.gear[i]);this._setupView()}_isEquipedItem(e){switch(e.slotType){case S:return void 0!==this.player.weapon&&e.name===this.player.weapon.name;case H:return void 0!==this.player.armor&&e.name===this.player.armor.name;case _:return void 0!==this.player.trinket&&e.name===this.player.trinket.name}}_setupGearDisplays(){for(var e=0;e<this.gearDisplays.length;e++)this.gearDisplays[e].destroy();this.gearDisplays=[],this.weaponLabel.setPosition(this.relativeX(10),this.relativeY(30));var t=35+this.weaponLabel.getTextBounds(!0).local.height;this.gearDisplays.push(new Ut(this,this.relativeX(20),this.relativeY(t),this.player.weapon)),t+=20+this.gearDisplays[0].getTextBounds(),this.armorLabel.setPosition(this.relativeX(10),this.relativeY(t)),t+=this.armorLabel.getTextBounds(!0).local.height,this.gearDisplays.push(new Ut(this,this.relativeX(20),this.relativeY(t),this.player.armor)),t+=20+this.gearDisplays[1].getTextBounds(),this.trinketLabel.setPosition(this.relativeX(10),this.relativeY(t)),t+=this.trinketLabel.getTextBounds(!0).local.height,this.gearDisplays.push(new Ut(this,this.relativeX(20),this.relativeY(t),this.player.trinket))}_onEquipHandler(e){this.player.equip(e),this._setupView(),this._setupGearDisplays()}_onUpgradeHandler(e){nt.getInstance().upgradeGear(e),this._setupGearDisplays(),this._setupView()}_onFuseHandler(e){var t=Math.min(this.player.motes,this.scene.get("DarkWorld").buyAmount);nt.getInstance().fuseGear(e,t),this._setupView(),this._setupGearDisplays()}_onRuneHandler(e){this._closeRuneWindow(),this.runeWindow=new Ft(this,350,150,e),this.runeWindow.onCancelHandler(()=>{this._closeRuneWindow()})}_onRuneUpgradeHandler(e){this._closeRuneWindow(),this.runeWindow=new Wt(this,350,150,e),this.runeWindow.onCancelHandler(()=>{this._closeRuneWindow()})}_closeRuneWindow(){void 0!==this.runeWindow&&(this.runeWindow.destroy(),this.runeWindow=void 0)}_setupView(){for(var e=0;e<this.craftDisplays.length;e++)this.craftDisplays[e].destroy();this.craftDisplays=[];for(e=6*this.page;e<Math.min(this.gearList.length,6*this.page+6);e++){var t=this.relativeX(290+e%2*305),i=this.relativeY(40+215*Math.floor((e-6*this.page)/2));this.craftDisplays.push(new Ot(this,t,i,this.gearList[e]).registerEvents("onEquip",e=>{this._onEquipHandler(e)}).registerEvents("onUpgrade",e=>{this._onUpgradeHandler(e)}).registerEvents("onFuse",e=>{this._onFuseHandler(e)}).registerEvents("onRune",e=>{this._onRuneHandler(e)}))}}refresh(e=!0){this._updateTierButtons(),this._setupGearDisplays(),e&&this._changeFilter(-1)}rebirth(){this._updateTierButtons(),this._setupGearDisplays(),this._changeFilter(-1)}update(e,t){!1===this.progression.unlocks.exploreTab&&void 0!==this.player.weapon&&void 0!==this.player.armor&&void 0!==this.player.trinket&&this.progression.registerFeatureUnlocked(o,"Now that you're all equipped it's time to explore. It's not like\nstaying here is going to do you any good.\n")}}class Nt extends s{constructor(e,t){super(e,t)}refresh(){this.rebirth()}rebirth(){this.talentLabel.setText("Talent Points\n"+this.player.talentPoints);for(var e=[[264,288],[312,240],[360,216],[408,192],[456,216],[504,240],[552,288],[216,240],[264,192],[336,144],[408,120],[480,144],[552,192],[600,240],[168,192],[240,120],[312,72],[408,48],[504,72],[576,120],[648,192],[408,312],[480,384],[336,384],[408,456],[336,312],[480,312],[480,456],[336,456]],t=0;t<this.talentButtons.length;t++)this.talentButtons[t].destroy();this.talentButtons=[];var i=0;for(const t in this.player.talents){var s=this.relativeX(e[i][0]+18),a=this.relativeY(e[i][1]+20);this._setupTalentButton(t,s,a,i),i++}}create(){this.add.rectangle(this.relativeX(0),this.relativeY(0),900,700,0).setOrigin(0).setInteractive(),this.floatingText=void 0,this.talentLabel=this.add.bitmapText(this.relativeX(450),this.relativeY(25),"courier20","Talent Points\n0",20,1).setOrigin(.5),this.player=new ht,this.talentButtons=[],this._refreshView(),this.player.registerEvent("onTalentChanged",()=>{this._onTalentChanged()})}_refreshView(){for(var e=[[264,288],[312,240],[360,216],[408,192],[456,216],[504,240],[552,288],[216,240],[264,192],[336,144],[408,120],[480,144],[552,192],[600,240],[168,192],[240,120],[312,72],[408,48],[504,72],[576,120],[648,192],[408,312],[480,384],[336,384],[408,456],[336,312],[480,312],[480,456],[336,456]],t=0;t<this.talentButtons.length;t++)this.talentButtons[t].destroy();this._disableTooltip(),this.talentButtons=[];var i=0;for(const t in this.player.talents){var s=this.relativeX(e[i][0]+18),a=this.relativeY(e[i][1]+20);this._setupTalentButton(t,s,a,i),i++}}_setupTalentButton(e,t,i,s){this.talentButtons.push(new ft(this,t,i,48,48,this.player.talents[e].texture).onClickHandler(()=>{this._levelUpTalent(this.player.talents[e]),this._disableTooltip(),this._setTooltip(e,t,i),this._refreshView()}).onPointerOverHandler(()=>{this._setTooltip(e,t,i)}).onPointerOutHandler(()=>{this._disableTooltip()})),this._updateTalentButton(this.player.talents[e],s)}_updateTalentButton(e,t){e.level>=e.maxLevel&&-1!==e.maxLevel?this.talentButtons[t].setBorderTint(Phaser.Display.Color.GetColor(0,220,0)):e.level>0?this.talentButtons[t].setBorderTint(Phaser.Display.Color.GetColor(212,175,55)):!1===this._haveTalentRequirements(e)?this.talentButtons[t].setTint(Phaser.Display.Color.GetColor(32,32,32)):this.talentButtons[t].clearTint()}_onTalentChanged(){this.talentLabel.setText("Talent Points\n"+this.player.talentPoints)}_haveTalentRequirements(e){for(var t=0;t<e.requires.length;t++)if(0===this.player.talents[e.requires[t]].level)return!1;return!0}_levelUpTalent(e){this.player.talentPoints<=0||!1===this._haveTalentRequirements(e)||this.player.levelTalent(e)}_setTooltip(e,t,i){var s=this.player.talents[e];void 0!==this.FloatingTooltip&&this._disableTooltip();var r="";if(r=-1!==s.maxLevel?s.name+" Lv"+this.player.getTalentLevel(e)+"/"+s.maxLevel+"\n"+Bt.getTalentTooltip(s,this.player.getTalentLevel(e))+"\n\n":s.name+" Lv"+this.player.getTalentLevel(e)+"\n"+Bt.getTalentTooltip(s,this.player.getTalentLevel(e))+"\n\n",s.requires.length>0){r+="Requires: ";for(var n=0;n<s.requires.length;n++)r+=this.player.talents[s.requires[n]].name+(n<s.requires.length-1?", ":"")}r=Qe.processText(r,53),this.floatingText=new a(this,r,t+(t+450>1100?-450:0),i+(i>300?-150:50),450,150,"courier16",16)}_disableTooltip(){void 0!==this.floatingText&&(this.floatingText.destroy(),this.floatingText=void 0)}}class Vt{constructor(e,t,i){this.backingRect=e.add.rectangle(t,i,800,600,Phaser.Display.Color.GetColor(0,0,0)).setOrigin(0,0).setInteractive(),this.backingRect.isStroked=!0,this.backingRect.strokeColor=Phaser.Display.Color.GetColor(255,255,255),this.backingRect.lineWidth=4,this.title=e.add.bitmapText(t+400,i+5,"courier20","CHALLENGES").setOrigin(.5,0),this.challengeBtns=[];var s=0;for(const a in Je.instance.challenges)this.challengeBtns.push(this._setupChallengeButton(e,Je.instance.challenges[a],t+10,i+30+25*s)),s+=1;this.challengeBox=e.add.bitmapText(t+220,i+30,"courier20",""),this.acceptBtn=new bt(e,t+275,i+550,120,20,"Accept"),this.acceptBtn.setEnable(!1),this.cancelBtn=new bt(e,t+405,i+550,120,20,"Cancel"),this.selectedChallenge=void 0}onAcceptHandler(e){return this.acceptBtn.onClickHandler(()=>{e(this.selectedChallenge)}),this}onCancelHandler(e){return this.cancelBtn.onClickHandler(()=>{e()}),this}_setupChallengeButton(e,t,i,s){var a=new bt(e,i,s,190,20,t.unlocked?t.name:"Locked").onClickHandler(()=>{this._challengeClickHandler(t)});return a.setEnable(t.unlocked),a}_challengeClickHandler(e){this.challengeBox.setText(Qe.processText(Bt.getChallengeDescription(e),57)),this.selectedChallenge=e,this.acceptBtn.setEnable(!0)}destroy(){this.backingRect.destroy(),this.title.destroy(),this.acceptBtn.destroy(),this.cancelBtn.destroy(),this.challengeBox.destroy();for(var e=0;e<this.challengeBtns.length;e++)this.challengeBtns[e].destroy()}}class qt{constructor(e,t,i){this.backingRect=e.add.rectangle(t,i,700,500,Phaser.Display.Color.GetColor(0,0,0)).setOrigin(0,0).setInteractive(),this.backingRect.isStroked=!0,this.backingRect.strokeColor=Phaser.Display.Color.GetColor(255,255,255),this.backingRect.lineWidth=4,this.title=e.add.bitmapText(t+350,i+5,"courier20",ot.getInstance().challengeName).setOrigin(.5,0);var s=vt.getInstance().time.time-vt.getInstance().timeAtRunStart,a=Bt.getChallengeDescription(Je.getInstance().getChallengeFromName(ot.getInstance().challengeName));a+="\nCurrent Run Time: "+new yt(s).getTimespanText()+"\n\nYou may abandon this challenge, causing you to gate immediately. You will not get any Moonlight for this run if you abandon.",this.desc=e.add.bitmapText(t+10,i+30,"courier20",Qe.processText(a,70)).setOrigin(0),this.abandonBtn=new bt(e,t+225,i+450,120,20,"Abandon"),this.cancelBtn=new bt(e,t+355,i+450,120,20,"Cancel")}onAbandonHandler(e){return this.abandonBtn.onClickHandler(()=>{e()}),this}onCancelHandler(e){return this.cancelBtn.onClickHandler(()=>{e()}),this}destroy(){this.backingRect.destroy(),this.title.destroy(),this.abandonBtn.destroy(),this.cancelBtn.destroy(),this.desc.destroy()}}class Xt extends s{constructor(e,t){super(e,t),this.canLevelPerks=!1}create(){this.add.rectangle(this.relativeX(0),this.relativeY(0),1100,800,0).setOrigin(0).setInteractive(),this.floatingText=void 0,this.moonlightLabel=this.add.bitmapText(this.relativeX(550),this.relativeY(400),"courier20","MOONLIGHT\n"+Qe.numberString(Math.round(Je.getInstance().moonlight)),20,1).setOrigin(.5),this.moonlightLabel.setTint(Phaser.Display.Color.GetColor(206,238,240));var e=[[648,480],[672,408],[624,312],[552,240],[456,192],[360,144],[264,120],[168,144],[144,216],[192,312],[264,384],[360,432],[456,480],[552,504],[528,576],[312,504],[120,360],[120,72],[72,240],[672,552],[744,432],[696,288],[624,192],[528,120],[408,72],[264,48],[24,384],[192,456],[216,552],[480,648],[408,552],[336,624],[-24,240],[96,504],[672,624],[816,480],[792,288],[720,168],[624,72],[480,0],[288,-24],[120,0]];this.moonlight=new Je,this.moonlightButtons=[];var t=0;for(const a in this.moonlight.moonperks){var i=this.relativeX(e[t][0]+118),s=this.relativeY(e[t][1]+56);this._setupMoonlightButton(this.moonlight.moonperks[a],i,s,t),t++}this.exitButton=new bt(this,this.relativeX(950),this.relativeY(730),120,40,"BACK").onClickHandler(()=>{if(!0===this.canLevelPerks){this.exitButton.setText("BACK");var e=this.scene.get("DarkWorld");this.canLevelPerks=!1,e.rebirth()}else this.scene.sendToBack()}),this.challengeBox=void 0,this.challengeBtn=new bt(this,970,12,120,30,"Challenges").onClickHandler(()=>{this._setupChallengeWindow()}),this.challengePointIcon=new Rt(this,20,20,16,16,{sprite:"moonicons",tile:7},"Challenge Points earned from completing challenges. Each point increases your core stats by an additional 1%."),this.challengePointLabel=this.add.bitmapText(40,20,"courier20",Je.instance.challengePoints+""),this.challengeBtn.setVisible(Ze.getInstance().persistentUnlocks.challenges),this.challengePointIcon.setVisible(Ze.getInstance().persistentUnlocks.challenges),this.challengePointLabel.setVisible(Ze.getInstance().persistentUnlocks.challenges)}refresh(){var e=[[648,480],[672,408],[624,312],[552,240],[456,192],[360,144],[264,120],[168,144],[144,216],[192,312],[264,384],[360,432],[456,480],[552,504],[528,576],[312,504],[120,360],[120,72],[72,240],[672,552],[744,432],[696,288],[624,192],[528,120],[408,72],[264,48],[24,384],[192,456],[216,552],[480,648],[408,552],[336,624],[-24,240],[96,504],[672,624],[816,480],[792,288],[720,168],[624,72],[480,0],[288,-24],[120,0]];this.moonlight=new Je;for(var t=0;t<this.moonlightButtons.length;t++)this.moonlightButtons[t].destroy();this.moonlightButtons=[];var i=0;for(const t in this.moonlight.moonperks){var s=this.relativeX(e[i][0]+118),a=this.relativeY(e[i][1]+56);this._setupMoonlightButton(this.moonlight.moonperks[t],s,a,i),i++}this.challengeBtn.setVisible(Ze.getInstance().persistentUnlocks.challenges),this.challengePointIcon.setVisible(Ze.getInstance().persistentUnlocks.challenges),this.challengePointLabel.setText(Je.getInstance().challengePoints+""),this.challengePointLabel.setVisible(Ze.getInstance().persistentUnlocks.challenges),this._onMoonlightChanged(),this._disableTooltip()}enableLeveling(){this.canLevelPerks=!0,this.exitButton.setText("REBIRTH"),this.challengeBtn.setVisible(Ze.getInstance().persistentUnlocks.challenges),this.challengePointIcon.setVisible(Ze.getInstance().persistentUnlocks.challenges),this.challengePointLabel.setText(Je.getInstance().challengePoints+""),this.challengePointLabel.setVisible(Ze.getInstance().persistentUnlocks.challenges)}_setupChallengeWindow(){void 0!==this.challengeBox&&(this.challengeBox.destroy(),this.challengeBox=void 0),""!==ot.getInstance().challengeName?this.challengeBox=new qt(this,200,150).onAbandonHandler(()=>{this._abandonChallenge()}).onCancelHandler(()=>{this._removeChallengeWindow()}):this.challengeBox=new Vt(this,150,100).onAcceptHandler(e=>{this._beginChallenge(e)}).onCancelHandler(()=>{this._removeChallengeWindow()})}_removeChallengeWindow(){void 0!==this.challengeBox&&(this.challengeBox.destroy(),this.challengeBox=void 0)}_beginChallenge(e){if(!0===this.canLevelPerks){ot.getInstance().setupChallenge(e);var t=this.scene.get("DarkWorld");this.canLevelPerks=!1,t.rebirth()}void 0!==this.challengeBox&&(this.challengeBox.destroy(),this.challengeBox=void 0)}_abandonChallenge(){void 0!==this.challengeBox&&(this.challengeBox.destroy(),this.challengeBox=void 0),this.canLevelPerks=!0}_setupMoonlightButton(e,t,i,s){this.moonlightButtons.push(new ft(this,t,i,48,48,e.texture).onClickHandler(()=>{this._levelUpPerk(e),this._onMoonlightChanged(),this._disableTooltip(),this._setTooltip(e,t,i),this.refresh()}).onPointerOverHandler(()=>{this._setTooltip(e,t,i)}).onPointerOutHandler(()=>{this._disableTooltip()})),this._updateMoonlightButton(e,s)}_havePerkRequirements(e){for(var t=0;t<e.requires.length;t++)if(0===this.moonlight.moonperks[e.requires[t]].level)return!1;return!0}_updateMoonlightButton(e,t){!1===this._havePerkRequirements(e)?this.moonlightButtons[t].setTint(Phaser.Display.Color.GetColor(32,32,32)):this.moonlightButtons[t].clearTint()}_onMoonlightChanged(){this.moonlightLabel.setText("MOONLIGHT\n"+Qe.numberString(Math.round(this.moonlight.moonlight)))}_levelUpPerk(e){!1!==this.canLevelPerks&&this.moonlight.levelUpPerk(e)}_setTooltip(e,t,i){void 0!==this.FloatingTooltip&&this._disableTooltip();var s="";s=-1!==e.maxLevel?e.name+" Lv"+e.level+"/"+e.maxLevel+"\n"+Bt.getMoonlightTooltip(e)+"\n\n":e.name+" Lv"+e.level+"\n"+Bt.getMoonlightTooltip(e)+"\n\n";var r=Math.floor((e.cost[0]+e.cost[1]*e.level)*Math.pow(e.cost[2],e.level));if(s+="Costs "+Qe.numberString(r)+" Moonlight\n",e.requires.length>0){s+="Requires: ";for(var n=0;n<e.requires.length;n++)0===this.moonlight.moonperks[e.requires[n]].level&&(s+=this.moonlight.moonperks[e.requires[n]].name+(n<e.requires.length-1?", ":""))}s=Qe.processText(s,53),this.floatingText=new a(this,s,t+(t+450>1100?-450:0),i+(i>300?-150:50),450,150,"courier16",16)}_disableTooltip(){void 0!==this.floatingText&&(this.floatingText.destroy(),this.floatingText=void 0)}}class Kt extends s{constructor(e,t){super(e,t),this.regionIcons=[],this.regionPaths=[],this.page=0,this.worldData=new vt}refresh(){this._refreshRegions()}rebirth(){}create(){this.add.rectangle(this.relativeX(0),this.relativeY(0),900,700,0).setOrigin(0).setInteractive(),this.floatingText=void 0,this._refreshRegions()}_setupRegionTile(e,t,i,s){var a=i.regionLevel*ot.getInstance().regionDifficultyIncrease+"-"+(i.regionLevel+1)*ot.getInstance().regionDifficultyIncrease,r=Math.floor(100*i.getExplorePercent())+"%";this.regionIcons.push(new ft(this,e,t,64,64,{sprite:"icons",tile:40}).onClickHandler(()=>{this._selectRegion(s)}).onPointerOverHandler(()=>{this._createTooltip(e,t,a,r,i)}).onPointerOutHandler(()=>{this._disableTooltip()}))}_setupPotentialRegionTile(e,t,i,s){var a=20*this.worldData.regionList.length+"-"+(20*this.worldData.regionList.length+20);this.regionIcons.push(new ft(this,e,t,64,64,{sprite:"icons",tile:40}).onClickHandler(()=>{this._chooseNewRegion(s)}).onPointerOverHandler(()=>{this._createTooltip(e,t,a,void 0,i)}).onPointerOutHandler(()=>{this._disableTooltip()}))}_refreshRegions(){for(var e=0;e<this.regionIcons.length;e++)this.regionIcons[e].destroy();for(e=0;e<this.regionPaths.length;e++)this.regionPaths[e].destroy();this.regionIcons=[],this.regionPaths=[];for(e=8*this.page+1;e<Math.min(this.worldData.regionList.length,8*this.page+8);e++){var t=this.relativeX(50+(e-1)%8*100),i=this.relativeY(this.worldData.regionList[e-1].worldHeight),s=this.relativeX(50+e%8*100),a=this.relativeY(this.worldData.regionList[e].worldHeight);this.regionPaths.push(this.add.line(0,0,t,i,s,a,11141120).setOrigin(0).setLineWidth(4))}if(this.worldData.regionList.length<8*this.page+8)for(e=0;e<this.worldData.nextRegions.length;e++){var r=this.worldData.regionList.length%8;t=this.relativeX(50+(r-1)%8*100),i=this.relativeY(this.worldData.regionList[this.worldData.regionList.length-1].worldHeight),s=this.relativeX(50+r%8*100),a=this.relativeY(0)+Math.floor((e+1)*(700/(this.worldData.nextRegions.length+1)));this.regionPaths.push(this.add.line(0,0,t,i,s,a,6684706).setOrigin(0).setLineWidth(4))}for(e=8*this.page;e<Math.min(this.worldData.regionList.length,8*this.page+8);e++){var n=this.relativeX(50+e%8*100)-32,o=this.relativeY(this.worldData.regionList[e].worldHeight)-32;this._setupRegionTile(n,o,this.worldData.regionList[e],e)}if(this.worldData.regionList.length<8*this.page+8)for(e=0;e<this.worldData.nextRegions.length;e++){n=this.relativeX(50+this.worldData.regionList.length%8*100)-32,o=this.relativeY(0)+Math.floor((e+1)*(700/(this.worldData.nextRegions.length+1)))-32;this._setupPotentialRegionTile(n,o,this.worldData.nextRegions[e],e)}}_selectRegion(e){this._disableTooltip(),this.worldData.setCurrentRegion(e),this.scene.get("DarkWorld").changeRegion(),this.scene.get("RegionScene").changeRegion(),this.scene.get("TownScene").changeRegion(),this.scene.bringToTop("RegionScene"),this.scene.bringToTop("DarKWorld")}_chooseNewRegion(e){this.worldData.addRegion(e),this._disableTooltip(),this._refreshRegions()}_createTooltip(e,t,i,s,a){void 0!==this.floatingText&&this.floatingText.destroy(),e+=e+400>1100?-250:64,this.floatingText=new xt(this,e,t,400,150),this.floatingText.addText(10,10,"courier20",ct.REGION_TYPES[a.type].name),this.floatingText.addText(10,30,"courier16","Difficulty: "+i),void 0!==s&&this.floatingText.addText(200,30,"courier16","Explored: "+s);var r=Bt.getRegionTooltip(a.type)+"\n\n";if(a.traits.length>0){r+="Traits: ";for(var n=0;n<a.traits.length;n++){switch(a.traits[n].type){case Be:r+="Dire "+a.traits[n].level;break;case Pe:r+="Poisoned "+a.traits[n].level;break;case Ie:r+="Monstrous "+a.traits[n].level;break;case Le:r+="Quick "+a.traits[n].level;break;case De:r+="Deadly "+a.traits[n].level;break;case Se:r+="Shielded "+a.traits[n].level;break;case He:r+="Beserk "+a.traits[n].level}n<a.traits.length-1&&(r+=", ")}}this.floatingText.addText(10,50,"courier16",Qe.processText(r,48))}_disableTooltip(){void 0!==this.floatingText&&(this.floatingText.destroy(),this.floatingText=void 0)}}var jt=i(0),zt=i.n(jt);class Qt{constructor(e,t,i){this.backingRect=e.add.rectangle(t,i,350,300,Phaser.Display.Color.GetColor(0,0,0)).setOrigin(0,0).setInteractive(),this.backingRect.isStroked=!0,this.backingRect.strokeColor=Phaser.Display.Color.GetColor(255,255,255),this.backingRect.lineWidth=2,this.scene=e,this.x=t,this.y=i,this.titleLabel=e.add.bitmapText(t+175,i+10,"courier20","Import/Export Save").setOrigin(.5,0);var s=Qe.processText("Copies your save information to/from the clipboard so you can backup your save or send it to another computer.",42);this.descLabel=e.add.bitmapText(t+10,i+40,"courier16",s),this.manualSaveLabel=e.add.bitmapText(t+175,i+150,"courier20","Manual Save").setOrigin(.5,0);s=Qe.processText("Click to manually save your game.",42);this.mSaveDescLabel=e.add.bitmapText(t+10,i+180,"courier16",s),this.exportButton=new bt(e,t+43,i+100,110,20,"Export").onClickHandler(()=>{this._export()}),this.importButton=new bt(e,t+196,i+100,110,20,"Import").onClickHandler(()=>{this._import()}),this.saveButton=new bt(e,t+120,i+210,110,20,"Save").onClickHandler(()=>{this._save()}),this.closeButton=new bt(e,t+230,i+270,110,20,"Back")}_save(){this.scene.scene.get("DarkWorld").save(),this.saveButton.setText("Saved!")}_export(){this.scene.scene.get("DarkWorld").copyToClipboard(),this.exportButton.setText("Copied!")}_import(){this.scene.scene.get("DarkWorld").copyFromClipboard(),this.importButton.setText("Loaded!")}destroy(){this.backingRect.destroy(),this.titleLabel.destroy(),this.descLabel.destroy(),this.manualSaveLabel.destroy(),this.mSaveDescLabel.destroy(),this.exportButton.destroy(),this.importButton.destroy(),this.saveButton.destroy(),this.closeButton.destroy()}onCloseHandler(e){return this.closeButton.onClickHandler(e),this}}class Jt{constructor(e,t,i){this.backingRect=e.add.rectangle(t,i,750,650,Phaser.Display.Color.GetColor(0,0,0)).setOrigin(0,0).setInteractive(),this.backingRect.isStroked=!0,this.backingRect.strokeColor=Phaser.Display.Color.GetColor(255,255,255),this.backingRect.lineWidth=2,this.scene=e,this.x=t,this.y=i,this.unlocks={gearTab:!1,exploreTab:!1,combatTab:!1,townTab:!1,talentsTab:!1,worldTab:!1,infuseUI:!1,resourceUI:!1,craftingUI:!1,buildings:!1,motes:!1,runes:!1},this.titleLabel=e.add.bitmapText(t+375,i+10,"courier20","Darkworld's Book of What to Do").setOrigin(.5,0);var s=i+40;this.gearBtn=!0===Ze.getInstance().unlocks.gearTab?new bt(e,t+5,s,120,20,"Gear").onClickHandler(()=>{this._setGuide(0)}):new bt(e,t+5,s,120,20,"???"),s+=22,this.exploreBtn=!0===Ze.getInstance().unlocks.exploreTab?new bt(e,t+5,s,120,20,"Region").onClickHandler(()=>{this._setGuide(1)}):new bt(e,t+5,s,120,20,"???"),s+=22,this.combatBtn=!0===Ze.getInstance().unlocks.combatTab?new bt(e,t+5,s,120,20,"Combat").onClickHandler(()=>{this._setGuide(2)}):new bt(e,t+5,s,120,20,"???"),s+=22,this.townBtn=!0===Ze.getInstance().unlocks.townTab?new bt(e,t+5,s,120,20,"Town").onClickHandler(()=>{this._setGuide(3)}):new bt(e,t+5,s,120,20,"???"),s+=22,this.talentsBtn=!0===Ze.getInstance().unlocks.talentsTab?new bt(e,t+5,s,120,20,"Talents").onClickHandler(()=>{this._setGuide(4)}):new bt(e,t+5,s,120,20,"???"),s+=22,this.worldBtn=!0===Ze.getInstance().unlocks.worldTab?new bt(e,t+5,s,120,20,"World").onClickHandler(()=>{this._setGuide(5)}):new bt(e,t+5,s,120,20,"???"),s+=22,this.infuseBtn=!0===Ze.getInstance().unlocks.infuseUI?new bt(e,t+5,s,120,20,"Shade").onClickHandler(()=>{this._setGuide(6)}):new bt(e,t+5,s,120,20,"???"),s+=22,this.resourceBtn=!0===Ze.getInstance().unlocks.resourceUI?new bt(e,t+5,s,120,20,"Resources").onClickHandler(()=>{this._setGuide(7)}):new bt(e,t+5,s,120,20,"???"),s+=22,this.craftingBtn=!0===Ze.getInstance().unlocks.craftingUI?new bt(e,t+5,s,120,20,"Crafting").onClickHandler(()=>{this._setGuide(8)}):new bt(e,t+5,s,120,20,"???"),s+=22,this.buildingsBtn=!0===Ze.getInstance().unlocks.buildings?new bt(e,t+5,s,120,20,"Buildings").onClickHandler(()=>{this._setGuide(9)}):new bt(e,t+5,s,120,20,"???"),s+=22,this.moteBtn=!0===Ze.getInstance().unlocks.motes?new bt(e,t+5,s,120,20,"Motes").onClickHandler(()=>{this._setGuide(10)}):new bt(e,t+5,s,120,20,"???"),s+=22,this.runeBtn=!0===Ze.getInstance().unlocks.runes?new bt(e,t+5,s,120,20,"Runes").onClickHandler(()=>{this._setGuide(11)}):new bt(e,t+5,s,120,20,"???"),s+=22,this.challengeBtn=!0===Ze.getInstance().persistentUnlocks.challenges?new bt(e,t+5,s,120,20,"Challenges").onClickHandler(()=>{this._setGuide(12)}):new bt(e,t+5,s,120,20,"???"),s+=22,this.btns=[this.gearBtn,this.exploreBtn,this.combatBtn,this.townBtn,this.talentsBtn,this.worldBtn,this.infuseBtn,this.resourceBtn,this.craftingBtn,this.buildingsBtn,this.moteBtn,this.runeBtn,this.challengeBtn],this.guideTexts=[],this.closeButton=new bt(e,t+630,i+620,110,20,"Back")}_setGuide(e){for(var t=0;t<this.guideTexts.length;t++)this.guideTexts[t].destroy();switch(this.guideTexts=[],e){case 0:this.guideTexts.push(this.scene.add.bitmapText(this.x+150,this.y+45,"courier20","Gear"));var i="This one's pretty simple, you can equip any gear you find here. You can only have 3 items equipped at a time: a weapon, armor, and a trinket. No, you can't wear boots AND a necklace, that would be STUPID.\n\nYou can do more in this tab, but that's for other sections when you unlock them.";this.guideTexts.push(this.scene.add.bitmapText(this.x+150,this.y+70,"courier16",Qe.processText(i,72)));break;case 1:this.guideTexts.push(this.scene.add.bitmapText(this.x+150,this.y+45,"courier20","Region"));i="A huge world to explore. Region's are usually 11x13 tile grids. Each tile has a biome that determines which monsters you'll fight, how long it takes to fully explore, and what kind of resources you can find there. Clicking on tiles you've revealed brings up a dialog with sweet deets and the explore button. Press the explore button to explore, duh. Here's some other poorly explained mechanics:\n\n* A tile's difficulty influences how much time it takes to explore.\n* Yields are partly determined by the neighboring tiles. For example, a mountain surrounded by plains gives less metal than a mountain surrounded by mountains.";this.guideTexts.push(this.scene.add.bitmapText(this.x+150,this.y+70,"courier16",Qe.processText(i,72))),this.guideTexts.push(this.scene.add.bitmapText(this.x+150,this.y+250,"courier20","Invasions"));i="After exploring a few tiles the monsters are going to want to take back the land. Every so often the region tab will light up, meaning the monsters are invading a tile. Tiles being invaded flash purple, and if you leave it long enough multiple tiles can be invaded at the same time. Once the invasion counter reachs 100% the monsters will destroy a random invaded tile, removing the building, killing villagers, and covering it in mist forcing you to explore it again. More useful tips:\n\n* The longer a tile is flashing the faster it builds up the invasion counter.\n* Remove invasions by fighting off the invaders. Killing all invaders reduces the invasion counter by 10%.\n* While invasions show up randomly, each flashing tile doubles the time before the next one shows up.";this.guideTexts.push(this.scene.add.bitmapText(this.x+150,this.y+280,"courier16",Qe.processText(i,72)));break;case 2:this.guideTexts.push(this.scene.add.bitmapText(this.x+150,this.y+45,"courier20","Combat"));i="Where you fight monsters and explore tiles. Fights happen automatically; enemies will attack you and you'll randomly target an enemy. After defeating all the enemies you'll gain some resources and shade. There's a 2.5 second window between fights where you explore the tile and heal your wounds.";this.guideTexts.push(this.scene.add.bitmapText(this.x+150,this.y+70,"courier16",Qe.processText(i,72)));break;case 3:this.guideTexts.push(this.scene.add.bitmapText(this.x+150,this.y+45,"courier20","Town"));i="You've found a whole town of other people. Here you can see a whole bunch of stats for nerds, like how many people live here, your economy/production bonuses, to how much you earn in taxes. You can upgrade buildings or research things like banking to improve the town, all at your expense!";this.guideTexts.push(this.scene.add.bitmapText(this.x+150,this.y+70,"courier16",Qe.processText(i,72))),this.guideTexts.push(this.scene.add.bitmapText(this.x+150,this.y+160,"courier20","Economy and Production"));i="How much money you earn in taxes and your money cap depends on how many villagers live in your town, for some reason. Increasing the economy increases those numbers, and increasing production obviously increases how many resources you produce.";this.guideTexts.push(this.scene.add.bitmapText(this.x+150,this.y+190,"courier16",Qe.processText(i,72))),this.guideTexts.push(this.scene.add.bitmapText(this.x+150,this.y+260,"courier20","Friendship"));i="Finally you have this thing called Friendship. You earn friendship by defeating monsters, and if you collect enough friendship you'll earn more shade. How? Through the power of friendship! Oh, also the villagers won't let you improve things past your friendship level no matter how much you pay them.";this.guideTexts.push(this.scene.add.bitmapText(this.x+150,this.y+290,"courier16",Qe.processText(i,72)));break;case 4:this.guideTexts.push(this.scene.add.bitmapText(this.x+150,this.y+45,"courier20","Talents"));i="Only the coolest of heros get these super cool and interesting talents. Talents are passive benefits that you can unlock by spending talent points. You can buy talent points with shade but the cost quickly increases, so you better choose carefully. Or don't, they probably don't make a huge difference.";this.guideTexts.push(this.scene.add.bitmapText(this.x+150,this.y+70,"courier16",Qe.processText(i,72)));break;case 5:this.guideTexts.push(this.scene.add.bitmapText(this.x+150,this.y+45,"courier20","World"));i="Who knew there was more than just one region? Me. I did. After fully exploring the topmost tile of a region you unlock the next region in the world tab. You'll have a few choices of which region to explore next, covering a variety of sweet environments, like desert, or mountains. There's no take backsies, once you choose a region thats it, although you can always go back and visit previous regions. Since you've probably found a Mystic Gate already here's some tips:\n\n* Each region has a Mystic Gate that gives you Moonlight based on your total stats/talents.\n* Each gate gives 50% MORE Moonlight than the previous gate. Eg: Region 2 gives 150%, region 3 gives 225%, 337%, etc.\n* If you explore far enough you might unlock something neat.";this.guideTexts.push(this.scene.add.bitmapText(this.x+150,this.y+70,"courier16",Qe.processText(i,72)));break;case 6:this.guideTexts.push(this.scene.add.bitmapText(this.x+150,this.y+45,"courier20","Shade"));i="It's like experience, but edgier! Defeating monsters gives you shade, with stronger monsters giving you more shade. Shade can really only be used for 2 things, so don't go saving it thinking there's going to be some sort of shade shop with a dongle of slaying, because there's not. You can infuse shade to earn 2 Stat Points, with the cost increasing by 50 each time. You can also get Talent Points starting at 400 shade bucks.";this.guideTexts.push(this.scene.add.bitmapText(this.x+150,this.y+70,"courier16",Qe.processText(i,72)));break;case 7:this.guideTexts.push(this.scene.add.bitmapText(this.x+150,this.y+45,"courier20","Resources"));i="Pretty much all the cool things are made out of resources. You have 6 of them to collect: Wood, Leather, Metal, Fiber, Stone, and Crystal. You collect some after defeating monsters and they can be used to buy all kinds of things, like town upgrades, gear, or buildings. Each region has it's own super cool tier of resources and won't use any of that junk you found in the region before.";this.guideTexts.push(this.scene.add.bitmapText(this.x+150,this.y+70,"courier16",Qe.processText(i,72)));break;case 8:this.guideTexts.push(this.scene.add.bitmapText(this.x+150,this.y+45,"courier20","Crafting"));i="Once you have enough resources you can spend it on getting better gear. You can spend resources crafting new gear or leveling up gear you already have. Each level increases the gear's stats and costs. Cost per level increase with every level, while stats per level increases every 5th level. You can probably make some better gear once you find some better resources.";this.guideTexts.push(this.scene.add.bitmapText(this.x+150,this.y+70,"courier16",Qe.processText(i,72)));break;case 9:this.guideTexts.push(this.scene.add.bitmapText(this.x+150,this.y+45,"courier20","Building"));i="Finally you can force those villagers to do some work, as long as you cover 100% of the costs. Buildings let you exploit the natural land around you for profit. Once you've unlocked buildings you can click on a tile to see a list of buildings you can build there, such as:\n\nRoads: Can only be built next to docks, the town, or other roads. Pretty much every building uses roads so make sure you can build them.\n\nHouses: Built next to roads, increase the max population in the city.\n\nProduction: Buildings like Lumber Mills and Quarries. These give you resources every day based on the yields of a tile. They also have a super complicated efficiency value. Nearby roads increase efficiency or reduce it to 0% if no road is close enough. Neighbouring buildings also reduce efficiency, with production buildings giving a big hit to efficiency while houses don't impact it much.\n\nEconomy: Taverns, Docks, and Markets all improve a towns gold income, meaning you earn more AND increase your gold cap. Docks also act as roads, letting you expand across water.\n\nOther: The rest, like Watch Towers and Alchemy Labs, that have a variety of effects and don't fit in the other sections.\n\nBuildings can be upgraded with insane amounts of resources and gold to increase their effects. Finally there's defense, which is how quickly invasions build on that tile.";this.guideTexts.push(this.scene.add.bitmapText(this.x+150,this.y+70,"courier16",Qe.processText(i,72)));break;case 10:this.guideTexts.push(this.scene.add.bitmapText(this.x+150,this.y+45,"courier20","Motes of Darkness"));i="These super useful stones can be found from the monsters you defeat in invasions. You know, those glowing purple tiles that you totally don't ingore? Motes can be slapped into gear to give it a whopping 0.25% bonus to its stats! It's so good that it even has diminishing returns after 20%.";this.guideTexts.push(this.scene.add.bitmapText(this.x+150,this.y+70,"courier16",Qe.processText(i,72)));break;case 11:this.guideTexts.push(this.scene.add.bitmapText(this.x+150,this.y+45,"courier20","Runes"));i="Glowing rocks you can slap into your gear. You have a chance to find a rune after fully exploring a tile. Each region only has a handful of runes to find, and you can't do any funny business like letting monsters invade a tile you found a rune in for infinite runes. Runes have a level (based on the region they were found) and can be leveled up with motes. You can also reroll a rune to try and get a better one by spending motes. Runes are basically a motes sink.\n\nHigher tier items have more slots for runes, allowing you to cram even more glowing rocks into them. You may even be able to make rune words by putting them in the right order.";this.guideTexts.push(this.scene.add.bitmapText(this.x+150,this.y+70,"courier16",Qe.processText(i,72)));break;case 12:this.guideTexts.push(this.scene.add.bitmapText(this.x+150,this.y+45,"courier20","Challenges"));i="The Moon Lord thinks you're okay and so has allowed you to undertake challenges. You can start a challenge at any time, but you won't get any moonlight unless you start one after passing through a Mystic Gate. Challenges change the game, removing features and generally making things a pain. If you complete a challenge you can get some powerful rewards along with a handful of Challenge Points. Challenge Points are pretty much just another stat multiplier to encourage you to do the annoying/boring ones.";this.guideTexts.push(this.scene.add.bitmapText(this.x+150,this.y+70,"courier16",Qe.processText(i,72)))}}destroy(){this.backingRect.destroy(),this.titleLabel.destroy(),this.closeButton.destroy();for(var e=0;e<this.btns.length;e++)this.btns[e].destroy();for(e=0;e<this.guideTexts.length;e++)this.guideTexts[e].destroy()}onCloseHandler(e){return this.closeButton.onClickHandler(e),this}}var Zt=new class extends s{constructor(e,t){super(e,t),this.settings=new ot,this.moonlight=new Je,this.worldData=new vt,this.player=new ht,this.progression=new Ze,this.gearShowTimer=2e3,this.infuseStart=0,this.gearStart=0,this.detailsStart=0,this.resourceStart=0,this.resourceTierSelected=0,this.saveTimer=je,this.buyAmount=1,this.talentCost=0,this.statCost=0,this.lastFrame=0,this.loadGame()}preload(){this.load.bitmapFont("courier16","./../../assets/font/anonpro16.png","./../../assets/font/anonpro16.xml"),this.load.bitmapFont("courier20","./../../assets/font/anonpro20.png","./../../assets/font/anonpro20.xml"),this.load.spritesheet("icons","./../../assets/icons/icons.png",{frameWidth:16,frameHeight:16}),this.load.spritesheet("bldicons","./../../assets/icons/buildingicons.png",{frameWidth:16,frameHeight:16}),this.load.spritesheet("roadicons","./../../assets/icons/roadicons.png",{frameWidth:50,frameHeight:50}),this.load.spritesheet("moonicons","./../../assets/icons/moonicons.png",{frameWidth:16,frameHeight:16}),this.load.spritesheet("runeicons","./../../assets/icons/runeicons.png",{frameWidth:16,frameHeight:16}),this.load.spritesheet("enemyicons","./../../assets/enemy/enemyicons.png",{frameWidth:16,frameHeight:16}),this.load.image("title","./../../assets/title.png")}create(){this.add.bitmapText(10,10,"courier20","Stats"),this.add.rectangle(0,0,200,800,0).setOrigin(0).setInteractive(),this.add.rectangle(200,0,900,100,0).setOrigin(0).setInteractive(),this.statLabels=[],this.statIcons=[],this.statIncButtons=[],this.statIcons.push(new Rt(this,20,20,16,16,{sprite:"icons",tile:0},"Strength determines how hard you hit. Each point increases your min Damage by 0.4, max Damage by 1, and increases damage from gear by ~1% (diminishing returns).")),this.statIcons.push(new Rt(this,20,40,16,16,{sprite:"icons",tile:1},"Dexterity determines your ability to hit enemies. Each point increases your Hit by 7.")),this.statIcons.push(new Rt(this,20,60,16,16,{sprite:"icons",tile:2},"Agility determines how hard you are to hit. Each point increases your Evasion by 7 and gives a small boost to explore speed.")),this.statIcons.push(new Rt(this,20,80,16,16,{sprite:"icons",tile:3},"Endurance determines your health resistance against criticals. Each point increases your max Health by 5 and Crit Resistance by 3.")),this.statIcons.push(new Rt(this,20,100,16,16,{sprite:"icons",tile:4},"Recovery determines how easily you heal your wounds. Each point increases your Health Regen by 0.15/s.")),this.statIcons.push(new Rt(this,20,120,16,16,{sprite:"icons",tile:5},"Defense determines how durable your body is. Each point increases your armor by 0.2 and increases armor from gear by ~1% (diminishing returns).")),this.statIcons.push(new Rt(this,20,140,16,16,{sprite:"icons",tile:6},"Accuracy determines your ability to strike weak points. Each point increases your Crit Power by 3.")),this.statIncButtons.push(new bt(this,150,20,16,16,"+").onClickHandler(()=>{this._increaseStat("str")})),this.statIncButtons.push(new bt(this,150,40,16,16,"+").onClickHandler(()=>{this._increaseStat("dex")})),this.statIncButtons.push(new bt(this,150,60,16,16,"+").onClickHandler(()=>{this._increaseStat("agi")})),this.statIncButtons.push(new bt(this,150,80,16,16,"+").onClickHandler(()=>{this._increaseStat("end")})),this.statIncButtons.push(new bt(this,150,100,16,16,"+").onClickHandler(()=>{this._increaseStat("rec")})),this.statIncButtons.push(new bt(this,150,120,16,16,"+").onClickHandler(()=>{this._increaseStat("def")})),this.statIncButtons.push(new bt(this,150,140,16,16,"+").onClickHandler(()=>{this._increaseStat("acc")})),this.detailsLabels=[],this.detailsIcons=[],this.detailsIcons.push(new Rt(this,20,170,16,16,{sprite:"icons",tile:25},"Health, when this runs out you die.")),this.detailsIcons.push(new Rt(this,20,170,16,16,{sprite:"icons",tile:24},"The damage you deal with each attack. Your damage is reduced by the targets armor, dealing a minimum of 1 damage.")),this.detailsIcons.push(new Rt(this,20,170,16,16,{sprite:"icons",tile:26},"Armor. Each point reduces damage from enemy attacks by 1.")),this.detailsIcons.push(new Rt(this,20,170,16,16,{sprite:"icons",tile:27},"Hit Chance. Hit increases your attack speed, while enemy Evasion lowers your attack speed.")),this.detailsIcons.push(new Rt(this,20,170,16,16,{sprite:"icons",tile:28},"Evasion. Slows enemy attack speed if you have more Evasion then their Hit.")),this.detailsIcons.push(new Rt(this,20,170,16,16,{sprite:"icons",tile:29},"Health Regen. You restore this much Health every second. Works in combat.")),this.detailsIcons.push(new Rt(this,20,170,16,16,{sprite:"icons",tile:31},"Crit Chance. The chance any hit is a critical hit, dealing extra damage.")),this.detailsIcons.push(new Rt(this,20,170,16,16,{sprite:"icons",tile:30},"Crit Power. Increases your crit damage, but is reduced by the targets Crit Resistance.")),this.detailsIcons.push(new Rt(this,20,170,16,16,{sprite:"icons",tile:48},"Crit Resistance. Reduces the damage taken by critical hits.")),this.gearLabels=this.add.bitmapText(20,30,"courier16","").setOrigin(0),this.resourceLabels=[],this.resourceTierButtons=[],this.resourceTierButtons.push(new bt(this,20,170,16,16,"1").onClickHandler(()=>{this.resourceTierSelected=0,this._updateResources()})),this.resourceTierButtons.push(new bt(this,20,170,16,16,"2").onClickHandler(()=>{this.resourceTierSelected=1,this._updateResources()})),this.resourceTierButtons.push(new bt(this,20,170,16,16,"3").onClickHandler(()=>{this.resourceTierSelected=2,this._updateResources()})),this.resourceTierButtons.push(new bt(this,20,170,16,16,"4").onClickHandler(()=>{this.resourceTierSelected=3,this._updateResources()})),this.resourceTierButtons.push(new bt(this,20,170,16,16,"5").onClickHandler(()=>{this.resourceTierSelected=4,this._updateResources()})),this.resourceTierButtons.push(new bt(this,20,170,16,16,"6").onClickHandler(()=>{this.resourceTierSelected=5,this._updateResources()})),this.resourceTierButtons.push(new bt(this,20,170,16,16,"7").onClickHandler(()=>{this.resourceTierSelected=6,this._updateResources()})),this.resourceTierButtons.push(new bt(this,20,170,16,16,"8").onClickHandler(()=>{this.resourceTierSelected=7,this._updateResources()})),this.resourceIcons=[],this.resourceIcons.push(new Rt(this,20,170,16,16,{sprite:"icons",tile:32},"Wood. Found in forests and wodes, duh.")),this.resourceIcons.push(new Rt(this,20,170,16,16,{sprite:"icons",tile:33},"Leather. The best leather comes from the plains and forests.")),this.resourceIcons.push(new Rt(this,20,170,16,16,{sprite:"icons",tile:34},"Metal. Hard to find resource thats available in large quantities in the mountains.")),this.resourceIcons.push(new Rt(this,20,170,16,16,{sprite:"icons",tile:35},"Fiber. Found in swamps and forests.")),this.resourceIcons.push(new Rt(this,20,170,16,16,{sprite:"icons",tile:36},"Stone. Can be found in abundance in the hills.")),this.resourceIcons.push(new Rt(this,20,170,16,16,{sprite:"icons",tile:37},"Crystal. Hard to find in large amounts, but can be found in the harder to reach areas.")),this.resourceIcons.push(new Rt(this,20,170,16,16,{sprite:"icons",tile:38},"Gold. Your current gold cap is equal to (Flat bonuses + population) * Economy Multiplier.")),this.resourceIcons.push(new Rt(this,20,170,16,16,{sprite:"icons",tile:39},"Motes of Darkness. Fuse these onto weapons to improve their power.")),this.buyButtons=[],this.buyButtons.push(new bt(this,10,780,30,18,"x1").onClickHandler(()=>{this._setBuyAmount(1,0)}).setTextColor(Phaser.Display.Color.GetColor(255,255,0))),this.buyButtons.push(new bt(this,45,780,30,18,"x5").onClickHandler(()=>{this._setBuyAmount(5,1)})),this.buyButtons.push(new bt(this,80,780,40,18,"x10").onClickHandler(()=>{this._setBuyAmount(10,2)})),this.buyButtons.push(new bt(this,125,780,40,18,"x100").onClickHandler(()=>{this._setBuyAmount(100,3)})),this.infuseLabel=this.add.bitmapText(10,10,"courier20","Infuse"),this.shadeLabel=this.add.bitmapText(20,10,"courier16","Shade: "+this.player.shade),this.statInfuseLabel=this.add.bitmapText(20,10,"courier16","Infuse Stat"),this.statProgressBar=new Tt(this,100,10,120,14,Phaser.Display.Color.GetColor(0,0,255),Phaser.Display.Color.GetColor(0,32,0)),this.statInfuseButton=new bt(this,250,10,16,16,"+"),this.statInfuseButton.onClickHandler(()=>{this._buyStatPoint()}),this.talentInfuseLabel=this.add.bitmapText(20,10,"courier16","Infuse Talent"),this.talentProgressBar=new Tt(this,100,10,120,14,Phaser.Display.Color.GetColor(0,0,255),Phaser.Display.Color.GetColor(0,32,0)),this.talentInfuseButton=new bt(this,250,10,16,16,"+"),this.talentInfuseButton.onClickHandler(()=>{this._buyTalentPoint()}),this.gearLabel=this.add.bitmapText(10,10,"courier20","Gear"),this.detailsLabel=this.add.bitmapText(10,10,"courier20","Details"),this.resourceLabel=this.add.bitmapText(10,10,"courier20","Resources"),this.progression.addOnUnlockHandler((e,t,i)=>{this._handleProgressionEvents(e,t,i)}),this.titleImage=this.add.image(650,25,"title"),this.loreButton=new bt(this,200,60,122,20,"Lore").onClickHandler(()=>{this.scene.bringToTop("LoreScene"),this.scene.bringToTop("DarkWorld")}),this.gearButton=new bt(this,327,60,122,20,"Gear").onClickHandler(()=>{this.scene.bringToTop("GearScene"),this.scene.bringToTop("DarkWorld")}),this.talentButton=new bt(this,454,60,122,20,"Talents").onClickHandler(()=>{this.scene.bringToTop("TalentScene"),this.scene.bringToTop("DarkWorld")}),this.regionButton=new bt(this,581,60,122,20,"Region").onClickHandler(()=>{this.scene.bringToTop("RegionScene"),this.scene.bringToTop("DarkWorld")}),this.combatButton=new bt(this,708,60,122,20,"Combat").onClickHandler(()=>{this.scene.bringToTop("CombatScene"),this.scene.bringToTop("DarkWorld")}),this.townButton=new bt(this,835,60,122,20,"Town").onClickHandler(()=>{this.scene.bringToTop("TownScene"),this.scene.bringToTop("DarkWorld")}),this.worldButton=new bt(this,962,60,122,20,"World").onClickHandler(()=>{this.scene.bringToTop("WorldScene"),this.scene.bringToTop("DarkWorld")}),this.worldTimeLabel=this.add.bitmapText(650,80,"courier20","").setOrigin(.5,0),this.moonlightButton=new ft(this,965,12,32,32,{sprite:"moonicons",tile:12}).onClickHandler(()=>{this.scene.bringToTop("MoonlightScene")}),this.exportDialog=void 0,this.guideWindow=void 0,this.optionsButton=new ft(this,1005,12,32,32,{sprite:"icons",tile:55}).onClickHandler(()=>{this._openExportDialog()}),this.guideButton=new ft(this,1045,12,32,32,{sprite:"icons",tile:54}).onClickHandler(()=>{this._openGuideWindow()}),this.gearButton.setVisible(this.progression.unlocks.gearTab),this.regionButton.setVisible(this.progression.unlocks.exploreTab),this.combatButton.setVisible(this.progression.unlocks.combatTab),this.townButton.setVisible(vt.instance.getCurrentRegion().townData.townExplored),!0===ot.getInstance().talentsEnabled?this.talentButton.setVisible(this.progression.unlocks.talentsTab):this.talentButton.setVisible(!1),this.worldButton.setVisible(this.progression.unlocks.worldTab),this.moonlightButton.setVisible(this.progression.totalCounts.timesGated>0),this.registry.set("setTooltip",(e,t,i,s,a)=>{this._setTooltip(e,t,i,s,a)}),this.registry.set("disableTooltip",()=>{this._disableTooltip()}),this.regionScene=new Mt([200,100],"RegionScene"),this.regionScene.registerEvent("onTileClick",(e,t,i)=>{this._handleTileClick(e,t,i)}),this.combatScene=new St([200,100],"CombatScene"),this.combatScene.registerEvent("onReward",e=>{this._onRewardCallback(e)}),this.loreScene=new Et([200,100],"LoreScene"),this.gearScene=new Yt([200,100],"GearScene"),this.townScene=new Gt([200,100],"TownScene"),this.talentScene=new Nt([200,100],"TalentScene"),this.worldScene=new Kt([200,100],"WorldScene"),this.moonlightScene=new Xt([0,0],"MoonlightScene"),this.scene.add("CombatScene",this.combatScene,!0),this.scene.add("RegionScene",this.regionScene,!0),this.scene.add("LoreScene",this.loreScene,!0),this.scene.add("GearScene",this.gearScene,!0),this.scene.add("TownScene",this.townScene,!0),this.scene.add("TalentScene",this.talentScene,!0),this.scene.add("WorldScene",this.worldScene,!0),this.scene.add("MoonlightScene",this.moonlightScene,!0),this.scene.bringToTop("LoreScene"),this.scene.bringToTop("DarkWorld"),this.player.statBlock.registerEvent("onHealthChanged",()=>{this._updateDetails()}),this.player.registerEvent("onStatChanged",()=>{this._layoutStats()}),this.player.registerEvent("onResourcesChanged",()=>{this._updateResources()}),!1===this.progression.unlocks.gearTab&&this.loreScene.addText("You open your eyes and see a vast wilderness before you. Unsure of how you got here you check your surroundings for any clues. You find a broken sword, an old barrel lid and some worn, raggy leathers. Not great, but you're also naked so you take what you can get.\n\nAfter putting these on you should go exploring."),this._layoutStats(),this._setBuyAmount(1,0)}_setBuyAmount(e,t){this.buyAmount=e,this._updateInfuseCosts();for(var i=0;i<this.buyButtons.length;i++)this.buyButtons[i].setTextColor(Phaser.Display.Color.GetColor(255,255,255));this.buyButtons[t].setTextColor(Phaser.Display.Color.GetColor(255,255,0))}_updateInfuseCosts(){this.statCost=this.player.getStatCost(this.buyAmount),this.talentCost=this.player.getTalentCost(this.buyAmount),this.statProgressBar.setFillPercent(this.player.shade/this.statCost,Qe.numberString(Math.floor(Math.min(this.player.shade,this.statCost)))+"/"+Qe.numberString(this.statCost)),this.talentProgressBar.setFillPercent(this.player.shade/this.talentCost,Qe.numberString(Math.floor(Math.min(this.player.shade,this.talentCost)))+"/"+Qe.numberString(Math.floor(this.talentCost))),this.statInfuseButton.setEnable(this.player.shade>=this.statCost),this.talentInfuseButton.setEnable(this.player.shade>=this.talentCost)}notifyGear(){this.gearButton.setNotification()}notifyRegion(){this.regionButton.setNotification()}_handleProgressionEvents(e,t,i){switch(void 0!==i&&""!==i&&this.loreButton.setNotification(),e){case n:this.gearButton.setVisible(!0);break;case o:this.regionButton.setVisible(!0);break;case h:this.combatButton.setVisible(!0);break;case l:this.townButton.setVisible(!0),this._updateResources();break;case p:!0===ot.getInstance().talentsEnabled&&this.talentButton.setVisible(!0);break;case m:this.worldButton.setVisible(!0);break;case c:case d:this._layoutStats();break;case w:50===t&&this.progression.registerFeatureUnlocked(c);break;case f:5===t&&this.progression.registerFeatureUnlocked(g);break;case k:if(25===t)this.progression.registerFeatureUnlocked(d);else if(100===t){(new nt).tiersAvailable=1,this.progression.registerFeatureUnlocked(u)}break;case y:this._updateResources()}}_updateStats(){for(var e=0;e<this.statLabels.length;e++)this.statLabels[e].destroy();this.statLabels=[],this.statLabels.push(this.add.bitmapText(20,0,"courier16","Stat Points: "+this.player.statPoints)),this.statLabels.push(this.add.bitmapText(40,20,"courier16",Qe.numberString(this.player.statBlock.Strength()))),this.statLabels.push(this.add.bitmapText(40,40,"courier16",Qe.numberString(this.player.statBlock.Dexterity()))),this.statLabels.push(this.add.bitmapText(40,60,"courier16",Qe.numberString(this.player.statBlock.Agility()))),this.statLabels.push(this.add.bitmapText(40,80,"courier16",Qe.numberString(this.player.statBlock.Endurance()))),this.statLabels.push(this.add.bitmapText(40,100,"courier16",Qe.numberString(this.player.statBlock.Recovery()))),this.statLabels.push(this.add.bitmapText(40,120,"courier16",Qe.numberString(this.player.statBlock.Defense()))),this.statLabels.push(this.add.bitmapText(40,140,"courier16",Qe.numberString(this.player.statBlock.Accuracy()))),this._updateStatButtons()}_updateShade(){this.infuseLabel.setPosition(10,this.infuseStart),this.shadeLabel.setPosition(20,this.infuseStart+20),this.statInfuseLabel.setPosition(20,this.infuseStart+40),this.statProgressBar.setPosition(20,this.infuseStart+60),this.statInfuseButton.setPosition(150,this.infuseStart+60),this.talentInfuseLabel.setPosition(20,this.infuseStart+80),this.talentProgressBar.setPosition(20,this.infuseStart+100),this.talentInfuseButton.setPosition(150,this.infuseStart+100),this.shadeLabel.setText("Shade: "+Qe.numberString(Math.floor(this.player.shade))),this.statProgressBar.setFillPercent(this.player.shade/this.statCost,Qe.numberString(Math.floor(Math.min(this.player.shade,this.statCost)))+"/"+Qe.numberString(this.statCost)),this.talentProgressBar.setFillPercent(this.player.shade/this.talentCost,Qe.numberString(Math.floor(Math.min(this.player.shade,this.talentCost)))+"/"+Qe.numberString(Math.floor(this.talentCost))),this.statInfuseButton.setEnable(this.player.shade>=this.statCost),this.talentInfuseButton.setEnable(this.player.shade>=this.talentCost)}_updateGear(){var e=Qe.processText("W: "+(void 0===this.player.weapon?"None":this.player.weapon.name+" Lv"+this.player.weapon.level),20)+"\n"+Qe.processText("A: "+(void 0===this.player.armor?"None":this.player.armor.name+" Lv"+this.player.armor.level),20)+"\n"+Qe.processText("T: "+(void 0===this.player.trinket?"None":this.player.trinket.name+" Lv"+this.player.trinket.level),20);this.gearLabels.setText(e)}_updateDetails(){this.detailsLabel.setPosition(10,this.detailsStart);for(var e=0;e<this.detailsLabels.length;e++)this.detailsLabels[e].destroy();this.detailsLabels=[];for(e=0;e<this.detailsIcons.length;e++)this.detailsIcons[e].setPosition(20,this.detailsStart+20+20*e);this.detailsLabels.push(this.add.bitmapText(40,this.detailsStart+20,"courier16",Qe.numberString(Math.floor(this.player.statBlock.currentHealth))+"/"+Qe.numberString(this.player.statBlock.MaxHealth()))),this.detailsLabels.push(this.add.bitmapText(40,this.detailsStart+40,"courier16",Qe.numberString(this.player.statBlock.DamageMin())+"-"+Qe.numberString(this.player.statBlock.DamageMax()))),this.detailsLabels.push(this.add.bitmapText(40,this.detailsStart+60,"courier16",Qe.numberString(this.player.statBlock.Armor()))),this.detailsLabels.push(this.add.bitmapText(40,this.detailsStart+80,"courier16",Qe.numberString(this.player.statBlock.Hit()))),this.detailsLabels.push(this.add.bitmapText(40,this.detailsStart+100,"courier16",Qe.numberString(this.player.statBlock.Evasion()))),this.detailsLabels.push(this.add.bitmapText(40,this.detailsStart+120,"courier16",this.player.statBlock.HealthRegen()+"/s")),this.detailsLabels.push(this.add.bitmapText(40,this.detailsStart+140,"courier16",Math.floor(100*this.player.statBlock.CritChance())+"%")),this.detailsLabels.push(this.add.bitmapText(40,this.detailsStart+160,"courier16",Qe.numberString(this.player.statBlock.CritPower())+"")),this.detailsLabels.push(this.add.bitmapText(40,this.detailsStart+180,"courier16",Qe.numberString(this.player.statBlock.CritResistance())+""))}_updateResources(){this.resourceLabel.setPosition(10,this.resourceStart),this.resourceLabel.setVisible(this.progression.unlocks.resourceUI);for(var e=0;e<this.resourceLabels.length;e++)this.resourceLabels[e].destroy();this.resourceLabels=[];for(e=0;e<this.resourceIcons.length;e++)this.resourceIcons[e].setPosition(20,this.resourceStart+40+20*e),this.resourceIcons[e].setVisible(this.progression.unlocks.resourceUI);for(e=0;e<this.resourceTierButtons.length;e++)this.resourceTierButtons[e].setPosition(20+20*e,this.resourceStart+20),this.resourceTierButtons[e].setVisible(this.player.resourceTierReached>=1&&e<=this.player.resourceTierReached);if(this.resourceIcons[6].setVisible(this.progression.unlocks.townTab),this.resourceIcons[7].setVisible(this.progression.unlocks.motes),!0===this.progression.unlocks.resourceUI){var t=this.player.resources[this.resourceTierSelected];this.resourceLabels.push(this.add.bitmapText(40,this.resourceStart+40,"courier16",Qe.numberString(Math.floor(t[0])))),this.resourceLabels.push(this.add.bitmapText(40,this.resourceStart+60,"courier16",Qe.numberString(Math.floor(t[1])))),this.resourceLabels.push(this.add.bitmapText(40,this.resourceStart+80,"courier16",Qe.numberString(Math.floor(t[2])))),this.resourceLabels.push(this.add.bitmapText(40,this.resourceStart+100,"courier16",Qe.numberString(Math.floor(t[3])))),this.resourceLabels.push(this.add.bitmapText(40,this.resourceStart+120,"courier16",Qe.numberString(Math.floor(t[4])))),this.resourceLabels.push(this.add.bitmapText(40,this.resourceStart+140,"courier16",Qe.numberString(Math.floor(t[5])))),!0===this.progression.unlocks.townTab&&this.resourceLabels.push(this.add.bitmapText(40,this.resourceStart+160,"courier16",Qe.numberString(Math.floor(this.player.gold))+"/"+Qe.numberString(Math.floor(this.worldData.getGoldCap())))),!0===this.progression.unlocks.motes&&this.resourceLabels.push(this.add.bitmapText(40,this.resourceStart+180,"courier16",Qe.numberString(Math.floor(this.player.motes))))}}_layoutStats(){var e=160;this.infuseLabel.setVisible(this.progression.unlocks.infuseUI),this.shadeLabel.setVisible(this.progression.unlocks.infuseUI),this.statProgressBar.setVisible(this.progression.unlocks.infuseUI),this.statInfuseButton.setVisible(this.progression.unlocks.infuseUI),this.statInfuseLabel.setVisible(this.progression.unlocks.infuseUI),!0===ot.getInstance().talentsEnabled?(this.talentProgressBar.setVisible(this.progression.unlocks.infuseUI),this.talentInfuseButton.setVisible(this.progression.unlocks.infuseUI),this.talentInfuseLabel.setVisible(this.progression.unlocks.infuseUI)):(this.talentProgressBar.setVisible(!1),this.talentInfuseButton.setVisible(!1),this.talentInfuseLabel.setVisible(!1)),!0===this.progression.unlocks.infuseUI&&(this.infuseStart=e,e+=120),this.gearStart=e,this.gearLabel.setPosition(10,e),this.gearLabels.setPosition(20,e+20),this._updateGear(),e+=this.gearLabels.getTextBounds().local.height+20,this.detailsStart=e,e+=200,this.resourceStart=e,this._updateStats(),this._updateDetails(),this._updateShade(),this._updateResources()}_updateStatButtons(){for(var e=this.player.statPoints>0,t=0;t<this.statIncButtons.length;t++)this.statIncButtons[t].setEnable(e)}_handleTileClick(e,t,i=!1){var s=this.worldData.getCurrentRegion();s.isExplorable(e,t)&&(!1===i&&(this.scene.bringToTop("CombatScene"),this.scene.bringToTop("DarkWorld")),this.combatScene.initFight(s.map[t][e]))}_buyStatPoint(){this.progression.registerStatPointGain(this.buyAmount),this.player.buyStat(this.buyAmount),this._updateInfuseCosts(),this._updateStats(),this._updateShade()}_buyTalentPoint(){!1===this.progression.unlocks.talentsTab&&this.progression.registerFeatureUnlocked(p,"Holding this much raw shade, it almost feels... alive? Or it would be if classes were in the game. Since they're not you just get 1 measly talent point to spend on the basic bitch talents."),this.player.buyTalent(this.buyAmount),this._updateInfuseCosts(),this._updateShade()}_increaseStat(e){this.player.increaseStat(e,this.buyAmount)}_onRewardCallback(e){!0===this.progression.unlocks.craftingUI&&(nt.getInstance().tiersAvailable=Math.max(nt.getInstance().tiersAvailable,e.tier+1),this.gearScene._updateTierButtons()),this.player.addShade(e.shade),this.player.addResource(e.resource,e.tier),this.player.addMote(e.motes),this._updateShade(),this.progression.registerMonsterKill(),this.progression.registerShadeGain(e.shade),this.progression.registerResourceGain(e.resource),!0===this.progression.unlocks.townTab&&(this.player.addGold(e.gold),vt.getInstance().getCurrentRegion().townData.addFriendship(e.friendship),this.townScene._updateStatus())}_openExportDialog(){this._closeExportDialog(),this.exportDialog=new Qt(this,485,250),this.exportDialog.onCloseHandler(()=>{this._closeExportDialog()})}_closeExportDialog(){void 0!==this.exportDialog&&(this.exportDialog.destroy(),this.exportDialog=void 0)}_openGuideWindow(){this._closeGuideWindow(),this.guideWindow=new Jt(this,175,100),this.guideWindow.onCloseHandler(()=>{this._closeGuideWindow()})}_closeGuideWindow(){void 0!==this.guideWindow&&(this.guideWindow.destroy(),this.guideWindow=void 0)}rebirth(){this.player.rebirth(),(new nt).rebirth(),this.worldData.rebirth(),this.progression.rebirth(),(new _t).rebirth(),this.resourceTierSelected=0,this.gearButton.setVisible(this.progression.unlocks.gearTab),this.regionButton.setVisible(this.progression.unlocks.exploreTab),this.combatButton.setVisible(this.progression.unlocks.combatTab),this.townButton.setVisible(vt.instance.getCurrentRegion().townData.townExplored),this.talentButton.setVisible(this.progression.unlocks.talentsTab),this.worldButton.setVisible(this.progression.unlocks.worldTab),this.moonlightButton.setVisible(this.progression.totalCounts.timesGated>0),this._layoutStats(),this._updateInfuseCosts(),this.gearShowTimer=2e3,this.loreScene.rebirth(),this.gearScene.rebirth(),this.talentScene.rebirth(),this.regionScene.rebirth(),this.combatScene.rebirth(),this.townScene.rebirth(),this.scene.bringToTop("LoreScene"),this.scene.bringToTop(),this.loreScene.addText("You open your eyes and see a vast wilderness before you. Unsure of how you got here you check your surroundings for any clues. You find a broken sword, an old barrel lid and some worn, raggy leathers. Not great, but you're also naked so you take what you can get.\n\nAfter putting these on you should go exploring.")}changeRegion(){this.townButton.setVisible(vt.getInstance().getCurrentRegion().townData.townExplored)}refreshAll(){this.gearButton.setVisible(this.progression.unlocks.gearTab),this.regionButton.setVisible(this.progression.unlocks.exploreTab),this.combatButton.setVisible(this.progression.unlocks.combatTab),this.townButton.setVisible(vt.instance.getCurrentRegion().townData.townExplored),this.talentButton.setVisible(this.progression.unlocks.talentsTab),this.worldButton.setVisible(this.progression.unlocks.worldTab),this.moonlightButton.setVisible(this.progression.totalCounts.timesGated>0),this._layoutStats(),this._updateInfuseCosts(),this.loreScene.refresh(),this.gearScene.refresh(),this.talentScene.refresh(),this.regionScene.refresh(),this.worldScene.refresh(),this.townScene.refresh(),this.moonlightScene.refresh()}update(e,t){this.worldData.time.setFrameDelta(Math.min(500,e-this.lastFrame)),this.lastFrame=e;var i=this.worldData.time.frameDelta;this.worldData.update(i),this.player.statBlock.tickRegen(i,this.combatScene.isInCombat()),this.worldTimeLabel.setText(this.worldData.time.getText()),!0!==this.progression.unlocks.gearTab&&(this.gearShowTimer-=i,this.gearShowTimer<=0&&this.progression.registerFeatureUnlocked(n)),this.saveTimer-=this.worldData.time.delta,this.saveTimer<=0&&(this.saveTimer=je,this.save())}copyToClipboard(){navigator.clipboard.writeText(zt.a.compressToEncodedURIComponent(localStorage.getItem("save")))}copyFromClipboard(){var e=this;navigator.clipboard.readText().then(t=>{""!==t&&(e.loadGame(t),e.refreshAll())})}_getSaveObj(){return{version:r,saveTime:Date.now(),settings:ot.getInstance().save(),player:this.player.save(),gear:nt.getInstance().save(),world:this.worldData.save(),progression:this.progression.save(),moon:this.moonlight.save(),lore:_t.getInstance().save()}}save(){var e=this._getSaveObj();localStorage.setItem("save",JSON.stringify(e))}loadGame(e){var t={};if(null!==(t=void 0!==e?JSON.parse(zt.a.decompressFromEncodedURIComponent(e)):JSON.parse(localStorage.getItem("save")))){var i=new nt,s=new _t;if(t.version>4)(new ot).load(t.settings);this.moonlight.load(t.moon,t.version),i.load(t.gear,t.version),this.player.load(t.player,t.version),this.worldData.load(t.world,t.version),this.progression.load(t.progression,t.version),s.load(t.lore,t.version);var a=Date.now()-t.saveTime;a>6e4&&this.worldData.time.addOfflineTime(a)}}}([200,200],"DarkWorld"),$t={type:Phaser.AUTO,parent:"gameCanvas",width:1100,height:800,pixelArt:!0,scale:{autoCenter:Phaser.Scale.Center.CENTER_BOTH},scene:[Zt]};new Phaser.Game($t)}]);